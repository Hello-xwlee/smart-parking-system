<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½å¯¼èˆªä¸å¯»è½¦ - æ™ºèƒ½åœè½¦ç®¡ç†ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Noto Sans SC', sans-serif;
        }
        .gradient-text {
            background: linear-gradient(135deg, #3b82f6, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .floor-tab {
            transition: all 0.3s ease;
        }
        .floor-tab.active {
            background: linear-gradient(135deg, #3b82f6, #06b6d4);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.2);
        }
        .nav-step {
            transition: all 0.3s ease;
        }
        .nav-step:hover {
            transform: translateX(5px);
            background-color: rgba(59, 130, 246, 0.05);
        }
        .nav-step.active {
            background: linear-gradient(135deg, #dbeafe, #eff6ff);
            border-left: 4px solid #3b82f6;
        }
        #parking-map-canvas {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            cursor: pointer;
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        .path-animation {
            stroke-dasharray: 10, 5;
            stroke-dashoffset: 0;
            animation: pathMove 2s linear infinite;
        }
        @keyframes pathMove {
            to { stroke-dashoffset: -15; }
        }
        .demo-scenario-card {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border: 1px solid #bae6fd;
            transition: all 0.3s ease;
        }
        .demo-scenario-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px -5px rgba(14, 165, 233, 0.2);
        }
        .navigation-player {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(96, 165, 250, 0.3);
            border-radius: 12px;
            padding: 16px;
            color: white;
        }
        .voice-indicator {
            display: inline-block;
            width: 4px;
            height: 20px;
            background: #10b981;
            margin: 0 1px;
            border-radius: 2px;
            animation: voiceWave 1s ease-in-out infinite;
        }
        .voice-indicator:nth-child(2) { animation-delay: 0.1s; }
        .voice-indicator:nth-child(3) { animation-delay: 0.2s; }
        .voice-indicator:nth-child(4) { animation-delay: 0.3s; }
        @keyframes voiceWave {
            0%, 100% { height: 20px; }
            50% { height: 8px; }
        }
        .complexity-badge {
            background: linear-gradient(135deg, #8b5cf6, #c084fc);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- å¯¼èˆªæ  -->
    <nav class="bg-white shadow-lg fixed w-full top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-2xl font-bold gradient-text">æ™ºèƒ½å¯¼èˆªä¸å¯»è½¦</h1>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="index.html" class="text-gray-600 hover:text-blue-600 transition-colors">é¦–é¡µ</a>
                    <a href="search.html" class="text-gray-600 hover:text-blue-600 transition-colors">åœè½¦åœºæŸ¥è¯¢</a>
                    <a href="navigation.html" class="text-blue-600 font-medium hover:text-blue-800 transition-colors">å®¤å†…å¯¼èˆª</a>
                    <a href="booking.html" class="text-gray-600 hover:text-blue-600 transition-colors">é¢„çº¦ç®¡ç†</a>
                    <a href="payment.html" class="text-gray-600 hover:text-blue-600 transition-colors">ç¼´è´¹ä¸­å¿ƒ</a>
                    <a href="dashboard-big-screen.html" class="text-gray-600 hover:text-yellow-400 transition-colors" target="_blank">æ•°æ®å¤§å±</a>

                    <!-- é€šçŸ¥é“ƒé“› -->
                    <button onclick="NotificationManager.showNotificationDrawer()" class="relative p-2 text-gray-600 hover:text-blue-600 transition-colors" id="notification-btn" style="display: none;">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold hidden" id="notification-badge">0</span>
                    </button>

                    <!-- ç™»å½•å‰æ˜¾ç¤º -->
                    <a href="login.html" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors" id="nav-login-btn">ç™»å½•</a>
                    <a href="register.html" class="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors" id="nav-register-btn">æ³¨å†Œ</a>

                    <!-- ç™»å½•åæ˜¾ç¤º -->
                    <button onclick="AuthManager.logout()" class="bg-red-100 text-red-700 px-4 py-2 rounded-lg hover:bg-red-200 transition-colors hidden" id="nav-logout-btn">é€€å‡º</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å†…å®¹ -->
    <main class="pt-16">

        <!-- åŠŸèƒ½é€‰æ‹©åŒºåŸŸ -->
        <section class="bg-gradient-to-br from-blue-50 to-indigo-50 py-12">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-5xl font-bold gradient-text mb-4">ğŸ§­ æ™ºèƒ½å¯¼èˆªä¸åå‘å¯»è½¦ç³»ç»Ÿ</h2>
                    <p class="text-gray-600 text-xl max-w-3xl mx-auto">åŸºäºAIè·¯å¾„è§„åˆ’ç®—æ³•ï¼Œæ”¯æŒå¤šæ¥¼å±‚å¯¼èˆªã€åå‘å¯»è½¦ã€è¯­éŸ³å¼•å¯¼ï¼Œæä¾›ç²¾ç¡®åˆ°è½¦ä½çš„å®¤å†…å¯¼èˆªä½“éªŒ</p>
                    <div class="mt-6">
                        <span class="complexity-badge">è·¯å¾„å¤æ‚åº¦: O(n log n)</span>
                        <span class="complexity-badge ml-2">A*å¯»è·¯ç®—æ³•</span>
                        <span class="complexity-badge ml-2">3Dç©ºé—´æ˜ å°„</span>
                        <span class="complexity-badge ml-2">è¯­éŸ³TTS</span>
                    </div>
                </div>

                <!-- æ¼”ç¤ºåœºæ™¯é€‰æ‹© -->
                <div class="mb-12">
                    <h3 class="text-2xl font-bold text-center mb-8 text-gray-800">ğŸ¬ é€‰æ‹©æ¼”ç¤ºåœºæ™¯</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <!-- åœºæ™¯1: å•å±‚ç®€å•å¯¼èˆª -->
                        <div class="demo-scenario-card rounded-xl p-6 cursor-pointer" onclick="startDemoNavigation('simple')">
                            <div class="text-4xl mb-3 text-center">ğŸ“</div>
                            <h4 class="font-bold text-lg mb-2 text-blue-800">åœºæ™¯1: å•å±‚å¿«é€Ÿå¯¼èˆª</h4>
                            <p class="text-sm text-gray-600 mb-4">1æ¥¼å…¥å£ â†’ A-102è½¦ä½ï¼ˆè·ç¦»45ç±³ï¼Œé¢„è®¡1åˆ†é’Ÿï¼‰</p>
                            <div class="flex justify-between text-xs text-gray-500">
                                <span>è·¯å¾„èŠ‚ç‚¹: 5ä¸ª</span>
                                <span>éš¾åº¦: â­</span>
                            </div>
                        </div>

                        <!-- åœºæ™¯2: è·¨æ¥¼å±‚å¯¼èˆª -->
                        <div class="demo-scenario-card rounded-xl p-6 cursor-pointer" onclick="startDemoNavigation('multi-floor')">
                            <div class="text-4xl mb-3 text-center">ğŸ›—</div>
                            <h4 class="font-bold text-lg mb-2 text-purple-800">åœºæ™¯2: è·¨æ¥¼å±‚å¯¼èˆª</h4>
                            <p class="text-sm text-gray-600 mb-4">1æ¥¼å…¥å£ â†’ ç”µæ¢¯ â†’ 3æ¥¼B-23è½¦ä½ï¼ˆè·ç¦»85ç±³ï¼Œé¢„è®¡3åˆ†é’Ÿï¼‰</p>
                            <div class="flex justify-between text-xs text-gray-500">
                                <span>è·¯å¾„èŠ‚ç‚¹: 12ä¸ª</span>
                                <span>éš¾åº¦: â­â­</span>
                            </div>
                        </div>

                        <!-- åœºæ™¯3: åå‘å¯»è½¦ -->
                        <div class="demo-scenario-card rounded-xl p-6 cursor-pointer" onclick="startDemoNavigation('find-car')">
                            <div class="text-4xl mb-3 text-center">ğŸš—</div>
                            <h4 class="font-bold text-lg mb-2 text-green-800">åœºæ™¯3: åå‘å¯»è½¦æ¨¡å¼</h4>
                            <p class="text-sm text-gray-600 mb-4">åå‘å¯»è½¦: äº¬A12345 â†’ 3æ¥¼C-42è½¦ä½ï¼ˆè·¯å¾„è§„åˆ’+è¯­éŸ³å¼•å¯¼ï¼‰</p>
                            <div class="flex justify-between text-xs text-gray-500">
                                <span>è·¯å¾„èŠ‚ç‚¹: 15ä¸ª</span>
                                <span>éš¾åº¦: â­â­â­</span>
                            </div>
                        </div>

                        <!-- åœºæ™¯4: é«˜å³°æœŸå¯¼èˆª -->
                        <div class="demo-scenario-card rounded-xl p-6 cursor-pointer" onclick="startDemoNavigation('rush-hour')">
                            <div class="text-4xl mb-3 text-center">ğŸš¶â€â™‚ï¸ğŸš¶â€â™€ï¸</div>
                            <h4 class="font-bold text-lg mb-2 text-red-800">åœºæ™¯4: é«˜å³°æœŸåŠ¨æ€é¿éšœ</h4>
                            <p class="text-sm text-gray-600 mb-4">é«˜å³°æœŸ: 1æ¥¼ â†’ B-201è½¦ä½ï¼ˆæ™ºèƒ½é¿éšœ+äººæµé¢„æµ‹ï¼‰</p>
                            <div class="flex justify-between text-xs text-gray-500">
                                <span>è·¯å¾„èŠ‚ç‚¹: 20ä¸ª</span>
                                <span>éš¾åº¦: â­â­â­â­</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ç®—æ³•è¯´æ˜ -->
                <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                    <h3 class="text-2xl font-bold mb-6 text-gray-800">ğŸ”¬ å¯¼èˆªç®—æ³•è¯´æ˜</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <h4 class="font-semibold text-lg mb-3 text-blue-700">A*å¯»è·¯ç®—æ³• (ç®€åŒ–ç‰ˆ)</h4>
                            <div class="bg-gray-50 rounded-lg p-4 font-mono text-sm space-y-2">
                                <div><span class="text-purple-600">function</span> <span class="text-blue-600">findPath</span>(start, goal) {</div>
                                <div class="ml-4">openSet = PriorityQueue()</div>
                                <div class="ml-4">openSet.<span class="text-blue-600">add</span>(start, <span class="text-green-600">0</span>)</div>
                                <div class="ml-4">gScore = HashMap()</div>
                                <div class="ml-4">fScore = HashMap()</div>
                                <div class="ml-4">...</div>
                                <div>}</div>
                            </div>
                        </div>
                        <div>
                            <h4 class="font-semibold text-lg mb-3 text-green-700">æˆæœ¬è®¡ç®—å‡½æ•°</h4>
                            <div class="bg-gray-50 rounded-lg p-4 space-y-3">
                                <div class="flex justify-between">
                                    <span>è·ç¦»æˆæœ¬:</span>
                                    <span class="font-mono">f(distance) = distance Ã— 0.8</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>æ—¶é—´æˆæœ¬:</span>
                                    <span class="font-mono">f(time) = time Ã— 1.2</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>æ‹¥å µæˆæœ¬:</span>
                                    <span class="font-mono">f(crowd) = crowd Ã— 1.5</span>
                                </div>
                                <div class="border-t pt-3">
                                    <strong>æ€»æˆæœ¬:</strong> <span class="font-mono">Î£(å„æˆæœ¬ Ã— æƒé‡)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- è‡ªå®šä¹‰å¯¼èˆªï¼ˆæ–°å¢ï¼‰ -->
                <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                    <h3 class="text-2xl font-bold mb-6 text-gray-800">ğŸ¯ è‡ªå®šä¹‰å¯¼èˆªè·¯çº¿</h3>
                    <p class="text-gray-600 mb-6">è¾“å…¥æ‚¨çš„ç›®æ ‡è½¦ä½å·ï¼Œç³»ç»Ÿå°†ä¸ºæ‚¨è§„åˆ’æœ€ä¼˜è·¯çº¿</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ç›®æ ‡æ¥¼å±‚</label>
                            <select id="custom-floor" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                                <option value="1">1æ¥¼ - AåŒº/BåŒº</option>
                                <option value="2">2æ¥¼ - CåŒº/DåŒº</option>
                                <option value="3">3æ¥¼ - VIPåŒº</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">è½¦ä½ç¼–å·</label>
                            <input type="text" id="custom-spot" placeholder="ä¾‹å¦‚: A-105" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                            <p class="text-xs text-gray-500 mt-1">æ ¼å¼: åŒºåŸŸ-ç¼–å· (å¦‚: A-105)</p>
                        </div>
                        <div class="flex items-end">
                            <button onclick="startCustomNavigation()" class="w-full bg-gradient-to-r from-blue-600 to-cyan-600 text-white py-3 rounded-lg hover:from-blue-700 hover:to-cyan-700 transition-all transform hover:scale-105 shadow-lg font-medium">
                                ğŸ§­ å¼€å§‹å¯¼èˆª
                            </button>
                        </div>
                    </div>

                    <!-- å¸¸ç”¨è½¦ä½å¿«æ·é€‰æ‹© -->
                    <div class="mt-6">
                        <h4 class="font-semibold mb-3 text-gray-700">å¿«æ·é€‰æ‹©</h4>
                        <div class="flex flex-wrap gap-3">
                            <button onclick="selectQuickSpot('A-101')" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-blue-100 hover:text-blue-700 transition-colors">A-101</button>
                            <button onclick="selectQuickSpot('A-102')" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-blue-100 hover:text-blue-700 transition-colors">A-102</button>
                            <button onclick="selectQuickSpot('B-205')" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-blue-100 hover:text-blue-700 transition-colors">B-205</button>
                            <button onclick="selectQuickSpot('C-301')" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-blue-100 hover:text-blue-700 transition-colors">C-301</button>
                            <button onclick="selectQuickSpot('VIP-001')" class="px-4 py-2 bg-gradient-to-r from-purple-100 to-pink-100 text-purple-700 rounded-lg hover:from-purple-200 hover:to-pink-200 transition-colors">VIP-001</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- åå‘å¯»è½¦è¡¨å• -->
        <section id="find-car-section" class="py-8 bg-white hidden">
            <div class="container mx-auto px-6">
                <div class="max-w-2xl mx-auto">
                    <h3 class="text-2xl font-semibold mb-6 text-center">ğŸ” æŸ¥æ‰¾æ‚¨çš„è½¦è¾†</h3>
                    <div class="bg-gray-50 rounded-xl p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">è½¦ç‰Œå·ç </label>
                                <input type="text" id="license-plate" placeholder="ä¾‹å¦‚ï¼šäº¬A12345" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">æˆ– åœè½¦å‡­è¯å·</label>
                                <input type="text" id="parking-ticket" placeholder="å‡­è¯ä¸Šçš„ç¼–å·" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                            </div>
                        </div>
                        <div class="text-center">
                            <button onclick="findVehicle()" id="find-car-btn" class="bg-green-600 text-white px-8 py-3 rounded-lg hover:bg-green-700 transition-colors">
                                ç«‹å³æŸ¥æ‰¾
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- å¯»è½¦ç»“æœ -->
        <section id="find-car-result-section" class="py-8 bg-white hidden">
            <div class="container mx-auto px-6">
                <div id="find-vehicle-result">
                    <!-- å¯»è½¦ç»“æœå°†åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </section>

        <!-- å¯¼èˆªåœ°å›¾åŒºåŸŸ -->
        <section class="py-8 bg-gray-50">
            <div class="container mx-auto px-6">
                <div class="text-center mb-8">
                    <h3 class="text-3xl font-bold gradient-text mb-4">åœè½¦åœºå¯¼èˆªåœ°å›¾</h3>
                    <p class="text-gray-600">ç‚¹å‡»åœ°å›¾æŸ¥çœ‹è¯¦ç»†å¯¼èˆªï¼Œä½¿ç”¨æ¥¼å±‚åˆ‡æ¢æŸ¥çœ‹ä¸åŒæ¥¼å±‚</p>
                </div>

                <!-- æ¥¼å±‚åˆ‡æ¢ -->
                <div class="flex justify-center mb-8">
                    <div class="bg-white rounded-lg shadow-md p-2 flex gap-2">
                        <button class="floor-tab active px-6 py-3 rounded-lg font-medium" data-floor="1" onclick="changeFloor(1)">
                            1æ¥¼
                        </button>
                        <button class="floor-tab px-6 py-3 rounded-lg bg-gray-200 text-gray-700 font-medium" data-floor="2" onclick="changeFloor(2)">
                            2æ¥¼
                        </button>
                        <button class="floor-tab px-6 py-3 rounded-lg bg-gray-200 text-gray-700 font-medium" data-floor="3" onclick="changeFloor(3)">
                            3æ¥¼
                        </button>
                    </div>
                </div>

                <!-- åœ°å›¾ç”»å¸ƒ -->
                <div class="flex justify-center mb-8">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <canvas id="parking-map-canvas" width="800" height="500"></canvas>
                    </div>
                </div>

                <!-- å›¾ä¾‹ -->
                <div class="flex justify-center">
                    <div class="bg-white rounded-lg shadow-md p-4 flex gap-8">
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 bg-green-500 rounded"></div>
                            <span class="text-sm">ç©ºé—²è½¦ä½</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 bg-red-500 rounded"></div>
                            <span class="text-sm">å ç”¨è½¦ä½</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 bg-blue-500 rounded"></div>
                            <span class="text-sm">ç”µæ¢¯ä½ç½®</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 bg-orange-500 rounded-full"></div>
                            <span class="text-sm">å½“å‰ä½ç½®</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 bg-red-500 rounded-full"></div>
                            <span class="text-sm">ç›®æ ‡ä½ç½®</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- å¯¼èˆªæŒ‡å¼• -->
        <section id="navigation-instructions" class="py-8 bg-white hidden">
            <div class="container mx-auto px-6">
                <div class="max-w-4xl mx-auto">
                    <h3 class="text-3xl font-bold gradient-text text-center mb-8">ğŸ§­ å¯¼èˆªæŒ‡å¼•</h3>
                    <div id="instructions-container" class="space-y-4">
                        <!-- å¯¼èˆªæ­¥éª¤å°†åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </section>

        <!-- å¯¼èˆªç®—æ³•å¯è§†åŒ–é¢æ¿ (å›ºå®šå®¹å™¨ï¼Œç¡®ä¿æ€»æ˜¯æ˜¾ç¤º) -->
        <section class="py-8 bg-gray-50" id="algorithm-visualization-container">
            <div class="container mx-auto px-6">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold gradient-text mb-4">ğŸ”¬ å¯¼èˆªç®—æ³•å¯è§†åŒ–</h2>
                    <p class="text-gray-600">è§‚çœ‹A*å¯»è·¯ç®—æ³•å®æ—¶è¿è¡Œè¿‡ç¨‹ï¼Œå¯¹æ¯”ä¸åŒå¯å‘å‡½æ•°æ•ˆæœ</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Algorithm controls -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="font-bold text-xl mb-4">ğŸ® ç®—æ³•æ§åˆ¶é¢æ¿</h3>

                        <!-- Progress bar -->
                        <div class="mb-6">
                            <div class="bg-gray-200 rounded-full h-2">
                                <div id="algorithm-progress-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                            </div>
                        </div>

                        <!-- Control buttons -->
                        <div class="flex gap-4 mb-6">
                            <button onclick="playAlgorithmAnimationVisualization()" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors">
                                â–¶ å¼€å§‹ç®—æ³•æ¼”ç¤º
                            </button>
                            <button onclick="stopAlgorithmAnimation()" class="flex-1 bg-red-600 text-white py-2 px-4 rounded hover:bg-red-700 transition-colors">
                                â¹ åœæ­¢
                            </button>
                            <button onclick="compareHeuristics()" class="flex-1 bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 transition-colors">
                                âš–ï¸ å¯¹æ¯”å¯å‘å‡½æ•°
                            </button>
                        </div>

                        <!-- Algorithm log -->
                        <div class="bg-gray-50 rounded-lg p-4 mb-4">
                            <h4 class="font-semibold mb-2 text-gray-700">ğŸ“‹ ç®—æ³•æ‰§è¡Œæ—¥å¿—</h4>
                            <div id="algorithm-log-container" class="text-xs font-mono max-h-32 overflow-y-auto">
                                <div class="text-gray-500">æ—¥å¿—å·²æ¸…é™¤ï¼Œç­‰å¾…æ–°çš„ç®—æ³•æ‰§è¡Œ...</div>
                            </div>
                        </div>

                        <!-- Debug info -->
                        <div id="algorithm-debug-panel"></div>
                    </div>

                    <!-- Heuristic comparison -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="font-bold text-xl mb-4">âš–ï¸ å¯å‘å‡½æ•°å¯¹æ¯”</h3>
                        <div id="heuristic-comparison-chart-container">
                            <div id="heuristic-comparison-chart" style="height: 300px;"></div>
                            <div id="heuristic-stats" class="mt-4"></div>
                        </div>
                    </div>
                </div>

                <!-- Complexity analysis -->
                <div class="mt-8 bg-white rounded-xl shadow-lg p-6">
                    <h3 class="font-bold text-xl mb-4">ğŸ“ˆ ç®—æ³•å¤æ‚åº¦åˆ†æ</h3>
                    <div id="complexity-analysis-chart" style="height: 400px;"></div>
                    <div id="complexity-table" class="mt-6"></div>
                </div>
            </div>
        </section>

    </main>

    <!-- é¡µè„š -->
    <footer class="bg-gray-800 text-white py-12">
        <div class="container mx-auto px-6 text-center">
            <p class="text-gray-300">&copy; 2025 æ™ºèƒ½åœè½¦ç®¡ç†ç³»ç»Ÿ. åŸºäºäººå·¥æ™ºèƒ½å’Œç‰©è”ç½‘æŠ€æœ¯çš„ç°ä»£åŒ–åœè½¦è§£å†³æ–¹æ¡ˆ.</p>
        </div>
    </footer>

    <!-- å¯¼èˆªæ¼”ç¤ºæ’­æ”¾å™¨ -->
    <div id="navigation-player" class="navigation-player hidden">
        <div class="flex items-center justify-between mb-3">
            <div class="font-semibold">è¯­éŸ³å¯¼èˆª</div>
            <div class="voice-indicator"></div>
            <div class="voice-indicator"></div>
            <div class="voice-indicator"></div>
            <div class="voice-indicator"></div>
        </div>
        <div id="current-step-text" class="text-sm mb-3 text-blue-300" style="width: 200px;">å‡†å¤‡å¼€å§‹å¯¼èˆª...</div>
        <div class="flex space-x-2">
            <button onclick="navigationPlayer.play()" class="bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-xs">â–¶ æ’­æ”¾</button>
            <button onclick="navigationPlayer.pause()" class="bg-yellow-600 hover:bg-yellow-700 px-3 py-1 rounded text-xs">â¸ æš‚åœ</button>
            <button onclick="navigationPlayer.stop()" class="bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-xs">â¹ åœæ­¢</button>
        </div>
    </div>

    <script src="smart-functions.js"></script>
    <script src="task4-navigation.js"></script>
    <script>
        // å…¨å±€å˜é‡ - ç¡®ä¿åœ¨æ‰€æœ‰è„šæœ¬ä¹‹å‰å®šä¹‰
        var selectedTargetLocation = null;

        // ==================== å¯¼èˆªæ¼”ç¤ºæ§åˆ¶å™¨ ====================
        const navigationPlayer = {
            currentNavigation: null,
            currentStep: 0,
            isPlaying: false,
            playInterval: null,

            // å¼€å§‹æ’­æ”¾å¯¼èˆª
            play() {
                if (!this.currentNavigation) return;
                if (this.isPlaying) return;

                this.isPlaying = true;
                const player = document.getElementById('navigation-player');
                player.classList.remove('hidden');

                // é«˜äº®å½“å‰æ­¥éª¤
                this.highlightCurrentStep();

                // è¯­éŸ³æ’­æŠ¥
                this.speakCurrentStep();

                // è‡ªåŠ¨æ’­æ”¾ä¸‹ä¸€æ­¥
                const currentInstruction = this.currentNavigation.instructions[this.currentStep];
                const duration = (currentInstruction.duration || 2) * 1000;

                this.playInterval = setTimeout(() => {
                    this.nextStep();
                }, duration);
            },

            pause() {
                this.isPlaying = false;
                if (this.playInterval) {
                    clearTimeout(this.playInterval);
                }
            },

            stop() {
                this.pause();
                this.currentStep = 0;
                document.getElementById('navigation-player').classList.add('hidden');
                document.querySelectorAll('.nav-step').forEach(step => {
                    step.classList.remove('active');
                });
            },

            nextStep() {
                if (!this.currentNavigation) return;

                this.currentStep++;
                if (this.currentStep >= this.currentNavigation.instructions.length) {
                    // å¯¼èˆªå®Œæˆ
                    this.stop();
                    alert('ğŸ‰ å¯¼èˆªå®Œæˆï¼å·²åˆ°è¾¾ç›®çš„åœ°');
                    setTimeout(() => {
                        speak('å¯¼èˆªå®Œæˆï¼Œç¥æ‚¨ä¸€è·¯é¡ºé£ï¼');
                    }, 500);
                    return;
                }

                if (this.isPlaying) {
                    this.play();
                }
            },

            highlightCurrentStep() {
                const steps = document.querySelectorAll('.nav-step');
                const stepTexts = document.querySelectorAll('.nav-step h4');

                steps.forEach((step, index) => {
                    step.classList.remove('active');
                    if (index === this.currentStep) {
                        step.classList.add('active');
                        // æ»šåŠ¨åˆ°å½“å‰æ­¥éª¤
                        step.scrollIntoView({ behavior: 'smooth', block: 'center' });

                        // æ›´æ–°æ’­æ”¾å™¨æ–‡æœ¬
                        if (stepTexts[index]) {
                            document.getElementById('current-step-text').textContent = stepTexts[index].textContent;
                        }
                    }
                });
            },

            speakCurrentStep() {
                if (!this.currentNavigation || this.currentStep >= this.currentNavigation.instructions.length) return;

                const instruction = this.currentNavigation.instructions[this.currentStep];
                const text = instruction.text;

                speak(text);
            },

            setNavigation(navigationInfo) {
                this.currentNavigation = navigationInfo;
                this.currentStep = 0;
            }
        };

        // ==================== æ¼”ç¤ºåœºæ™¯ ====================
        // é¢„è®¾çš„å¤æ‚æ¼”ç¤ºåœºæ™¯
        const demoScenarios = {
            'simple': {
                name: 'å•å±‚ç®€å•å¯¼èˆª',
                start: { floor: 1, x: 50, y: 450, type: 'entrance' },
                goal: { floor: 1, x: 250, y: 450, spotNumber: 'A-102', area: 'AåŒº' },
                path: [
                    { floor: 1, x: 50, y: 450, type: 'start' },
                    { floor: 1, x: 100, y: 450, type: 'waypoint' },
                    { floor: 1, x: 150, y: 450, type: 'waypoint' },
                    { floor: 1, x: 200, y: 450, type: 'waypoint' },
                    { floor: 1, x: 250, y: 450, type: 'destination' }
                ],
                instructions: [
                    { step: 1, text: 'ä»å…¥å£å‡ºå‘', icon: 'ğŸ“', distance: 0, duration: 0 },
                    { step: 2, text: 'æ²¿é€šé“ç›´è¡Œ30ç±³', icon: 'ğŸš¶', distance: 30, duration: 1 },
                    { step: 3, text: 'å‰æ–¹è·¯å£ç›´è¡Œ20ç±³', icon: 'â¡ï¸', distance: 20, duration: 1 },
                    { step: 4, text: 'åˆ°è¾¾A-102è½¦ä½', icon: 'ğŸ¯', distance: 0, duration: 0 }
                ],
                totalDistance: 50,
                estimatedTime: 2
            },

            'multi-floor': {
                name: 'è·¨æ¥¼å±‚å¯¼èˆª',
                start: { floor: 1, x: 50, y: 450, type: 'entrance' },
                goal: { floor: 3, x: 350, y: 300, spotNumber: 'B-23', area: 'BåŒº' },
                path: [
                    { floor: 1, x: 50, y: 450, type: 'start' },
                    { floor: 1, x: 100, y: 450, type: 'waypoint' },
                    { floor: 1, x: 150, y: 400, type: 'waypoint' },
                    { floor: 1, x: 150, y: 350, type: 'elevator_entrance' },
                    { floor: 3, x: 150, y: 350, type: 'elevator_exit' },
                    { floor: 3, x: 200, y: 350, type: 'waypoint' },
                    { floor: 3, x: 250, y: 350, type: 'waypoint' },
                    { floor: 3, x: 300, y: 325, type: 'waypoint' },
                    { floor: 3, x: 350, y: 300, type: 'destination' }
                ],
                instructions: [
                    { step: 1, text: 'ä»å…¥å£å‡ºå‘', icon: 'ğŸ“', distance: 0, duration: 0 },
                    { step: 2, text: 'æ²¿é€šé“ç›´è¡Œ50ç±³åˆ°è¾¾ç”µæ¢¯åŒº', icon: 'ğŸš¶', distance: 50, duration: 1 },
                    { step: 3, text: 'ä¹˜åç”µæ¢¯ä¸Šè¡Œè‡³3æ¥¼', icon: 'ğŸ›—', distance: 0, duration: 2 },
                    { step: 4, text: 'å‡ºç”µæ¢¯åå³è½¬30ç±³', icon: 'â¡ï¸', distance: 30, duration: 1 },
                    { step: 5, text: 'æ²¿æŒ‡ç¤ºç‰Œå‰è¡Œ35ç±³', icon: 'ğŸš¶', distance: 35, duration: 1 },
                    { step: 6, text: 'åˆ°è¾¾B-23è½¦ä½', icon: 'ğŸ¯', distance: 0, duration: 0 }
                ],
                totalDistance: 115,
                estimatedTime: 5
            },

            'find-car': {
                name: 'åå‘å¯»è½¦',
                start: { floor: 3, x: 50, y: 50, type: 'entrance' },
                goal: { floor: 3, x: 380, y: 380, spotNumber: 'C-42', area: 'CåŒº' },
                path: [
                    { floor: 3, x: 50, y: 50, type: 'start' },
                    { floor: 3, x: 100, y: 100, type: 'waypoint' },
                    { floor: 3, x: 150, y: 150, type: 'waypoint' },
                    { floor: 3, x: 200, y: 200, type: 'waypoint' },
                    { floor: 3, x: 250, y: 250, type: 'waypoint' },
                    { floor: 3, x: 300, y: 300, type: 'waypoint' },
                    { floor: 3, x: 350, y: 340, type: 'waypoint' },
                    { floor: 3, x: 380, y: 380, type: 'destination' }
                ],
                instructions: [
                    { step: 1, text: 'æ‰«ç ç¡®è®¤èº«ä»½', icon: 'ğŸ“±', distance: 0, duration: 1 },
                    { step: 2, text: 'å®šä½è½¦è¾†ä½ç½®: C-42', icon: 'ğŸ“', distance: 0, duration: 0 },
                    { step: 3, text: 'è§„åˆ’æœ€ä¼˜å–è½¦è·¯çº¿', icon: 'ğŸ—ºï¸', distance: 0, duration: 1 },
                    { step: 4, text: 'ç›´è¡Œ60ç±³', icon: 'â¬†ï¸', distance: 60, duration: 2 },
                    { step: 5, text: 'ç»•è¿‡æ‹¥å µåŒºåŸŸ', icon: 'â†—ï¸', distance: 40, duration: 1 },
                    { step: 6, text: 'æŠµè¾¾C-42è½¦ä½', icon: 'ğŸš—', distance: 0, duration: 0 }
                ],
                totalDistance: 100,
                estimatedTime: 4
            },

            'rush-hour': {
                name: 'é«˜å³°æœŸé¿éšœå¯¼èˆª',
                start: { floor: 1, x: 50, y: 50, type: 'entrance' },
                goal: { floor: 2, x: 300, y: 300, spotNumber: 'B-201', area: 'BåŒº' },
                path: [
                    { floor: 1, x: 50, y: 50, type: 'start' },
                    { floor: 1, x: 80, y: 80, type: 'waypoint' },
                    { floor: 1, x: 120, y: 120, type: 'waypoint' },
                    { floor: 1, x: 160, y: 150, type: 'waypoint' },
                    { floor: 1, x: 200, y: 180, type: 'waypoint' },
                    { floor: 1, x: 240, y: 210, type: 'waypoint' },
                    { floor: 1, x: 280, y: 240, type: 'waypoint' },
                    { floor: 1, x: 300, y: 270, type: 'waypoint' },
                    { floor: 1, x: 320, y: 290, type: 'elevator_entrance' },
                    { floor: 2, x: 320, y: 290, type: 'elevator_exit' },
                    { floor: 2, x: 310, y: 295, type: 'waypoint' },
                    { floor: 2, x: 300, y: 300, type: 'destination' }
                ],
                instructions: [
                    { step: 1, text: 'æ£€æµ‹åˆ°å½“å‰äººæµé‡: 85%', icon: 'ğŸ“Š', distance: 0, duration: 0 },
                    { step: 2, text: 'æ¿€æ´»åŠ¨æ€é¿éšœç®—æ³•', icon: 'ğŸ¤–', distance: 0, duration: 1 },
                    { step: 3, text: 'ç»•è¡Œè‡³æ‹¥å µè¾ƒå°‘è·¯çº¿', icon: 'â†©ï¸', distance: 15, duration: 1 },
                    { step: 4, text: 'æ²¿Aé€šé“å‰è¿›35ç±³', icon: 'ğŸš¶', distance: 35, duration: 1 },
                    { step: 5, text: 'æå‰è½¬å‘è‡³ç”µæ¢¯åŒº', icon: 'â†ªï¸', distance: 25, duration: 1 },
                    { step: 6, text: 'ä¹˜åç”µæ¢¯è‡³2æ¥¼', icon: 'ğŸ›—', distance: 0, duration: 2 },
                    { step: 7, text: 'æœ€ç»ˆæŠµè¾¾B-201è½¦ä½', icon: 'ğŸ¯', distance: 10, duration: 1 }
                ],
                totalDistance: 85,
                estimatedTime: 6
            }
        };

        // å¼€å§‹æ¼”ç¤ºå¯¼èˆª
        function startDemoNavigation(scenarioType) {
            const scenario = demoScenarios[scenarioType];
            if (!scenario) return;

            console.log(`ğŸ¬ å¼€å§‹æ¼”ç¤º: ${scenario.name}`);

            // ç”Ÿæˆå¯¼èˆªç»“æœ
            const navigationResult = {
                instructions: scenario.instructions,
                totalDistance: scenario.totalDistance,
                estimatedTime: scenario.estimatedTime,
                path: scenario.path
            };

            // æ˜¾ç¤ºå¯¼èˆªæŒ‡å¼•
            displayNavigationInstructions(navigationResult, scenario);

            // é«˜äº®å½“å‰æ¥¼å±‚
            const floor = scenario.start.floor;
            document.querySelectorAll('.floor-tab').forEach((tab, index) => {
                if (parseInt(tab.getAttribute('data-floor')) === floor) {
                    changeFloor(floor);
                }
            });

            // ========================================
            // Phase 3: ç®—æ³•å¯è§†åŒ–é›†æˆ (ADDED)
            // ========================================
            // è®°å½•ç®—æ³•æ‰§è¡Œæ—¥å¿—
            addAlgorithmLog(`ğŸš€ å¼€å§‹A*å¯»è·¯ç®—æ³• - ${scenario.name}`);
            addAlgorithmLog(`ğŸ“ èµ·ç‚¹: (${scenario.start.x}, ${scenario.start.y}, æ¥¼å±‚${scenario.start.floor})`);
            addAlgorithmLog(`ğŸ¯ ç»ˆç‚¹: (${scenario.goal.x}, ${scenario.goal.y}, æ¥¼å±‚${scenario.goal.floor})`);
            addAlgorithmLog(`ğŸ“Š è·¯å¾„èŠ‚ç‚¹æ•°: ${scenario.path.length}`);
            addAlgorithmLog(`âœ… ç®—æ³•æ‰§è¡Œå®Œæˆ`);

            // æ›´æ–°ç®—æ³•ç»Ÿè®¡ä¿¡æ¯
            const mockData = {
                exploredNodes: Math.floor(scenario.path.length * 2.5),
                iterations: Math.floor(scenario.path.length * 3.2)
            };
            document.getElementById('explored-nodes').textContent = mockData.exploredNodes;
            document.getElementById('iteration-count').textContent = mockData.iterations;
            // ========================================
            // End Phase 3
            // ========================================

            // åˆ›å»ºSVGè·¯å¾„åŠ¨ç”»
            setTimeout(() => {
                createPathAnimation(scenario.path, 5000);
            }, 500);

            // è®¾ç½®å¯¼èˆªæ’­æ”¾å™¨
            navigationPlayer.setNavigation(navigationResult);

            alert(`ğŸ‰ å·²ä¸ºæ‚¨ç”Ÿæˆ${scenario.name}æ¼”ç¤º\n\nè·¯å¾„èŠ‚ç‚¹: ${scenario.path.length}ä¸ª\næ€»è·ç¦»: ${scenario.totalDistance}ç±³\né¢„è®¡æ—¶é—´: ${scenario.estimatedTime}åˆ†é’Ÿ\n\nç‚¹å‡»"æ’­æ”¾"å¼€å§‹è¯­éŸ³å¯¼èˆªï¼`);
        }

        // åˆ›å»ºè·¯å¾„åŠ¨ç”»ï¼ˆSVGï¼‰
        function createPathAnimation(path, duration) {
            const canvas = document.getElementById('parking-map-canvas');
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.style.position = 'absolute';
            svg.style.top = '0';
            svg.style.left = '0';
            svg.style.width = '800px';
            svg.style.height = '500px';
            svg.style.pointerEvents = 'none';

            const pathElement = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            const points = path.map(p => `${p.x},${p.y}`).join(' ');
            pathElement.setAttribute('d', `M${points}`);
            pathElement.setAttribute('stroke', '#3b82f6');
            pathElement.setAttribute('stroke-width', '4');
            pathElement.setAttribute('fill', 'none');
            pathElement.setAttribute('stroke-linecap', 'round');
            pathElement.setAttribute('stroke-linejoin', 'round');
            pathElement.setAttribute('class', 'path-animation');

            svg.appendChild(pathElement);
            canvas.parentElement.style.position = 'relative';
            canvas.parentElement.appendChild(svg);

            // 5ç§’åç§»é™¤åŠ¨ç”»
            setTimeout(() => {
                if (svg.parentElement) {
                    svg.parentElement.removeChild(svg);
                }
            }, duration);
        }

        // æ˜¾ç¤ºå¯¼èˆªæŒ‡å¼•ï¼ˆå¢å¼ºç‰ˆï¼‰
        function displayNavigationInstructions(navigationInfo, scenario) {
            const section = document.getElementById('navigation-instructions');
            const container = document.getElementById('instructions-container');

            if (!section || !container) return;

            section.classList.remove('hidden');

            container.innerHTML = `
                <div class="bg-gradient-to-r from-blue-600 to-cyan-600 text-white rounded-xl p-6 mb-6">
                    <div class="text-center">
                        <h4 class="text-3xl font-bold mb-2">ğŸ¯ ${scenario.name}</h4>
                        <div class="text-lg opacity-90">å…¨ç¨‹ ${navigationInfo.totalDistance} ç±³ï¼Œçº¦ ${navigationInfo.estimatedTime} åˆ†é’Ÿ</div>
                    </div>
                    <div class="grid grid-cols-3 gap-4 mt-4 text-center">
                        <div class="bg-white/10 rounded-lg p-3">
                            <div class="text-2xl font-bold">${navigationInfo.totalDistance}m</div>
                            <div class="text-sm">æ€»è·ç¦»</div>
                        </div>
                        <div class="bg-white/10 rounded-lg p-3">
                            <div class="text-2xl font-bold">${navigationInfo.estimatedTime}min</div>
                            <div class="text-sm">é¢„è®¡æ—¶é—´</div>
                        </div>
                        <div class="bg-white/10 rounded-lg p-3">
                            <div class="text-2xl font-bold">${navigationInfo.instructions.length}</div>
                            <div class="text-sm">å¯¼èˆªæ­¥éª¤</div>
                        </div>
                    </div>
                </div>

                <div class="space-y-4" id="navigation-steps">
                    ${navigationInfo.instructions.map((inst, index) => `
                        <div class="nav-step bg-white rounded-lg p-4 shadow-md border-l-4 border-blue-500 flex items-center transition-all duration-300">
                            <div class="flex items-center justify-center w-14 h-14 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-full mr-4 text-white font-bold text-xl">
                                ${inst.icon}
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center justify-between">
                                    <h4 class="font-bold text-xl text-gray-800">
                                        æ­¥éª¤ ${inst.step}: ${inst.text}
                                    </h4>
                                    <div class="flex space-x-3">
                                        ${inst.distance > 0 ? `
                                            <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">
                                                ğŸ“ ${inst.distance}ç±³
                                            </span>
                                        ` : ''}
                                        ${inst.duration > 0 ? `
                                            <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">
                                                â±ï¸ ${inst.duration}åˆ†é’Ÿ
                                            </span>
                                        ` : ''}
                                    </div>
                                </div>
                                <div class="mt-2 text-sm text-gray-500">
                                    é¢„è®¡æ—¶é—´: ${inst.duration || 0} åˆ†é’Ÿ
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>

                <div class="mt-8 text-center space-x-4">
                    <button onclick="navigationPlayer.play()" class="bg-gradient-to-r from-green-500 to-emerald-500 text-white px-8 py-3 rounded-lg hover:from-green-600 hover:to-emerald-600 transition-all transform hover:scale-105 shadow-lg">
                        ğŸµ å¼€å§‹è¯­éŸ³å¯¼èˆª
                    </button>
                    <button onclick="navigationPlayer.stop()" class="bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 transition-colors">
                        åœæ­¢
                    </button>
                </div>
            `;

            // æ»šåŠ¨åˆ°å¯¼èˆªæŒ‡å¼•åŒºåŸŸ
            setTimeout(() => {
                section.scrollIntoView({ behavior: 'smooth' });
            }, 500);

            // è‡ªåŠ¨è®¾ç½®å¯¼èˆª
            navigationPlayer.setNavigation(navigationInfo);
        }

        // æ¥¼å±‚åˆ‡æ¢
        function changeFloor(floor) {
            const canvas = document.getElementById('parking-map-canvas');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');

            // æ›´æ–°æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.floor-tab').forEach(tab => {
                tab.classList.remove('active', 'bg-blue-600', 'text-white');
                tab.classList.add('bg-gray-200', 'text-gray-700');
            });

            const activeTab = document.querySelector(`[data-floor="${floor}"]`);
            if (activeTab) {
                activeTab.classList.remove('bg-gray-200', 'text-gray-700');
                activeTab.classList.add('active', 'bg-blue-600', 'text-white');
            }

            // é‡æ–°ç»˜åˆ¶åœ°å›¾ï¼ˆä½¿ç”¨å…¨å±€ç›®æ ‡ä½ç½®ï¼Œå¦‚æœç›®æ ‡ä½ç½®ä¸åœ¨å½“å‰æ¥¼å±‚åˆ™æ˜¾ç¤ºä¸ºnullï¼‰
            const currentLocation = floor === 1 ? { x: 50, y: 50 } : null;
            const targetLocation = selectedTargetLocation && selectedTargetLocation.floor === floor
                ? selectedTargetLocation
                : null;

            if (typeof drawParkingMap === 'function') {
                drawParkingMap(ctx, floor, currentLocation, targetLocation);
            }
        }

        // ==================== è‡ªå®šä¹‰å¯¼èˆªåŠŸèƒ½ ====================
        // å¿«æ·é€‰æ‹©è½¦ä½
        function selectQuickSpot(spotNumber) {
            const floor = spotNumber.split('-')[0];
            const floorMap = { 'A': 1, 'B': 1, 'C': 2, 'D': 2, 'VIP': 3 };
            const floorNumber = floorMap[floor] || 1;

            document.getElementById('custom-floor').value = floorNumber;
            document.getElementById('custom-spot').value = spotNumber;

            // é«˜äº®æ˜¾ç¤ºé€‰ä¸­çš„æŒ‰é’®
            document.querySelectorAll('.mt-6 button').forEach(btn => {
                btn.classList.remove('bg-blue-100', 'text-blue-700');
                btn.classList.add('bg-gray-100', 'text-gray-700');
            });
            event.target.classList.remove('bg-gray-100', 'text-gray-700');
            event.target.classList.add('bg-blue-100', 'text-blue-700');
        }

        // å¼€å§‹è‡ªå®šä¹‰å¯¼èˆª
        function startCustomNavigation() {
            const floor = parseInt(document.getElementById('custom-floor').value);
            const spotNumber = document.getElementById('custom-spot').value.trim().toUpperCase();

            if (!spotNumber) {
                alert('è¯·è¾“å…¥è½¦ä½ç¼–å·');
                return;
            }

            // ç”ŸæˆåŸºäºè½¦ä½å·çš„åŠ¨æ€è·¯å¾„
            const navigationResult = generateDynamicNavigation(floor, spotNumber);

            if (navigationResult) {
                // ä½¿ç”¨ç”Ÿæˆçš„è·¯å¾„ç»ˆç‚¹ä½œä¸ºç›®æ ‡ä½ç½®
                const destination = navigationResult.path[navigationResult.path.length - 1];

                // è®¾ç½®å…¨å±€ç›®æ ‡ä½ç½®ï¼Œç”¨äºåœ°å›¾æ˜¾ç¤ºå’Œæ¥¼å±‚åˆ‡æ¢
                selectedTargetLocation = {
                    floor: floor,
                    x: destination.x,
                    y: destination.y,
                    spotNumber: spotNumber
                };

                // æ˜¾ç¤ºæ¥¼å±‚
                changeFloor(floor);

                // æ˜¾ç¤ºå¯¼èˆªæŒ‡å¼•
                displayNavigationInstructions(navigationResult, {
                    name: `è‡ªå®šä¹‰å¯¼èˆª: ${spotNumber}`,
                    totalDistance: navigationResult.totalDistance,
                    estimatedTime: navigationResult.estimatedTime
                });

                // åˆ›å»ºè·¯å¾„åŠ¨ç”»
                setTimeout(() => {
                    createPathAnimation(navigationResult.path, 5000);
                }, 500);

                // è®¾ç½®å¯¼èˆªæ’­æ”¾å™¨
                navigationPlayer.setNavigation(navigationResult);

                alert(`ğŸ‰ å·²ä¸º${spotNumber}ç”Ÿæˆå¯¼èˆªè·¯çº¿\nç›®æ ‡ä½ç½®: (${Math.round(destination.x)}, ${Math.round(destination.y)})\n\næ‚¨å¯ä»¥ä½¿ç”¨ä¸‹æ–¹çš„æ§åˆ¶é¢æ¿å¼€å§‹è¯­éŸ³å¯¼èˆªï¼`);
            }
        }

        // ç”ŸæˆåŠ¨æ€å¯¼èˆª
        function generateDynamicNavigation(floor, spotNumber) {
            // æ ¹æ®è½¦ä½å·ç”Ÿæˆè·¯å¾„
            const baseX = 50 + Math.random() * 300;
            const baseY = 50 + Math.random() * 250;

            const path = [
                { floor: floor, x: 50, y: 450, type: 'start' },
                { floor: floor, x: 100, y: 400, type: 'waypoint' },
                { floor: floor, x: 150, y: 350, type: 'waypoint' },
                { floor: floor, x: 200, y: 300, type: 'waypoint' },
                { floor: floor, x: baseX, y: baseY, type: 'destination', spotNumber: spotNumber }
            ];

            const distance = Math.floor(Math.random() * 80) + 40; // 40-120ç±³
            const time = Math.floor(distance / 25) + 1; // æŒ‰25ç±³/åˆ†é’Ÿè®¡ç®—

            const instructions = [
                { step: 1, text: 'ä»å…¥å£å‡ºå‘', icon: 'ğŸ“', distance: 0, duration: 0 },
                { step: 2, text: 'æ²¿ä¸»é€šé“ç›´è¡Œ', icon: 'ğŸš¶', distance: Math.floor(distance * 0.3), duration: Math.floor(time * 0.3) },
                { step: 3, text: 'æ ¹æ®æŒ‡ç¤ºç‰Œè½¬å¼¯', icon: 'â†©ï¸', distance: Math.floor(distance * 0.4), duration: Math.floor(time * 0.4) },
                { step: 4, text: `åˆ°è¾¾${spotNumber}è½¦ä½`, icon: 'ğŸ¯', distance: 0, duration: Math.floor(time * 0.3) }
            ];

            return {
                instructions: instructions,
                totalDistance: distance,
                estimatedTime: time,
                path: path
            };
        }

        // ========================================
        // Phase 3: ç®—æ³•å¯è§†åŒ–æ§åˆ¶å‡½æ•° (ADDED)
        // ========================================
        /**
         * æ’­æ”¾ç®—æ³•æ‰§è¡ŒåŠ¨ç”»
         */
        function playAlgorithmAnimationVisualization() {
            const button = document.getElementById('play-algorithm-btn');
            button.textContent = 'â¸ï¸ æ’­æ”¾ä¸­...';
            button.disabled = true;

            // é‡ç½®è¿›åº¦æ¡
            document.getElementById('algorithm-progress-bar').style.width = '0%';

            // æ¨¡æ‹ŸåŠ¨ç”»
            let progress = 0;
            const interval = setInterval(() => {
                progress += 5;
                document.getElementById('algorithm-progress-bar').style.width = `${progress}%`;

                if (progress >= 100) {
                    clearInterval(interval);
                    button.textContent = 'âœ… å®Œæˆ';
                    setTimeout(() => {
                        button.textContent = 'â–¶ï¸ é‡æ–°æ’­æ”¾';
                        button.disabled = false;
                    }, 1000);
                }
            }, 100);

            addAlgorithmLog('ğŸ¬ å¼€å§‹æ’­æ”¾ç®—æ³•åŠ¨ç”»...');
        }

        // ========================================
        // End Phase 3
        // ========================================

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–åœ°å›¾
            if (typeof initializeNavigation === 'function') {
                initializeNavigation();
            } else {
                // é»˜è®¤ç»˜åˆ¶1æ¥¼åœ°å›¾
                const canvas = document.getElementById('parking-map-canvas');
                if (canvas) {
                    const ctx = canvas.getContext('2d');
                    canvas.width = 800;
                    canvas.height = 500;

                    if (typeof drawParkingMap === 'function') {
                        drawParkingMap(ctx, 1, { x: 50, y: 50 }, null);
                    }
                }
            }

            // ========================================
            // Phase 3: åˆå§‹åŒ–ç®—æ³•å¯è§†åŒ– (ADDED)
            // ========================================
            // åˆå§‹åŒ–ç®—æ³•æ‰§è¡Œæ—¥å¿—
            setTimeout(() => {
                addAlgorithmLog('âœ… å¯¼èˆªç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
                addAlgorithmLog('ğŸ—ºï¸ åœ°å›¾åŠ è½½æˆåŠŸï¼ˆ1æ¥¼ï¼‰');
                addAlgorithmLog('ğŸ¯ å‡†å¤‡å°±ç»ªï¼Œç­‰å¾…ç”¨æˆ·æ“ä½œ...');
            }, 1500);
            // ========================================
            // End Phase 3
            // ========================================

            // æ˜¾ç¤ºæ¬¢è¿æç¤º
            setTimeout(() => {
                alert('ğŸ‰ æ¬¢è¿æ¥åˆ°æ™ºèƒ½å¯¼èˆªä¸åå‘å¯»è½¦ç³»ç»Ÿï¼\n\nâœ… æ–°å¢åŠŸèƒ½ï¼š\n1. é€‰æ‹©ä¸Šæ–¹æ¼”ç¤ºåœºæ™¯\n2. ä½¿ç”¨"è‡ªå®šä¹‰å¯¼èˆª"è¾“å…¥ä»»æ„è½¦ä½å·\n3. ç‚¹å‡»å¿«æ·é€‰æ‹©æŒ‰é’®\n4. ä½“éªŒå®æ—¶è¯­éŸ³å¯¼èˆªï¼');
            }, 1000);
        });
    </script>
</body>
</html>
