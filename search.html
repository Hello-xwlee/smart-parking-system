<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœè½¦åœºæŸ¥è¯¢ - æ™ºèƒ½åœè½¦ç®¡ç†ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Noto Sans SC', sans-serif;
        }
        .gradient-text {
            background: linear-gradient(135deg, #3b82f6, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .parking-card {
            transition: all 0.3s ease;
        }
        .parking-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .status-available { color: #10b981; }
        .status-busy { color: #f59e0b; }
        .status-full { color: #ef4444; }
        .map-container {
            height: 500px;
            border-radius: 12px;
            overflow: hidden;
        }
        .filter-button {
            transition: all 0.3s ease;
        }
        .filter-button.active {
            background: linear-gradient(135deg, #3b82f6, #06b6d4);
            color: white;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <!-- å¯¼èˆªæ  -->
    <nav class="bg-white shadow-lg fixed w-full top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-2xl font-bold gradient-text">æ™ºèƒ½åœè½¦ç®¡ç†</h1>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="index.html" class="text-gray-600 hover:text-blue-600 transition-colors">é¦–é¡µ</a>
                    <a href="search.html" class="text-blue-600 font-medium hover:text-blue-800 transition-colors">åœè½¦åœºæŸ¥è¯¢</a>
                    <a href="booking.html" class="text-gray-600 hover:text-blue-600 transition-colors">é¢„çº¦ç®¡ç†</a>
                    <a href="payment.html" class="text-gray-600 hover:text-blue-600 transition-colors">ç¼´è´¹ä¸­å¿ƒ</a>
                    <button onclick="showAdminLogin()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        ç®¡ç†å‘˜ç™»å½•
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å†…å®¹ -->
    <main class="pt-16">
        <!-- æœç´¢åŒºåŸŸ -->
        <section class="bg-white py-8 shadow-sm">
            <div class="container mx-auto px-6">
                <div class="flex flex-col lg:flex-row gap-6 items-center">
                    <div class="flex-1">
                        <div class="relative">
                            <input type="text" id="search-input" placeholder="æœç´¢åœè½¦åœºä½ç½®ã€åç§°æˆ–åœ°å€..." 
                                   class="w-full px-4 py-3 pl-12 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                            <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
                                ğŸ”
                            </div>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="searchParkingLots()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors">
                            æœç´¢
                        </button>
                        <button onclick="toggleFilters()" class="bg-gray-200 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-300 transition-colors">
                            ç­›é€‰
                        </button>
                    </div>
                </div>
                
                <!-- ç­›é€‰æ¡ä»¶ -->
                <div id="filter-panel" class="mt-6 hidden">
                    <div class="bg-gray-50 rounded-lg p-6">
                        <h3 class="text-lg font-semibold mb-4">ç­›é€‰æ¡ä»¶</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ä»·æ ¼èŒƒå›´</label>
                                <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                                    <option>å…¨éƒ¨ä»·æ ¼</option>
                                    <option>0-10å…ƒ/å°æ—¶</option>
                                    <option>10-20å…ƒ/å°æ—¶</option>
                                    <option>20-30å…ƒ/å°æ—¶</option>
                                    <option>30å…ƒä»¥ä¸Š/å°æ—¶</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">è½¦ä½çŠ¶æ€</label>
                                <div class="flex gap-2">
                                    <button class="filter-button active px-3 py-2 rounded-lg border" data-status="all">å…¨éƒ¨</button>
                                    <button class="filter-button px-3 py-2 rounded-lg border" data-status="available">ç©ºé—²</button>
                                    <button class="filter-button px-3 py-2 rounded-lg border" data-status="busy">ç´§å¼ </button>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">è·ç¦»èŒƒå›´</label>
                                <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                                    <option>å…¨éƒ¨è·ç¦»</option>
                                    <option>1å…¬é‡Œå†…</option>
                                    <option>3å…¬é‡Œå†…</option>
                                    <option>5å…¬é‡Œå†…</option>
                                    <option>10å…¬é‡Œå†…</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- æ™ºèƒ½æ¨è -->
        <section class="py-8 bg-gradient-to-br from-blue-50 to-indigo-50">
            <div class="container mx-auto px-6">
                <div id="smart-recommendations">
                    <!-- æ™ºèƒ½æ¨èå†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </section>

        <!-- åœ°å›¾å’Œåˆ—è¡¨åŒºåŸŸ -->
        <section class="py-8">
            <div class="container mx-auto px-6">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- åœ°å›¾åŒºåŸŸ -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-xl font-semibold mb-4">åœè½¦åœºåœ°å›¾</h2>
                        <div id="map" class="map-container"></div>
                    </div>
                    
                    <!-- åœè½¦åœºåˆ—è¡¨ -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-semibold">åœè½¦åœºåˆ—è¡¨</h2>
                            <div class="flex gap-2">
                                <button onclick="switchView('list')" id="list-view-btn" class="px-4 py-2 bg-blue-600 text-white rounded-lg">åˆ—è¡¨</button>
                                <button onclick="switchView('card')" id="card-view-btn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg">å¡ç‰‡</button>
                            </div>
                        </div>
                        
                        <div id="parking-list" class="space-y-4 max-h-96 overflow-y-auto">
                            <!-- åœè½¦åœºé¡¹ç›®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- æ¨èåœè½¦åœº -->
        <section class="py-8 bg-gray-50">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl font-bold text-center mb-8 gradient-text">æ¨èåœè½¦åœº</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="recommended-parking">
                    <!-- æ¨èåœè½¦åœºå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </section>
    </main>

    <!-- é¡µè„š -->
    <footer class="bg-gray-800 text-white py-12">
        <div class="container mx-auto px-6 text-center">
            <p class="text-gray-300">&copy; 2024 æ™ºèƒ½åœè½¦ç®¡ç†ç³»ç»Ÿ. åŸºäºäººå·¥æ™ºèƒ½å’Œç‰©è”ç½‘æŠ€æœ¯çš„ç°ä»£åŒ–åœè½¦è§£å†³æ–¹æ¡ˆ.</p>
        </div>
    </footer>

    <!-- åœè½¦åœºè¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="parking-detail-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl p-8 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold" id="modal-title">åœè½¦åœºè¯¦æƒ…</h3>
                <button onclick="closeParkingDetail()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <div id="modal-content">
                <!-- è¯¦æƒ…å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <script src="mockData.js"></script>
    <script src="main.js"></script>
    <script src="smart-functions.js"></script>
    <script src="task3-recommendation.js"></script>
    <script>
        // åœè½¦åœºæŸ¥è¯¢é¡µé¢ç‰¹å®šåŠŸèƒ½
        let map;
        let parkingData = [];
        let currentView = 'list';

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeMap();
            generateParkingData();

            // åˆå§‹åŒ–æ™ºèƒ½æ¨èç³»ç»Ÿ
            if (typeof initializeRecommendation === 'function') {
                initializeRecommendation();
            }

            // æ¯10ç§’æ›´æ–°ä»·æ ¼æ˜¾ç¤ºï¼ˆåŠ¨æ€å®šä»·ï¼‰
            setInterval(() => {
                if (typeof updateParkingListPrices === 'function') {
                    updateParkingListPrices();
                }
            }, 10000);

            displayParkingLots();
            displayRecommendedParking();
            initializeFilterButtons();
        });

        // åˆå§‹åŒ–åœ°å›¾
        function initializeMap() {
            map = L.map('map').setView([39.9042, 116.4074], 13);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap contributors'
            }).addTo(map);

            // æ·»åŠ ä¸€äº›ç¤ºä¾‹åœè½¦åœºæ ‡è®°
            const parkingLocations = [
                { lat: 39.9042, lng: 116.4074, name: 'ä¸­å…³æ‘åœè½¦åœº', status: 'available' },
                { lat: 39.9100, lng: 116.4200, name: 'ç‹åºœäº•åœè½¦åœº', status: 'busy' },
                { lat: 39.8900, lng: 116.3900, name: 'è¥¿å•åœè½¦åœº', status: 'available' },
                { lat: 39.9200, lng: 116.4300, name: 'ä¸œå•åœè½¦åœº', status: 'full' }
            ];

            parkingLocations.forEach(parking => {
                const color = parking.status === 'available' ? 'green' : 
                             parking.status === 'busy' ? 'orange' : 'red';
                
                L.marker([parking.lat, parking.lng])
                    .addTo(map)
                    .bindPopup(`<b>${parking.name}</b><br>çŠ¶æ€: ${parking.status}`)
                    .setIcon(L.divIcon({
                        className: `custom-marker ${color}`,
                        html: `<div style="background-color: ${color}; width: 20px; height: 20px; border-radius: 50%; border: 2px solid white;"></div>`,
                        iconSize: [20, 20]
                    }));
            });
        }

        // ç”Ÿæˆåœè½¦åœºæ•°æ®
        function generateParkingData() {
            const names = [
                'æœºç”µå­¦é¦†åœè½¦åœº', 'å»ºç­‘å­¦é¦†åœè½¦åœº', 'å¤§æˆåœè½¦åœº', 'é€¸å¤«åœè½¦åœº',
                'ä½•ä¸–ç¤¼åœè½¦åœº', 'é‡‡çŸ¿å­¦é¦†åœè½¦åœº', 'å†¶é‡‘å­¦é¦†åœè½¦åœº'
            ];

            const statuses = ['available', 'busy', 'full'];
            const prices = [5, 8, 10, 12, 15, 18, 20];

            parkingData = names.map((name, index) => {
                const status = statuses[Math.floor(Math.random() * statuses.length)];
                const totalSpots = Math.floor(Math.random() * 200) + 50;
                const availableSpots = status === 'full' ? 0 : 
                                     status === 'busy' ? Math.floor(totalSpots * 0.2) :
                                     Math.floor(totalSpots * 0.6);
                
                return {
                    id: index + 1,
                    name: name,
                    address: `æ²ˆé˜³å¸‚${name.split('åœè½¦åœº')[0]}`,
                    status: status,
                    totalSpots: totalSpots,
                    availableSpots: availableSpots,
                    price: prices[Math.floor(Math.random() * prices.length)],
                    distance: (Math.random() * 10 + 0.5).toFixed(1),
                    rating: (Math.random() * 2 + 3).toFixed(1),
                    image: `https://picsum.photos/seed/${index}/400/300.jpg`
                };
            });
        }

        // æ˜¾ç¤ºåœè½¦åœºåˆ—è¡¨
        function displayParkingLots() {
            const container = document.getElementById('parking-list');
            if (!container) return;

            container.innerHTML = '';

            parkingData.forEach(parking => {
                const parkingElement = createParkingElement(parking);
                container.appendChild(parkingElement);
            });
        }

        // åˆ›å»ºåœè½¦åœºå…ƒç´ 
        function createParkingElement(parking) {
            const div = document.createElement('div');
            div.className = 'parking-card bg-gray-50 rounded-lg p-4 cursor-pointer';
            div.setAttribute('data-lot-id', `P${String(parking.id).padStart(3, '0')}`);
            div.onclick = () => showParkingDetail(parking);

            const statusClass = parking.status === 'available' ? 'status-available' :
                               parking.status === 'busy' ? 'status-busy' : 'status-full';
            const statusText = parking.status === 'available' ? 'ç©ºé—²' :
                              parking.status === 'busy' ? 'ç´§å¼ ' : 'å·²æ»¡';

            div.innerHTML = `
                <div class="flex justify-between items-start mb-3">
                    <h3 class="font-semibold text-lg">${parking.name}</h3>
                    <span class="${statusClass} font-medium">${statusText}</span>
                </div>
                <div class="text-sm text-gray-600 mb-2">${parking.address}</div>
                <div class="flex justify-between items-center text-sm">
                    <span class="dynamic-price">
                        <strong>ğŸ’° ${parking.price}å…ƒ/å°æ—¶</strong>
                    </span>
                    <span>ğŸ“ ${parking.distance}km</span>
                    <span>ğŸ…¿ï¸ ${parking.availableSpots}/${parking.totalSpots}</span>
                </div>
                <div class="mt-3 flex justify-between items-center">
                    <div class="flex items-center">
                        <span class="text-yellow-500">â­</span>
                        <span class="ml-1 text-sm">${parking.rating}</span>
                    </div>
                    <button onclick="event.stopPropagation(); bookParkingSpot(${parking.id})"
                            class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        ç«‹å³é¢„çº¦
                    </button>
                </div>
            `;

            return div;
        }

        // è®¡ç®—åœè½¦åœºæ¨èæŒ‡æ•°ï¼ˆåŸºäºå¤šç»´ç‰¹å¾è¯„åˆ†æ¨¡å‹ï¼‰
        function calculateParkingScore(parking, weights = { distance: 0.4, price: 0.3, availability: 0.3 }) {
            // è·ç¦»å¾—åˆ†ï¼ˆè·ç¦»è¶Šè¿‘å¾—åˆ†è¶Šé«˜ï¼Œ5kmä»¥ä¸Šå¾—0åˆ†ï¼‰
            const distanceScore = Math.max(0, 5 - parseFloat(parking.distance)) * 20; // 0-100åˆ†

            // ä»·æ ¼å¾—åˆ†ï¼ˆä»·æ ¼è¶Šä½å¾—åˆ†è¶Šé«˜ï¼Œ20å…ƒä»¥ä¸Šå¾—0åˆ†ï¼‰
            const priceScore = Math.max(0, 20 - parking.price) * 5; // 0-100åˆ†

            // ç©ºä½ç‡å¾—åˆ†
            const availabilityRatio = parking.availableSpots / parking.totalSpots;
            const availabilityScore = availabilityRatio * 100; // 0-100åˆ†

            // åŠ æƒç»¼åˆå¾—åˆ†
            const finalScore = (
                distanceScore * weights.distance +
                priceScore * weights.price +
                availabilityScore * weights.availability
            );

            // ç”Ÿæˆæ¨èç†ç”±
            const reasons = [];
            if (distanceScore > 60) reasons.push('è·ç¦»è¿‘');
            if (priceScore > 60) reasons.push('ä»·æ ¼ä½');
            if (availabilityScore > 60) reasons.push('ç©ºä½å¤š');

            return {
                score: Math.round(finalScore),
                reasons: reasons,
                details: {
                    distance: Math.round(distanceScore),
                    price: Math.round(priceScore),
                    availability: Math.round(availabilityScore)
                }
            };
        }

        // æ˜¾ç¤ºæ™ºèƒ½æ¨èåœè½¦åœº
        function displayRecommendedParking() {
            const container = document.getElementById('recommended-parking');
            if (!container) return;

            // åŠ è½½æƒé‡é…ç½®ï¼ˆå¯ä»ç®¡ç†å‘˜é…ç½®ï¼‰
            const weights = JSON.parse(localStorage.getItem('smartparking_recommend_weights') || '{"distance":0.4,"price":0.3,"availability":0.3}');

            // ä¸ºæ¯ä¸ªåœè½¦åœºè®¡ç®—è¯„åˆ†
            const parkingWithScores = parkingData.map(parking => {
                const scoreData = calculateParkingScore(parking, weights);
                return {
                    ...parking,
                    recommendationScore: scoreData.score,
                    recommendationReasons: scoreData.reasons,
                    scoreDetails: scoreData.details
                };
            });

            // æŒ‰æ¨èåˆ†æ•°æ’åºï¼Œå–å‰6ä¸ª
            const recommended = parkingWithScores
                .sort((a, b) => b.recommendationScore - a.recommendationScore)
                .slice(0, 6);

            container.innerHTML = '';

            recommended.forEach(parking => {
                const div = document.createElement('div');
                div.className = 'bg-white rounded-xl shadow-lg overflow-hidden transform hover:scale-105 transition-all cursor-pointer relative';
                div.onclick = () => showParkingDetail(parking);

                const statusClass = parking.status === 'available' ? 'status-available' :
                                   parking.status === 'busy' ? 'status-busy' : 'status-full';
                const statusText = parking.status === 'available' ? 'ç©ºé—²' :
                                  parking.status === 'busy' ? 'ç´§å¼ ' : 'å·²æ»¡';

                // æ¨èæŒ‡æ•°å¾½ç« 
                const scoreBadgeColor = parking.recommendationScore >= 80 ? 'green' :
                                       parking.recommendationScore >= 60 ? 'blue' : 'yellow';

                div.innerHTML = `
                    <div class="absolute top-4 right-4 z-10">
                        <div class="bg-${scoreBadgeColor}-500 text-white px-3 py-1 rounded-full text-sm font-bold">
                            æ¨èæŒ‡æ•° ${parking.recommendationScore}%
                        </div>
                    </div>
                    <img src="${parking.image}" alt="${parking.name}" class="w-full h-48 object-cover">
                    <div class="p-6">
                        <div class="flex justify-between items-start mb-3">
                            <h3 class="font-semibold text-lg">${parking.name}</h3>
                            <span class="${statusClass} font-medium text-sm">${statusText}</span>
                        </div>
                        <div class="text-sm text-gray-600 mb-3">${parking.address}</div>

                        <!-- æ¨èç†ç”± -->
                        ${parking.recommendationReasons.length > 0 ? `
                            <div class="mb-3">
                                <span class="inline-block bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full mr-2">
                                    æ¨èç†ç”±ï¼š${parking.recommendationReasons.join('ã€')}
                                </span>
                            </div>
                        ` : ''}

                        <div class="flex justify-between items-center text-sm mb-3">
                            <span>ğŸ’° ${parking.price}å…ƒ/å°æ—¶</span>
                            <span>ğŸ“ ${parking.distance}km</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <div class="flex items-center">
                                <span class="text-yellow-500">â­</span>
                                <span class="ml-1 text-sm">${parking.rating}</span>
                            </div>
                            <button onclick="event.stopPropagation(); bookParkingSpot(${parking.id})"
                                    class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                ç«‹å³é¢„çº¦
                            </button>
                        </div>
                    </div>
                `;

                container.appendChild(div);
            });
        }

        // åˆ‡æ¢ç­›é€‰é¢æ¿
        function toggleFilters() {
            const panel = document.getElementById('filter-panel');
            if (panel) {
                panel.classList.toggle('hidden');
            }
        }

        // åˆ‡æ¢è§†å›¾
        function switchView(view) {
            currentView = view;
            const listBtn = document.getElementById('list-view-btn');
            const cardBtn = document.getElementById('card-view-btn');
            
            if (view === 'list') {
                listBtn.className = 'px-4 py-2 bg-blue-600 text-white rounded-lg';
                cardBtn.className = 'px-4 py-2 bg-gray-200 text-gray-700 rounded-lg';
            } else {
                listBtn.className = 'px-4 py-2 bg-gray-200 text-gray-700 rounded-lg';
                cardBtn.className = 'px-4 py-2 bg-blue-600 text-white rounded-lg';
            }
            
            displayParkingLots();
        }

        // åˆå§‹åŒ–ç­›é€‰æŒ‰é’®
        function initializeFilterButtons() {
            const filterButtons = document.querySelectorAll('.filter-button');
            filterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    const status = this.dataset.status;
                    filterParkingLots(status);
                });
            });
        }

        // ç­›é€‰åœè½¦åœº
        function filterParkingLots(status) {
            let filteredData = parkingData;
            
            if (status !== 'all') {
                filteredData = parkingData.filter(parking => parking.status === status);
            }
            
            const container = document.getElementById('parking-list');
            if (!container) return;

            container.innerHTML = '';

            filteredData.forEach(parking => {
                const parkingElement = createParkingElement(parking);
                container.appendChild(parkingElement);
            });
        }

        // æ˜¾ç¤ºåœè½¦åœºè¯¦æƒ…
        function showParkingDetail(parking) {
            const modal = document.getElementById('parking-detail-modal');
            const title = document.getElementById('modal-title');
            const content = document.getElementById('modal-content');
            
            if (modal && title && content) {
                title.textContent = parking.name;
                
                const statusClass = parking.status === 'available' ? 'status-available' :
                                   parking.status === 'busy' ? 'status-busy' : 'status-full';
                const statusText = parking.status === 'available' ? 'ç©ºé—²' :
                                  parking.status === 'busy' ? 'ç´§å¼ ' : 'å·²æ»¡';
                
                content.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <img src="${parking.image}" alt="${parking.name}" class="w-full h-48 object-cover rounded-lg">
                        </div>
                        <div>
                            <div class="mb-4">
                                <h4 class="font-semibold mb-2">åŸºæœ¬ä¿¡æ¯</h4>
                                <p class="text-sm text-gray-600 mb-1">åœ°å€: ${parking.address}</p>
                                <p class="text-sm text-gray-600 mb-1">çŠ¶æ€: <span class="${statusClass}">${statusText}</span></p>
                                <p class="text-sm text-gray-600 mb-1">ä»·æ ¼: ${parking.price}å…ƒ/å°æ—¶</p>
                                <p class="text-sm text-gray-600 mb-1">è·ç¦»: ${parking.distance}km</p>
                                <p class="text-sm text-gray-600">è¯„åˆ†: ${parking.rating} â­</p>
                            </div>
                            <div class="mb-4">
                                <h4 class="font-semibold mb-2">è½¦ä½ä¿¡æ¯</h4>
                                <p class="text-sm text-gray-600">æ€»è½¦ä½æ•°: ${parking.totalSpots}</p>
                                <p class="text-sm text-gray-600">ç©ºé—²è½¦ä½: ${parking.availableSpots}</p>
                                <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                    <div class="bg-blue-600 h-2 rounded-full" style="width: ${(parking.availableSpots / parking.totalSpots) * 100}%"></div>
                                </div>
                            </div>
                            <button onclick="bookParkingSpot(${parking.id})" 
                                    class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors">
                                ç«‹å³é¢„çº¦è½¦ä½
                            </button>
                        </div>
                    </div>
                `;
                
                modal.classList.remove('hidden');
            }
        }

        // å…³é—­åœè½¦åœºè¯¦æƒ…
        function closeParkingDetail() {
            const modal = document.getElementById('parking-detail-modal');
            if (modal) {
                modal.classList.add('hidden');
            }
        }

        // é¢„çº¦åœè½¦åœº
        function bookParkingSpot(parkingId) {
            console.log('é¢„çº¦åœè½¦åœºID:', parkingId);
            // è·³è½¬åˆ°é¢„çº¦é¡µé¢
            window.location.href = `booking.html?parkingId=${parkingId}`;
        }
    </script>
</body>
</html>