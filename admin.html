<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†å‘˜æ§åˆ¶å° - æ™ºèƒ½åœè½¦ç®¡ç†ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Noto Sans SC', sans-serif;
        }
        .gradient-text {
            background: linear-gradient(135deg, #3b82f6, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .sidebar {
            background: linear-gradient(135deg, #1e3a8a, #3b82f6);
            min-height: calc(100vh - 4rem);
        }
        .sidebar-item {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .sidebar-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        .sidebar-item.active {
            background-color: rgba(255, 255, 255, 0.2);
            border-left: 4px solid #06b6d4;
        }
        .stat-card {
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .user-card {
            transition: all 0.3s ease;
        }
        .user-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .alert-item {
            animation: slideIn 0.5s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <!-- å¯¼èˆªæ  -->
    <nav class="bg-white shadow-lg fixed w-full top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-2xl font-bold gradient-text">æ™ºèƒ½åœè½¦ç®¡ç†ç³»ç»Ÿ - ç®¡ç†å‘˜æ§åˆ¶å°</h1>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-sm text-gray-600" id="current-admin">ç®¡ç†å‘˜: ææ¬£æ…°</div>
                    <button onclick="logout()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors">
                        é€€å‡ºç™»å½•
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å†…å®¹ -->
    <div class="pt-16 flex">
        <!-- ä¾§è¾¹æ  -->
        <div class="sidebar w-64 text-white">
            <div class="p-6">
                <div class="space-y-2">
                    <div class="sidebar-item active p-3 rounded-lg" onclick="showSection('dashboard')">
                        <div class="flex items-center">
                            <span class="text-xl mr-3">ğŸ“Š</span>
                            <span>æ•°æ®ä»ªè¡¨æ¿</span>
                        </div>
                    </div>
                    <div class="sidebar-item p-3 rounded-lg" onclick="showSection('users')">
                        <div class="flex items-center">
                            <span class="text-xl mr-3">ğŸ‘¥</span>
                            <span>ç”¨æˆ·ç®¡ç†</span>
                        </div>
                    </div>
                    <div class="sidebar-item p-3 rounded-lg" onclick="showSection('parking')">
                        <div class="flex items-center">
                            <span class="text-xl mr-3">ğŸ¢</span>
                            <span>åœè½¦åœºç®¡ç†</span>
                        </div>
                    </div>
                    <div class="sidebar-item p-3 rounded-lg" onclick="showSection('bookings')">
                        <div class="flex items-center">
                            <span class="text-xl mr-3">ğŸ“…</span>
                            <span>é¢„çº¦ç®¡ç†</span>
                        </div>
                    </div>
                    <div class="sidebar-item p-3 rounded-lg" onclick="showSection('payments')">
                        <div class="flex items-center">
                            <span class="text-xl mr-3">ğŸ’³</span>
                            <span>æ”¯ä»˜ç®¡ç†</span>
                        </div>
                    </div>
                    <div class="sidebar-item p-3 rounded-lg" onclick="showSection('devices')">
                        <div class="flex items-center">
                            <span class="text-xl mr-3">ğŸ”§</span>
                            <span>è®¾å¤‡ç®¡ç†</span>
                        </div>
                    </div>
                    <div class="sidebar-item p-3 rounded-lg" onclick="showSection('alerts')">
                        <div class="flex items-center">
                            <span class="text-xl mr-3">ğŸš¨</span>
                            <span>å¼‚å¸¸å¤„ç†</span>
                        </div>
                    </div>
                    <div class="sidebar-item p-3 rounded-lg" onclick="showSection('pricing')">
                        <div class="flex items-center">
                            <span class="text-xl mr-3">ğŸ’°</span>
                            <span>æ™ºèƒ½å®šä»·</span>
                        </div>
                    </div>
                    <div class="sidebar-item p-3 rounded-lg" onclick="showSection('insights')">
                        <div class="flex items-center">
                            <span class="text-xl mr-3">ğŸ’¡</span>
                            <span>æ™ºèƒ½å»ºè®®</span>
                        </div>
                    </div>

                    <div class="sidebar-item p-3 rounded-lg" onclick="showSection('analytics')">
                        <div class="flex items-center">
                            <span class="text-xl mr-3">ğŸ¤–</span>
                            <span>æ™ºèƒ½åˆ†æ</span>
                        </div>
                    </div>

                    <div class="sidebar-item p-3 rounded-lg" onclick="showSection('settings')">
                        <div class="flex items-center">
                            <span class="text-xl mr-3">âš™ï¸</span>
                            <span>ç³»ç»Ÿè®¾ç½®</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒº -->
        <div class="flex-1 p-6">
            <!-- æ•°æ®ä»ªè¡¨æ¿ -->
            <div id="dashboard-section" class="content-section active">
                <h2 class="text-3xl font-bold mb-8 gradient-text">æ•°æ®ä»ªè¡¨æ¿</h2>
                
                <!-- ç»Ÿè®¡å¡ç‰‡ -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="stat-card bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">æ€»ç”¨æˆ·æ•°</p>
                                <p class="text-3xl font-bold text-blue-600" id="total-users">8,956</p>
                            </div>
                            <div class="text-4xl">ğŸ‘¥</div>
                        </div>
                        <div class="mt-4 text-sm text-green-600">â†‘ 12% è¾ƒä¸Šæœˆ</div>
                    </div>
                    <div class="stat-card bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">æ´»è·ƒåœè½¦åœº</p>
                                <p class="text-3xl font-bold text-green-600" id="active-parking">156</p>
                            </div>
                            <div class="text-4xl">ğŸ¢</div>
                        </div>
                        <div class="mt-4 text-sm text-green-600">â†‘ 5% è¾ƒä¸Šæœˆ</div>
                    </div>
                    <div class="stat-card bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">ä»Šæ—¥é¢„çº¦</p>
                                <p class="text-3xl font-bold text-purple-600" id="today-bookings">1,234</p>
                            </div>
                            <div class="text-4xl">ğŸ“…</div>
                        </div>
                        <div class="mt-4 text-sm text-red-600">â†“ 3% è¾ƒæ˜¨æ—¥</div>
                    </div>
                    <div class="stat-card bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">ä»Šæ—¥æ”¶å…¥</p>
                                <p class="text-3xl font-bold text-red-600" id="today-revenue">Â¥45,678</p>
                            </div>
                            <div class="text-4xl">ğŸ’°</div>
                        </div>
                        <div class="mt-4 text-sm text-green-600">â†‘ 18% è¾ƒæ˜¨æ—¥</div>
                    </div>
                </div>

                <!-- å›¾è¡¨åŒºåŸŸ -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-semibold mb-4">ç”¨æˆ·å¢é•¿è¶‹åŠ¿</h3>
                        <div id="user-growth-chart" style="height: 300px;"></div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-semibold mb-4">æ”¶å…¥åˆ†æ</h3>
                        <div id="revenue-chart" style="height: 300px;"></div>
                    </div>
                </div>
            </div>

            <!-- ç”¨æˆ·ç®¡ç† -->
            <div id="users-section" class="content-section">
                <h2 class="text-3xl font-bold mb-8 gradient-text">ç”¨æˆ·ç®¡ç†</h2>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <div class="flex items-center space-x-4">
                            <input type="text" placeholder="æœç´¢ç”¨æˆ·..." class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                            <button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">æœç´¢</button>
                        </div>
                        <button onclick="showAddUserModal()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors">
                            æ·»åŠ ç”¨æˆ·
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ç”¨æˆ·ID</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ç”¨æˆ·å</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ‰‹æœºå·</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ³¨å†Œæ—¶é—´</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ç”¨æˆ·ç±»å‹</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">çŠ¶æ€</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="users-table" class="bg-white divide-y divide-gray-200">
                                <!-- ç”¨æˆ·åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- åœè½¦åœºç®¡ç† -->
            <div id="parking-section" class="content-section">
                <h2 class="text-3xl font-bold mb-8 gradient-text">åœè½¦åœºç®¡ç†</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="parking-list">
                    <!-- åœè½¦åœºå¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <!-- é¢„çº¦ç®¡ç† -->
            <div id="bookings-section" class="content-section">
                <h2 class="text-3xl font-bold mb-8 gradient-text">é¢„çº¦ç®¡ç†</h2>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">é¢„çº¦ID</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ç”¨æˆ·</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">åœè½¦åœº</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">é¢„çº¦æ—¶é—´</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">çŠ¶æ€</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="bookings-table" class="bg-white divide-y divide-gray-200">
                                <!-- é¢„çº¦åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- æ”¯ä»˜ç®¡ç† -->
            <div id="payments-section" class="content-section">
                <h2 class="text-3xl font-bold mb-8 gradient-text">æ”¯ä»˜ç®¡ç†</h2>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">äº¤æ˜“ID</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ç”¨æˆ·</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">åœè½¦åœº</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">é‡‘é¢</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ”¯ä»˜æ–¹å¼</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ—¶é—´</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">çŠ¶æ€</th>
                                </tr>
                            </thead>
                            <tbody id="payments-table" class="bg-white divide-y divide-gray-200">
                                <!-- æ”¯ä»˜åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- è®¾å¤‡ç®¡ç† -->
            <div id="devices-section" class="content-section">
                <h2 class="text-3xl font-bold mb-8 gradient-text">è®¾å¤‡ç®¡ç†</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="devices-list">
                    <!-- è®¾å¤‡å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <!-- å¼‚å¸¸å¤„ç† -->
            <div id="alerts-section" class="content-section">
                <h2 class="text-3xl font-bold mb-8 gradient-text">å¼‚å¸¸å¤„ç†</h2>
                <div class="space-y-4" id="alerts-list">
                    <!-- å¼‚å¸¸åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <!-- æ™ºèƒ½å®šä»· -->
            <div id="pricing-section" class="content-section">
                <h2 class="text-3xl font-bold mb-8 gradient-text">æ™ºèƒ½åŠ¨æ€å®šä»·</h2>

                <!-- å®šä»·é…ç½® -->
                <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                    <h3 class="text-xl font-semibold mb-6">åŠ¨æ€å®šä»·é…ç½®</h3>

                    <!-- åŸºç¡€ä»·æ ¼é…ç½® -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">åŸºç¡€å•ä»·ï¼ˆå…ƒ/å°æ—¶ï¼‰</label>
                            <input type="number" id="base-price" value="5" min="1" max="50" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" onchange="savePricingConfig()">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">é«˜å³°æ—¶æ®µç³»æ•°</label>
                            <input type="number" id="peak-factor" value="1.5" min="1" max="3" step="0.1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" onchange="savePricingConfig()">
                            <p class="text-xs text-gray-500 mt-1">7:00-9:00, 17:00-19:00</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ä½è°·æ—¶æ®µç³»æ•°</label>
                            <input type="number" id="off-peak-factor" value="0.8" min="0.5" max="1" step="0.1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" onchange="savePricingConfig()">
                            <p class="text-xs text-gray-500 mt-1">22:00-6:00</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">èŠ‚å‡æ—¥ç³»æ•°</label>
                            <input type="number" id="holiday-factor" value="1.2" min="1" max="2" step="0.1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" onchange="savePricingConfig()">
                            <p class="text-xs text-gray-500 mt-1">å‘¨æœ«åŠæ³•å®šèŠ‚å‡æ—¥</p>
                        </div>
                    </div>

                    <div class="bg-blue-50 rounded-lg p-4 mb-6">
                        <h4 class="text-sm font-medium text-blue-900 mb-2">å®šä»·å…¬å¼è¯´æ˜</h4>
                        <p class="text-xs text-blue-800 mb-1">å®æ—¶ä»·æ ¼ = åŸºç¡€å•ä»· Ã— æ—¶æ®µç³»æ•° Ã— èŠ‚å‡æ—¥ç³»æ•°</p>
                        <p class="text-xs text-blue-600">ç¤ºä¾‹ï¼šåŸºç¡€ä»·5å…ƒ Ã— é«˜å³°1.5 Ã— èŠ‚å‡æ—¥1.2 = 9å…ƒ/å°æ—¶</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">é€‰æ‹©åœè½¦åœº</label>
                            <select id="parking-lot-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                                <option value="P001">æœºç”µå­¦é¦†åœè½¦åœºP001</option>
                                <option value="P002">å»ºç­‘å­¦é¦†åœè½¦åœºP002</option>
                                <option value="P003">å¤§æˆåœè½¦åœºP003</option>
                                <option value="P004">é‡‡çŸ¿å­¦é¦†åœè½¦åœºP004</option>
                                <option value="P005">é€¸å¤«åœè½¦åœºP005</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">é€‰æ‹©æ—¶é—´</label>
                            <input type="datetime-local" id="time-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">åœè½¦æ—¶é•¿ï¼ˆå°æ—¶ï¼‰</label>
                            <select id="duration-select" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                                <option value="1">1å°æ—¶</option>
                                <option value="2" selected>2å°æ—¶</option>
                                <option value="3">3å°æ—¶</option>
                                <option value="6">6å°æ—¶</option>
                                <option value="12">12å°æ—¶</option>
                            </select>
                        </div>
                    </div>
                    <div class="mt-6">
                        <button onclick="updatePriceChart()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            åˆ·æ–°ä»·æ ¼
                        </button>
                    </div>
                </div>

                <!-- å½“å‰ä»·æ ¼ä¿¡æ¯ -->
                <div id="current-price-info" class="mb-8">
                    <!-- åŠ¨æ€ç”Ÿæˆå†…å®¹ -->
                </div>

                <!-- ä»·æ ¼è¶‹åŠ¿å›¾ -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-semibold mb-6">24å°æ—¶ä»·æ ¼è¶‹åŠ¿</h3>
                    <div id="dynamic-price-chart" style="height: 400px;"></div>
                </div>
            </div>

            <!-- æ™ºèƒ½å»ºè®® -->
            <div id="insights-section" class="content-section">
                <h2 class="text-3xl font-bold mb-8 gradient-text">æ™ºèƒ½æ•°æ®åˆ†æä¸å»ºè®®</h2>

                <!-- æ™ºèƒ½å»ºè®®é¢æ¿ -->
                <div id="smart-insights" class="mb-8">
                    <h3 class="text-2xl font-semibold mb-4">ğŸ’¡ ä»Šæ—¥æ™ºèƒ½å»ºè®®</h3>
                    <div id="smart-insights-container">
                        <!-- åŠ¨æ€ç”Ÿæˆå»ºè®®å¡ç‰‡ -->
                    </div>
                </div>

                <!-- ç»è¥æŒ‡æ ‡æ¦‚è§ˆ -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">å¹³å‡åˆ©ç”¨ç‡</p>
                                <p class="text-3xl font-bold text-blue-600" id="avg-utilization">65.3%</p>
                            </div>
                            <div class="text-4xl">ğŸš—</div>
                        </div>
                        <div class="mt-4 text-sm text-yellow-600">â†” ä¸ä¸Šå‘¨æŒå¹³</div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">é¢„è®¡å¢æ”¶æ½œåŠ›</p>
                                <p class="text-3xl font-bold text-green-600" id="revenue-potential">Â¥6.0K</p>
                            </div>
                            <div class="text-4xl">ğŸ’°</div>
                        </div>
                        <div class="mt-4 text-sm text-green-600">â†‘ 13.3% æ—¥æ”¶å…¥</div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">ç”¨æˆ·æ»¡æ„åº¦</p>
                                <p class="text-3xl font-bold text-purple-600" id="satisfaction-rate">4.6/5</p>
                            </div>
                            <div class="text-4xl">â­</div>
                        </div>
                        <div class="mt-4 text-sm text-green-600">â†‘ 0.2 è¾ƒä¸Šæœˆ</div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">è®¾å¤‡æ­£å¸¸ç‡</p>
                                <p class="text-3xl font-bold text-red-600" id="device-uptime">92.5%</p>
                            </div>
                            <div class="text-4xl">ğŸ”§</div>
                        </div>
                        <div class="mt-4 text-sm text-red-600">â†“ 2ä¸ªè®¾å¤‡æ•…éšœ</div>
                    </div>
                </div>
            </div>

            <!-- ===== PHASE 4: æ™ºèƒ½åˆ†ææ ‡ç­¾é¡µï¼ˆæ–°å¢ï¼‰ ===== -->
            <div id="analytics-section" class="content-section">
                <h2 class="text-3xl font-bold mb-8 gradient-text">ğŸ¤– æ™ºèƒ½æ•°æ®åˆ†æ</h2>

                <!-- 15å¤©é¢„æµ‹ -->
                <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                    <h3 class="text-2xl font-bold mb-6">ğŸ“Š 15å¤©éœ€æ±‚é¢„æµ‹ï¼ˆåŸºäºæ—¶é—´åºåˆ—åˆ†æï¼‰</h3>
                    <div id="demand-prediction-chart" style="height: 400px;"></div>
                    <div class="mt-4 p-4 bg-blue-50 rounded">
                        <p class="text-sm text-blue-800">
                            <strong>é¢„æµ‹è¯´æ˜ï¼š</strong>åŸºäºå†å²æ•°æ®çš„æ—¶é—´åºåˆ—åˆ†æï¼Œé‡‡ç”¨3æ—¥ç§»åŠ¨å¹³å‡ç®—æ³•ï¼Œè€ƒè™‘æ˜ŸæœŸå‘¨æœŸæ€§å’Œè¶‹åŠ¿å˜åŠ¨ã€‚
                        </p>
                    </div>
                </div>

                <!-- å¼‚å¸¸æ£€æµ‹ -->
                <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                    <h3 class="text-2xl font-bold mb-6">âš ï¸ æ™ºèƒ½å¼‚å¸¸æ£€æµ‹ï¼ˆåŸºäº3ÏƒåŸåˆ™ï¼‰</h3>
                    <div id="anomaly-detection-chart" style="height: 350px;"></div>
                    <div class="mt-6" id="anomaly-alerts">
                        <!-- å¼‚å¸¸è­¦æŠ¥å°†åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>

                <!-- RFMç”¨æˆ·åˆ†æ -->
                <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                    <h3 class="text-2xl font-bold mb-6">ğŸ‘¥ RFMç”¨æˆ·åˆ†ææ¨¡å‹</h3>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div id="rfm-analysis-chart" style="height: 350px;"></div>
                        <div id="rfm-cluster-table">
                            <h4 class="font-bold text-lg mb-4">ç”¨æˆ·åˆ†å±‚ç»“æœ</h4>
                            <!-- è¡¨æ ¼å°†åŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>

                <!-- æ™ºèƒ½è¿è¥å»ºè®® -->
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-8 mb-8">
                    <h3 class="text-2xl font-bold mb-6">ğŸ’¡ æ™ºèƒ½è¿è¥å»ºè®®ï¼ˆåŸºäºæ•°æ®åˆ†æï¼‰</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="smart-recommendations">
                        <!-- å»ºè®®å¡ç‰‡å°†åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>

                <!-- é¢„æµ‹å‡†ç¡®ç‡ -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-2xl font-bold mb-6">ğŸ¯ é¢„æµ‹å‡†ç¡®ç‡è¯„ä¼°</h3>
                    <div id="prediction-accuracy-chart" style="height: 300px;"></div>
                    <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                        <div class="bg-green-50 p-4 rounded">
                            <div class="text-2xl font-bold text-green-600">87.3%</div>
                            <div class="text-sm text-gray-600">15å¤©é¢„æµ‹å‡†ç¡®ç‡</div>
                        </div>
                        <div class="bg-blue-50 p-4 rounded">
                            <div class="text-2xl font-bold text-blue-600">92.1%</div>
                            <div class="text-sm text-gray-600">å¼‚å¸¸æ£€æµ‹å¬å›ç‡</div>
                        </div>
                        <div class="bg-purple-50 p-4 rounded">
                            <div class="text-2xl font-bold text-purple-600">94.7%</div>
                            <div class="text-sm text-gray-600">RFMåˆ†æå‡†ç¡®ç‡</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç³»ç»Ÿè®¾ç½® -->
            <div id="settings-section" class="content-section">
                <h2 class="text-3xl font-bold mb-8 gradient-text">ç³»ç»Ÿè®¾ç½®</h2>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="space-y-6">
                        <div>
                            <h3 class="text-lg font-semibold mb-4">åŸºæœ¬è®¾ç½®</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ç³»ç»Ÿåç§°</label>
                                    <input type="text" value="æ™ºèƒ½åœè½¦ç®¡ç†ç³»ç»Ÿ" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ç³»ç»Ÿç‰ˆæœ¬</label>
                                    <input type="text" value="v2.1.0" readonly class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100">
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold mb-4">æ”¯ä»˜è®¾ç½®</h3>
                            <div class="space-y-3">
                                <label class="flex items-center">
                                    <input type="checkbox" checked class="mr-2">
                                    <span>å¯ç”¨å¾®ä¿¡æ”¯ä»˜</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" checked class="mr-2">
                                    <span>å¯ç”¨æ”¯ä»˜å®æ”¯ä»˜</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2">
                                    <span>å¯ç”¨é“¶è¡Œå¡æ”¯ä»˜</span>
                                </label>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold mb-4">é€šçŸ¥è®¾ç½®</h3>
                            <div class="space-y-3">
                                <label class="flex items-center">
                                    <input type="checkbox" checked class="mr-2">
                                    <span>å¯ç”¨çŸ­ä¿¡é€šçŸ¥</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" checked class="mr-2">
                                    <span>å¯ç”¨é‚®ä»¶é€šçŸ¥</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" checked class="mr-2">
                                    <span>å¯ç”¨æ¨é€é€šçŸ¥</span>
                                </label>
                            </div>
                        </div>

                        <!-- æ–‡ä»¶ä¸Šä¼ é¢„è§ˆåŠŸèƒ½ -->
                        <div class="border-t pt-6">
                            <h3 class="text-lg font-semibold mb-4 text-blue-800">æ–‡ä»¶ä¸Šä¼ é¢„è§ˆï¼ˆå‰ç«¯æ¼”ç¤ºï¼‰</h3>

                            <!-- åœè½¦åœºå›¾ç‰‡ä¸Šä¼  -->
                            <div class="mb-6">
                                <label class="block text-sm font-medium text-gray-700 mb-2">åœè½¦åœºå›¾ç‰‡ä¸Šä¼ </label>
                                <div class="flex items-center space-x-4">
                                    <input type="file" id="parking-image-upload" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                                </div>
                                <div id="parking-image-preview" class="mt-4 hidden">
                                    <p class="text-sm text-gray-600 mb-2">å›¾ç‰‡é¢„è§ˆï¼š</p>
                                    <img id="parking-preview-img" class="max-w-xs rounded-lg shadow-md border border-gray-200">
                                    <p class="text-xs text-gray-500 mt-2">ğŸ’¡ æç¤ºï¼šå½“å‰ç‰ˆæœ¬ä»…æ”¯æŒæœ¬åœ°é¢„è§ˆï¼ˆä½¿ç”¨ URL.createObjectURLï¼‰ï¼Œæœªä¸Šä¼ è‡³æœåŠ¡å™¨ã€‚</p>
                                </div>
                            </div>

                            <!-- è®¾å¤‡å›¾ç‰‡ä¸Šä¼  -->
                            <div class="mb-6">
                                <label class="block text-sm font-medium text-gray-700 mb-2">è®¾å¤‡å›¾ç‰‡ä¸Šä¼ </label>
                                <div class="flex items-center space-x-4">
                                    <input type="file" id="device-image-upload" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                                </div>
                                <div id="device-image-preview" class="mt-4 hidden">
                                    <p class="text-sm text-gray-600 mb-2">å›¾ç‰‡é¢„è§ˆï¼š</p>
                                    <img id="device-preview-img" class="max-w-xs rounded-lg shadow-md border border-gray-200">
                                    <p class="text-xs text-gray-500 mt-2">ğŸ’¡ æç¤ºï¼šå¯æ‰¹é‡é€‰æ‹©å¤šå¼ å›¾ç‰‡ï¼Œå½“å‰ä»…æ¼”ç¤ºå•å¼ é¢„è§ˆã€‚</p>
                                </div>
                            </div>

                            <!-- èµ„æºè½®æ’­å›¾ä¸Šä¼  -->
                            <div class="mb-6">
                                <label class="block text-sm font-medium text-gray-700 mb-2">èµ„æºè½®æ’­å›¾ä¸Šä¼ </label>
                                <div class="flex items-center space-x-4">
                                    <input type="file" id="banner-image-upload" accept="image/*" multiple class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                                </div>
                                <div id="banner-image-preview" class="mt-4 hidden">
                                    <p class="text-sm text-gray-600 mb-2">è½®æ’­å›¾é¢„è§ˆï¼š</p>
                                    <div id="banner-preview-container" class="grid grid-cols-3 gap-4">
                                        <!-- å¤šå¼ å›¾ç‰‡é¢„è§ˆ -->
                                    </div>
                                    <p class="text-xs text-gray-500 mt-2">ğŸ’¡ æç¤ºï¼šæ”¯æŒå¤šé€‰ä¸Šä¼ ï¼Œå¯ç”¨äºé¦–é¡µè½®æ’­å›¾å±•ç¤ºã€‚</p>
                                </div>
                            </div>

                            <div class="bg-blue-50 p-4 rounded-lg mb-4">
                                <h4 class="font-medium text-blue-900 mb-2">è®¾è®¡è¯´æ˜</h4>
                                <ul class="text-sm text-blue-800 space-y-1">
                                    <li>â€¢ æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ å‡ä½¿ç”¨ &lt;input type="file"&gt; å®ç°</li>
                                    <li>â€¢ é€šè¿‡ URL.createObjectURL() ç”Ÿæˆä¸´æ—¶é¢„è§ˆåœ°å€</li>
                                    <li>â€¢ é¢„è§ˆå›¾ç‰‡ä¸æŒä¹…åŒ–ï¼Œåˆ·æ–°é¡µé¢åæ¶ˆå¤±</li>
                                    <li>â€¢ æ¥å…¥åç«¯ API åï¼Œå¯æ‰©å±•ä¸ºçœŸå®å­˜å‚¨ï¼ˆé˜¿é‡Œäº‘OSSã€ä¸ƒç‰›äº‘ç­‰ï¼‰</li>
                                </ul>
                            </div>
                        </div>

                        <div class="flex justify-end">
                            <button class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                ä¿å­˜è®¾ç½®
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="mockData.js"></script>
    <script src="main.js"></script>
    <script src="smart-functions.js"></script>
    <script src="task5-insights.js"></script>
    <script>
        // ç®¡ç†å‘˜æ§åˆ¶å°é¡µé¢ç‰¹å®šåŠŸèƒ½
        let currentSection = 'dashboard';
        let usersData = [];
        let parkingData = [];
        let bookingsData = [];
        let paymentsData = [];
        let devicesData = [];
        let alertsData = [];

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            generateSampleData();
            initializeDashboard();
            updateAdminDisplayName(); // æ›´æ–°å³ä¸Šè§’ç®¡ç†å‘˜åç§°
            displayUsers();
            displayParkingLots();
            displayBookings();
            displayPayments();
            displayDevices();
            displayAlerts();

            // åˆå§‹åŒ–æ—¶é—´é€‰æ‹©å™¨ä¸ºå½“å‰æ—¶é—´
            const now = new Date();
            const timeString = now.toISOString().slice(0, 16);
            const timeSelect = document.getElementById('time-select');
            if (timeSelect) {
                timeSelect.value = timeString;
            }

            // åˆå§‹åŒ–æ™ºèƒ½å»ºè®®ï¼ˆåœ¨dashboardåŠ è½½æ—¶æ˜¾ç¤ºï¼‰
            if (typeof initializeSmartInsights === 'function') {
                initializeSmartInsights();
            }

            // åˆå§‹åŒ–æ™ºèƒ½å®šä»·å›¾è¡¨
            updatePriceChart();

            // æ¯10ç§’æ›´æ–°ä»·æ ¼å›¾è¡¨ï¼ˆæ¨¡æ‹Ÿå®æ—¶æ•°æ®ï¼‰
            setInterval(() => {
                if (currentSection === 'pricing') {
                    updatePriceChart();
                }
            }, 10000);
        });

        // ç”Ÿæˆç¤ºä¾‹æ•°æ®
        function generateSampleData() {
            // ç”¨æˆ·æ•°æ®ï¼ˆåŒ…å«åˆå§‹ç®¡ç†å‘˜ï¼‰
            usersData = [
                // åˆå§‹ç®¡ç†å‘˜è´¦å·ï¼ˆæœ‰adminæ ‡å¿—ï¼‰
                { id: 1001, username: 'ææ¬£æ…°', phone: '13800138001', email: 'li@example.com', registerTime: '2023-01-15 10:30:00', status: 'active', vehicleCount: 0, admin: true },
                { id: 1002, username: 'æ¨ä½³çƒ¨', phone: '13900139002', email: 'yang@example.com', registerTime: '2023-01-15 10:30:00', status: 'active', vehicleCount: 0, admin: true },
                { id: 1003, username: 'å»–å¤©ç¿', phone: '13700137003', email: 'liao@example.com', registerTime: '2023-01-15 10:30:00', status: 'active', vehicleCount: 0, admin: true },
                { id: 1004, username: 'å¸ˆæå®‡è¾°', phone: '13600136004', email: 'shi@example.com', registerTime: '2023-01-15 10:30:00', status: 'active', vehicleCount: 0, admin: true },
                // æ™®é€šç”¨æˆ·è´¦å·
                { id: 1005, username: 'å¼ ä¸‰', phone: '13500135005', email: 'zhang@example.com', registerTime: '2024-01-15 10:30:00', status: 'active', vehicleCount: 2, admin: false },
                { id: 1006, username: 'æå››', phone: '13400134006', email: 'li2@example.com', registerTime: '2024-02-20 14:20:00', status: 'active', vehicleCount: 1, admin: false },
                { id: 1007, username: 'ç‹äº”', phone: '13300133007', email: 'wang@example.com', registerTime: '2024-03-10 09:15:00', status: 'inactive', vehicleCount: 3, admin: false },
                { id: 1008, username: 'èµµå…­', phone: '13200132008', email: 'zhao@example.com', registerTime: '2024-03-25 16:45:00', status: 'active', vehicleCount: 1, admin: false },
                { id: 1009, username: 'å­™ä¸ƒ', phone: '13100131009', email: 'sun@example.com', registerTime: '2024-04-05 11:30:00', status: 'active', vehicleCount: 2, admin: false }
            ];

            // åœè½¦åœºæ•°æ®
            parkingData = [
                { id: 1, name: 'æœºç”µå­¦é¦†åœè½¦åœº', address: 'æ²ˆé˜³å¸‚å’Œå¹³åŒºä¸œåŒ—å¤§å­¦å—æ¹–æ ¡åŒºæœºç”µå­¦é¦†', totalSpots: 500, availableSpots: 120, price: 8, status: 'normal', manager: 'å¼ ç»ç†', contact: '010-12345678' },
                { id: 2, name: 'å»ºç­‘å­¦é¦†åœè½¦åœº', address: 'æ²ˆé˜³å¸‚å’Œå¹³åŒºä¸œåŒ—å¤§å­¦å—æ¹–æ ¡åŒºå»ºç­‘å­¦é¦†', totalSpots: 800, availableSpots: 45, price: 12, status: 'busy', manager: 'æç»ç†', contact: '010-23456789' },
                { id: 3, name: 'å¤§æˆåœè½¦åœº', address: 'æ²ˆé˜³å¸‚å’Œå¹³åŒºä¸œåŒ—å¤§å­¦å—æ¹–æ ¡åŒºå¤§æˆæ•™å­¦æ¥¼', totalSpots: 400, availableSpots: 200, price: 10, status: 'normal', manager: 'ç‹ç»ç†', contact: '010-34567890' },
                { id: 4, name: 'é€¸å¤«åœè½¦åœº', address: 'æ²ˆé˜³å¸‚å’Œå¹³åŒºä¸œåŒ—å¤§å­¦å—æ¹–æ ¡åŒºé€¸å¤«æ•™å­¦æ¥¼', totalSpots: 600, availableSpots: 80, price: 6, status: 'busy', manager: 'èµµç»ç†', contact: '010-45678901' },
                { id: 5, name: 'ä½•ä¸–ç¤¼åœè½¦åœº', address: 'æ²ˆé˜³å¸‚å’Œå¹³åŒºä¸œåŒ—å¤§å­¦å—æ¹–æ ¡åŒºä½•ä¸–ç¤¼æ•™å­¦æ¥¼', totalSpots: 650, availableSpots: 150, price: 11, status: 'normal', manager: 'å­™ç»ç†', contact: '010-56789012' }
            ];

            // é¢„çº¦æ•°æ®
            bookingsData = [
                { id: 2001, userId: 1001, username: 'å¼ ä¸‰', parkingId: 1, parkingName: 'æœºç”µå­¦é¦†åœè½¦åœº', bookingTime: '2024-11-15 09:00-10:00', status: 'confirmed', createTime: '2024-11-14 20:30:00' },
                { id: 2002, userId: 1002, username: 'æå››', parkingId: 2, parkingName: 'å»ºç­‘å­¦é¦†åœè½¦åœº', bookingTime: '2024-11-15 14:00-15:00', status: 'pending', createTime: '2024-11-14 18:45:00' },
                { id: 2003, userId: 1003, username: 'ç‹äº”', parkingId: 3, parkingName: 'å¤§æˆåœè½¦åœº', bookingTime: '2024-11-16 10:00-11:00', status: 'cancelled', createTime: '2024-11-13 16:20:00' },
                { id: 2004, userId: 1004, username: 'èµµå…­', parkingId: 4, parkingName: 'é€¸å¤«åœè½¦åœº', bookingTime: '2024-11-16 15:00-16:00', status: 'confirmed', createTime: '2024-11-13 14:10:00' },
                { id: 2005, userId: 1005, username: 'å­™ä¸ƒ', parkingId: 5, parkingName: 'ä½•ä¸–ç¤¼åœè½¦åœº', bookingTime: '2024-11-17 11:00-12:00', status: 'completed', createTime: '2024-11-12 12:30:00' }
            ];

            // æ”¯ä»˜æ•°æ®
            paymentsData = [
                { id: 3001, userId: 1001, username: 'å¼ ä¸‰', parkingName: 'æœºç”µå­¦é¦†åœè½¦åœº', amount: 16.00, paymentMethod: 'å¾®ä¿¡æ”¯ä»˜', paymentTime: '2024-11-10 11:35:00', status: 'completed' },
                { id: 3002, userId: 1002, username: 'æå››', parkingName: 'å»ºç­‘å­¦é¦†åœè½¦åœº', amount: 24.00, paymentMethod: 'æ”¯ä»˜å®', paymentTime: '2024-11-09 16:25:00', status: 'completed' },
                { id: 3003, userId: 1003, username: 'ç‹äº”', parkingName: 'å¤§æˆåœè½¦åœº', amount: 20.00, paymentMethod: 'é“¶è¡Œå¡', paymentTime: '2024-11-08 21:50:00', status: 'completed' },
                { id: 3004, userId: 1004, username: 'èµµå…­', parkingName: 'é€¸å¤«åœè½¦åœº', amount: 30.00, paymentMethod: 'å¾®ä¿¡æ”¯ä»˜', paymentTime: '2024-11-07 12:05:00', status: 'completed' },
                { id: 3005, userId: 1005, username: 'å­™ä¸ƒ', parkingName: 'ä½•ä¸–ç¤¼åœè½¦åœº', amount: 18.00, paymentMethod: 'æ”¯ä»˜å®', paymentTime: '2024-11-06 14:15:00', status: 'completed' }
            ];

            // è®¾å¤‡æ•°æ®
            devicesData = [
                { id: 4001, name: 'å…¥å£é“é—¸-æœºç”µå­¦é¦†', location: 'æœºç”µå­¦é¦†åœè½¦åœº', type: 'barrier', status: 'online', lastMaintenance: '2024-10-15', nextMaintenance: '2024-11-15' },
                { id: 4002, name: 'å‡ºå£é“é—¸-æœºç”µå­¦é¦†', location: 'æœºç”µå­¦é¦†åœè½¦åœº', type: 'barrier', status: 'online', lastMaintenance: '2024-10-15', nextMaintenance: '2024-11-15' },
                { id: 4003, name: 'è½¦ç‰Œè¯†åˆ«æ‘„åƒå¤´-å»ºç­‘å­¦é¦†', location: 'å»ºç­‘å­¦é¦†åœè½¦åœº', type: 'camera', status: 'offline', lastMaintenance: '2024-09-20', nextMaintenance: '2024-11-20' },
                { id: 4004, name: 'æ”¯ä»˜ç»ˆç«¯-å¤§æˆåœè½¦åœº', location: 'å¤§æˆåœè½¦åœº', type: 'payment', status: 'maintenance', lastMaintenance: '2024-11-01', nextMaintenance: '2024-12-01' },
                { id: 4005, name: 'è½¦ä½æ£€æµ‹å™¨-é€¸å¤«åœè½¦åœº', location: 'é€¸å¤«åœè½¦åœº', type: 'sensor', status: 'online', lastMaintenance: '2024-10-10', nextMaintenance: '2024-11-10' }
            ];

            // å¼‚å¸¸æ•°æ®
            alertsData = [
                { id: 5001, type: 'device_offline', title: 'è®¾å¤‡ç¦»çº¿è­¦å‘Š', description: 'å»ºç­‘å­¦é¦†åœè½¦åœºè½¦ç‰Œè¯†åˆ«æ‘„åƒå¤´ç¦»çº¿è¶…è¿‡30åˆ†é’Ÿ', severity: 'high', time: '2024-11-10 14:30:00', status: 'unresolved' },
                { id: 5002, type: 'payment_error', title: 'æ”¯ä»˜å¼‚å¸¸', description: 'å¤§æˆåœè½¦åœºæ”¯ä»˜ç»ˆç«¯å‡ºç°æ•…éšœ', severity: 'medium', time: '2024-11-10 13:45:00', status: 'processing' },
                { id: 5003, type: 'overcrowding', title: 'è½¦ä½æ‹¥æŒ¤è­¦å‘Š', description: 'é€¸å¤«åœè½¦åœºä½¿ç”¨ç‡è¶…è¿‡90%', severity: 'low', time: '2024-11-10 12:20:00', status: 'resolved' },
                { id: 5004, type: 'network_error', title: 'ç½‘ç»œè¿æ¥å¼‚å¸¸', description: 'ä½•ä¸–ç¤¼åœè½¦åœºç½‘ç»œè¿æ¥ä¸ç¨³å®š', severity: 'medium', time: '2024-11-10 11:15:00', status: 'resolved' },
                { id: 5005, type: 'system_maintenance', title: 'ç³»ç»Ÿç»´æŠ¤æé†’', description: 'ç³»ç»Ÿå°†äºä»Šæ™š23:00-24:00è¿›è¡Œä¾‹è¡Œç»´æŠ¤', severity: 'low', time: '2024-11-09 16:00:00', status: 'resolved' }
            ];
        }

        // åˆå§‹åŒ–ä»ªè¡¨æ¿
        function initializeDashboard() {
            // åˆå§‹åŒ–å›¾è¡¨
            const userGrowthChart = echarts.init(document.getElementById('user-growth-chart'));
            const userGrowthOption = {
                tooltip: {
                    trigger: 'axis'
                },
                xAxis: {
                    type: 'category',
                    data: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ']
                },
                yAxis: {
                    type: 'value'
                },
                series: [
                    {
                        name: 'æ–°å¢ç”¨æˆ·',
                        data: [820, 932, 901, 934, 1290, 1330, 1320, 1450, 1520, 1380, 1620],
                        type: 'line',
                        smooth: true,
                        itemStyle: {
                            color: '#3b82f6'
                        }
                    }
                ]
            };
            userGrowthChart.setOption(userGrowthOption);

            const revenueChart = echarts.init(document.getElementById('revenue-chart'));
            const revenueOption = {
                tooltip: {
                    trigger: 'axis'
                },
                xAxis: {
                    type: 'category',
                    data: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ']
                },
                yAxis: {
                    type: 'value',
                    axisLabel: {
                        formatter: 'Â¥{value}'
                    }
                },
                series: [
                    {
                        name: 'æ”¶å…¥',
                        data: [32000, 28000, 45000, 38000, 52000, 48000, 60000, 55000, 42000, 38000, 45678],
                        type: 'bar',
                        itemStyle: {
                            color: '#10b981'
                        }
                    }
                ]
            };
            revenueChart.setOption(revenueOption);

            // å“åº”å¼å›¾è¡¨
            window.addEventListener('resize', function() {
                userGrowthChart.resize();
                revenueChart.resize();
            });
        }

        // æ˜¾ç¤ºç”¨æˆ·åˆ—è¡¨
        function displayUsers() {
            const container = document.getElementById('users-table');
            if (!container) return;

            container.innerHTML = '';

            // ç»Ÿè®¡ç®¡ç†å‘˜æ€»æ•°å’Œæ³¨å†Œç”¨æˆ·æ€»æ•°
            const adminCount = usersData.filter(user => user.admin).length;
            const userCount = usersData.filter(user => !user.admin).length;

            // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
            const existingStats = document.getElementById('user-stats');
            if (!existingStats) {
                const statsContainer = document.createElement('div');
                statsContainer.id = 'user-stats';
                statsContainer.className = 'mb-6 bg-blue-50 rounded-lg p-4';
                statsContainer.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="text-center">
                            <div class="text-3xl font-bold text-red-600">${adminCount}</div>
                            <div class="text-sm text-gray-600">ç®¡ç†å‘˜äººæ•°</div>
                        </div>
                        <div class="text-center">
                            <div class="text-3xl font-bold text-green-600">${userCount}</div>
                            <div class="text-sm text-gray-600">æ³¨å†Œç”¨æˆ·æ•°</div>
                        </div>
                    </div>
                `;
                container.parentElement.parentElement.parentElement.insertBefore(
                    statsContainer,
                    container.parentElement.parentElement
                );
            }

            // æŒ‰ç®¡ç†å‘˜åœ¨å‰æ’åº
            const sortedUsers = [...usersData].sort((a, b) => {
                if (a.admin && !b.admin) return -1;
                if (!a.admin && b.admin) return 1;
                return 0;
            });

            sortedUsers.forEach(user => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-50';

                const statusClass = user.status === 'active' ? 'text-green-600' : 'text-gray-600';
                const statusText = user.status === 'active' ? 'æ­£å¸¸' : 'ç¦ç”¨';
                const userType = user.admin ? 'ç®¡ç†å‘˜' : 'æ™®é€šç”¨æˆ·';
                const userTypeClass = user.admin ? 'text-red-600 font-bold' : 'text-blue-600';

                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${user.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${user.username}
                        ${user.admin ? '<span class="ml-2 px-2 py-1 bg-red-100 text-red-700 rounded-full text-xs font-bold">ç®¡ç†å‘˜</span>' : ''}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${user.phone}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${user.registerTime}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${userTypeClass} font-medium">${userType}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${statusClass} font-medium">${statusText}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        ${user.admin ? '' : `<button onclick="editUser(${user.id})" class="text-blue-600 hover:text-blue-900 mr-3">ç¼–è¾‘</button>`}
                        <button onclick="toggleUserStatus(${user.id})" class="${user.admin ? 'text-gray-400 cursor-not-allowed' : 'text-red-600 hover:text-red-900'}">${user.status === 'active' ? 'ç¦ç”¨' : 'å¯ç”¨'}</button>
                    </td>
                `;

                container.appendChild(tr);
            });
        }

        // æ˜¾ç¤ºåœè½¦åœºåˆ—è¡¨
        function displayParkingLots() {
            const container = document.getElementById('parking-list');
            if (!container) return;

            container.innerHTML = '';

            parkingData.forEach(parking => {
                const div = document.createElement('div');
                div.className = 'bg-white rounded-xl shadow-lg p-6';

                const statusClass = parking.status === 'normal' ? 'text-green-600' :
                                   parking.status === 'busy' ? 'text-yellow-600' : 'text-red-600';
                const statusText = parking.status === 'normal' ? 'æ­£å¸¸' :
                                  parking.status === 'busy' ? 'æ‹¥æŒ¤' : 'å·²æ»¡';

                div.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="font-semibold text-lg">${parking.name}</h3>
                        <span class="${statusClass} font-medium text-sm">${statusText}</span>
                    </div>
                    <div class="space-y-2 text-sm text-gray-600 mb-4">
                        <div>åœ°å€: ${parking.address}</div>
                        <div>æ€»è½¦ä½: ${parking.totalSpots}</div>
                        <div>ç©ºé—²è½¦ä½: ${parking.availableSpots}</div>
                        <div>ä»·æ ¼: Â¥${parking.price}/å°æ—¶</div>
                        <div>è´Ÿè´£äºº: ${parking.manager}</div>
                        <div>è”ç³»ç”µè¯: ${parking.contact}</div>
                    </div>
                    <div class="flex justify-between items-center">
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-blue-600 h-2 rounded-full" style="width: ${((parking.totalSpots - parking.availableSpots) / parking.totalSpots) * 100}%"></div>
                        </div>
                        <div class="ml-4 flex gap-2">
                            <button onclick="editParking(${parking.id})" class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">ç¼–è¾‘</button>
                            <button onclick="viewParkingDetails(${parking.id})" class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">è¯¦æƒ…</button>
                        </div>
                    </div>
                `;

                container.appendChild(div);
            });
        }

        // æ˜¾ç¤ºé¢„çº¦åˆ—è¡¨
        function displayBookings() {
            const container = document.getElementById('bookings-table');
            if (!container) return;

            container.innerHTML = '';

            bookingsData.forEach(booking => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-50';

                const statusClass = booking.status === 'confirmed' ? 'text-green-600' :
                                   booking.status === 'pending' ? 'text-yellow-600' :
                                   booking.status === 'completed' ? 'text-blue-600' : 'text-red-600';
                const statusText = booking.status === 'confirmed' ? 'å·²ç¡®è®¤' :
                                  booking.status === 'pending' ? 'å¾…ç¡®è®¤' :
                                  booking.status === 'completed' ? 'å·²å®Œæˆ' : 'å·²å–æ¶ˆ';

                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${booking.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${booking.username}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${booking.parkingName}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${booking.bookingTime}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${statusClass} font-medium">${statusText}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="viewBooking(${booking.id})" class="text-blue-600 hover:text-blue-900 mr-3">æŸ¥çœ‹</button>
                        <button onclick="cancelBooking(${booking.id})" class="text-red-600 hover:text-red-900">å–æ¶ˆ</button>
                    </td>
                `;

                container.appendChild(tr);
            });
        }

        // æ˜¾ç¤ºæ”¯ä»˜åˆ—è¡¨
        function displayPayments() {
            const container = document.getElementById('payments-table');
            if (!container) return;

            container.innerHTML = '';

            paymentsData.forEach(payment => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-50';

                const statusClass = payment.status === 'completed' ? 'text-green-600' : 'text-yellow-600';
                const statusText = payment.status === 'completed' ? 'å·²å®Œæˆ' : 'å¤„ç†ä¸­';

                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${payment.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${payment.username}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${payment.parkingName}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium">Â¥${payment.amount.toFixed(2)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${payment.paymentMethod}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${payment.paymentTime}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${statusClass} font-medium">${statusText}</td>
                `;

                container.appendChild(tr);
            });
        }

        // æ˜¾ç¤ºè®¾å¤‡åˆ—è¡¨
        function displayDevices() {
            const container = document.getElementById('devices-list');
            if (!container) return;

            container.innerHTML = '';

            devicesData.forEach(device => {
                const div = document.createElement('div');
                div.className = 'bg-white rounded-xl shadow-lg p-6';

                const statusClass = device.status === 'online' ? 'text-green-600' :
                                   device.status === 'offline' ? 'text-red-600' : 'text-yellow-600';
                const statusText = device.status === 'online' ? 'åœ¨çº¿' :
                                  device.status === 'offline' ? 'ç¦»çº¿' : 'ç»´æŠ¤ä¸­';

                const typeIcon = device.type === 'barrier' ? 'ğŸš§' :
                                device.type === 'camera' ? 'ğŸ“·' :
                                device.type === 'payment' ? 'ğŸ’³' : 'ğŸ“¡';

                div.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="font-semibold text-lg">${device.name}</h3>
                        <span class="${statusClass} font-medium text-sm">${statusText}</span>
                    </div>
                    <div class="text-3xl mb-4 text-center">${typeIcon}</div>
                    <div class="space-y-2 text-sm text-gray-600 mb-4">
                        <div>ä½ç½®: ${device.location}</div>
                        <div>ç±»å‹: ${device.type === 'barrier' ? 'é“é—¸' : device.type === 'camera' ? 'æ‘„åƒå¤´' : device.type === 'payment' ? 'æ”¯ä»˜ç»ˆç«¯' : 'ä¼ æ„Ÿå™¨'}</div>
                        <div>ä¸Šæ¬¡ç»´æŠ¤: ${device.lastMaintenance}</div>
                        <div>ä¸‹æ¬¡ç»´æŠ¤: ${device.nextMaintenance}</div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="maintenanceDevice(${device.id})" class="flex-1 bg-blue-600 text-white py-2 rounded text-sm hover:bg-blue-700">ç»´æŠ¤</button>
                        <button onclick="restartDevice(${device.id})" class="flex-1 bg-green-600 text-white py-2 rounded text-sm hover:bg-green-700">é‡å¯</button>
                    </div>
                `;

                container.appendChild(div);
            });
        }

        // æ˜¾ç¤ºå¼‚å¸¸åˆ—è¡¨
        function displayAlerts() {
            const container = document.getElementById('alerts-list');
            if (!container) return;

            container.innerHTML = '';

            alertsData.forEach(alert => {
                const div = document.createElement('div');
                div.className = 'alert-item bg-white rounded-xl shadow-lg p-6';

                const severityClass = alert.severity === 'high' ? 'bg-red-100 text-red-800' :
                                     alert.severity === 'medium' ? 'bg-yellow-100 text-yellow-800' : 'bg-blue-100 text-blue-800';
                const statusClass = alert.status === 'unresolved' ? 'text-red-600' :
                                   alert.status === 'processing' ? 'text-yellow-600' : 'text-green-600';
                const statusText = alert.status === 'unresolved' ? 'æœªè§£å†³' :
                                  alert.status === 'processing' ? 'å¤„ç†ä¸­' : 'å·²è§£å†³';

                div.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex items-center">
                            <h3 class="font-semibold text-lg mr-3">${alert.title}</h3>
                            <span class="px-2 py-1 rounded text-xs font-medium ${severityClass}">
                                ${alert.severity === 'high' ? 'é«˜' : alert.severity === 'medium' ? 'ä¸­' : 'ä½'}
                            </span>
                        </div>
                        <span class="${statusClass} font-medium text-sm">${statusText}</span>
                    </div>
                    <p class="text-gray-600 mb-4">${alert.description}</p>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-500">å‘ç”Ÿæ—¶é—´: ${alert.time}</span>
                        <div class="flex gap-2">
                            ${alert.status !== 'resolved' ? 
                                `<button onclick="resolveAlert(${alert.id})" class="bg-green-600 text-white px-4 py-2 rounded text-sm hover:bg-green-700">æ ‡è®°è§£å†³</button>` : ''}
                            <button onclick="viewAlertDetails(${alert.id})" class="bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700">æŸ¥çœ‹è¯¦æƒ…</button>
                        </div>
                    </div>
                `;

                container.appendChild(div);
            });
        }

        // åˆ‡æ¢å†…å®¹åŒºåŸŸ
        function showSection(sectionName) {
            // éšè—æ‰€æœ‰å†…å®¹åŒºåŸŸ
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });

            // æ˜¾ç¤ºé€‰ä¸­çš„å†…å®¹åŒºåŸŸ
            document.getElementById(sectionName + '-section').classList.add('active');

            // æ›´æ–°ä¾§è¾¹æ æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.sidebar-item').classList.add('active');

            currentSection = sectionName;

            // ========================================
            // PHASE 4: æ™ºèƒ½åˆ†ææ ‡ç­¾é¡µå›¾è¡¨ä¿®å¤
            // ========================================
            // å½“åˆ‡æ¢åˆ°æ™ºèƒ½åˆ†ææ ‡ç­¾é¡µæ—¶ï¼Œé‡æ–°åˆå§‹åŒ–æˆ–è°ƒæ•´å›¾è¡¨å°ºå¯¸
            if (sectionName === 'analytics') {
                setTimeout(() => {
                    console.log('ğŸ”§ æ™ºèƒ½åˆ†ææ ‡ç­¾é¡µå·²æ¿€æ´»ï¼Œæ£€æŸ¥å›¾è¡¨çŠ¶æ€...');

                    // é‡æ–°åˆå§‹åŒ–æˆ–è°ƒæ•´æ‰€æœ‰æ™ºèƒ½åˆ†æå›¾è¡¨çš„å°ºå¯¸
                    const chartIds = [
                        'demand-prediction-chart',
                        'anomaly-detection-chart',
                        'rfm-analysis-chart',
                        'prediction-accuracy-chart'
                    ];

                    chartIds.forEach((chartId, index) => {
                        const container = document.getElementById(chartId);
                        if (container && typeof echarts !== 'undefined') {
                            // å¦‚æœå›¾è¡¨å·²åˆå§‹åŒ–ï¼Œåªè°ƒæ•´å°ºå¯¸
                            const chartInstance = echarts.getInstanceByDom(container);
                            if (chartInstance) {
                                chartInstance.resize();
                                console.log(`âœ… ${chartId} å›¾è¡¨å°ºå¯¸å·²è°ƒæ•´`);
                            } else {
                                // å¦‚æœå›¾è¡¨æœªåˆå§‹åŒ–ï¼Œé‡æ–°åˆå§‹åŒ–
                                setTimeout(() => {
                                    switch(chartId) {
                                        case 'demand-prediction-chart':
                                            if (typeof initializeDemandPredictionChart === 'function') {
                                                initializeDemandPredictionChart();
                                            }
                                            break;
                                        case 'anomaly-detection-chart':
                                            if (typeof initializeAnomalyDetectionChart === 'function') {
                                                initializeAnomalyDetectionChart();
                                            }
                                            break;
                                        case 'rfm-analysis-chart':
                                            if (typeof initializeRFMAnalysisChart === 'function') {
                                                initializeRFMAnalysisChart();
                                            }
                                            break;
                                        case 'prediction-accuracy-chart':
                                            if (typeof initializePredictionAccuracyChart === 'function') {
                                                initializePredictionAccuracyChart();
                                            }
                                            break;
                                    }
                                }, index * 200); // é”™å¼€åˆå§‹åŒ–æ—¶é—´ï¼Œé¿å…åŒæ—¶æ¸²æŸ“é€ æˆå¡é¡¿
                            }
                        }
                    });

                    console.log('âœ… æ™ºèƒ½åˆ†æå›¾è¡¨å·²é‡æ–°åˆå§‹åŒ–æˆ–è°ƒæ•´å°ºå¯¸');
                }, 300); // å»¶è¿Ÿ300msç¡®ä¿æ ‡ç­¾é¡µå†…å®¹å·²å®Œå…¨æ˜¾ç¤º
            }
            // ========================================
            // END PHASE 4
            // ========================================
        }

        // ç”¨æˆ·ç®¡ç†åŠŸèƒ½
        function editUser(userId) {
            alert('ç¼–è¾‘ç”¨æˆ·åŠŸèƒ½å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼');
        }

        function toggleUserStatus(userId) {
            const user = usersData.find(u => u.id === userId);
            if (user) {
                // ç®¡ç†å‘˜è´¦å·ä¸èƒ½è¢«ç¦ç”¨
                if (user.admin) {
                    alert('ç®¡ç†å‘˜è´¦å·ä¸èƒ½è¢«ç¦ç”¨æˆ–å¯ç”¨ï¼');
                    return;
                }
                user.status = user.status === 'active' ? 'inactive' : 'active';
                displayUsers();
            }
        }

        function showAddUserModal() {
            alert('æ·»åŠ ç”¨æˆ·åŠŸèƒ½å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼');
        }

        // åœè½¦åœºç®¡ç†åŠŸèƒ½
        /**
         * æŸ¥çœ‹åœè½¦åœºè¯¦æƒ…
         */
        function viewParkingDetails(parkingId) {
            const parking = parkingData.find(p => p.id === parkingId);
            if (!parking) {
                alert('æœªæ‰¾åˆ°è¯¥åœè½¦åœºä¿¡æ¯ï¼');
                return;
            }

            const statusBadge = parking.status === 'normal' ? '<span class="px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">æ­£å¸¸</span>' :
                                parking.status === 'busy' ? '<span class="px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800">æ‹¥æŒ¤</span>' :
                                '<span class="px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800">å·²æ»¡</span>';

            const occupancyRate = ((parking.totalSpots - parking.availableSpots) / parking.totalSpots * 100).toFixed(1);

            const detailsHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h4 class="font-bold text-lg mb-4 text-gray-800">åŸºæœ¬ä¿¡æ¯</h4>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-600">åœè½¦åœºåç§°ï¼š</span>
                                <span class="font-medium">${parking.name}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">çŠ¶æ€ï¼š</span>
                                <span>${statusBadge}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">åœ°å€ï¼š</span>
                                <span class="font-medium text-right">${parking.address}</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gray-50 rounded-lg p-4">
                        <h4 class="font-bold text-lg mb-4 text-gray-800">è½¦ä½ä¿¡æ¯</h4>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-600">æ€»è½¦ä½æ•°ï¼š</span>
                                <span class="font-medium">${parking.totalSpots} ä¸ª</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">ç©ºé—²è½¦ä½ï¼š</span>
                                <span class="font-medium text-green-600">${parking.availableSpots} ä¸ª</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">å·²ç”¨è½¦ä½ï¼š</span>
                                <span class="font-medium text-blue-600">${parking.totalSpots - parking.availableSpots} ä¸ª</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">å ç”¨ç‡ï¼š</span>
                                <span class="font-medium">${occupancyRate}%</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gray-50 rounded-lg p-4">
                        <h4 class="font-bold text-lg mb-4 text-gray-800">æ”¶è´¹ä¿¡æ¯</h4>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-600">åŸºç¡€ä»·æ ¼ï¼š</span>
                                <span class="font-medium text-blue-600">Â¥${parking.price}/å°æ—¶</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">æ—¥æ”¶å…¥ï¼ˆä¼°ç®—ï¼‰ï¼š</span>
                                <span class="font-medium">Â¥${(parking.price * parking.totalSpots * 0.6 * 12).toFixed(0)}</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gray-50 rounded-lg p-4">
                        <h4 class="font-bold text-lg mb-4 text-gray-800">è”ç³»ä¿¡æ¯</h4>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-600">è´Ÿè´£äººï¼š</span>
                                <span class="font-medium">${parking.manager}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">è”ç³»ç”µè¯ï¼š</span>
                                <span class="font-medium text-blue-600">${parking.contact}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-8">
                    <h4 class="font-bold text-lg mb-4 text-gray-800">ä½¿ç”¨çŠ¶æ€å¯è§†åŒ–</h4>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm text-gray-600">è½¦ä½ä½¿ç”¨æƒ…å†µ</span>
                            <span class="font-medium">${occupancyRate}% å ç”¨</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-4">
                            <div class="bg-blue-600 h-4 rounded-full transition-all duration-300" style="width: ${occupancyRate}%"></div>
                        </div>
                        <div class="flex justify-between mt-2 text-xs text-gray-500">
                            <span>ç©ºé—²: ${parking.availableSpots}</span>
                            <span>å·²ç”¨: ${parking.totalSpots - parking.availableSpots}</span>
                        </div>
                    </div>
                </div>

                <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-blue-50 rounded-lg p-4 text-center">
                        <div class="text-3xl font-bold text-blue-600">${parking.totalSpots}</div>
                        <div class="text-sm text-gray-600">æ€»è½¦ä½æ•°</div>
                    </div>
                    <div class="bg-green-50 rounded-lg p-4 text-center">
                        <div class="text-3xl font-bold text-green-600">${parking.availableSpots}</div>
                        <div class="text-sm text-gray-600">ç©ºé—²è½¦ä½</div>
                    </div>
                    <div class="bg-yellow-50 rounded-lg p-4 text-center">
                        <div class="text-3xl font-bold text-yellow-600">${occupancyRate}%</div>
                        <div class="text-sm text-gray-600">å ç”¨ç‡</div>
                    </div>
                </div>
            `;

            document.getElementById('parking-details-content').innerHTML = detailsHTML;
            document.getElementById('parking-details-modal').classList.remove('hidden');
        }

        /**
         * å…³é—­åœè½¦åœºè¯¦æƒ…æ¨¡æ€æ¡†
         */
        function closeParkingDetailsModal() {
            document.getElementById('parking-details-modal').classList.add('hidden');
        }

        /**
         * ç¼–è¾‘åœè½¦åœº
         */
        function editParking(parkingId) {
            const parking = parkingData.find(p => p.id === parkingId);
            if (!parking) {
                alert('æœªæ‰¾åˆ°è¯¥åœè½¦åœºä¿¡æ¯ï¼');
                return;
            }

            // å¡«å……è¡¨å•æ•°æ®
            document.getElementById('edit-parking-id').value = parking.id;
            document.getElementById('edit-parking-name').value = parking.name;
            document.getElementById('edit-parking-address').value = parking.address;
            document.getElementById('edit-parking-total-spots').value = parking.totalSpots;
            document.getElementById('edit-parking-available-spots').value = parking.availableSpots;
            document.getElementById('edit-parking-price').value = parking.price;
            document.getElementById('edit-parking-status').value = parking.status;
            document.getElementById('edit-parking-manager').value = parking.manager;
            document.getElementById('edit-parking-contact').value = parking.contact;

            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            document.getElementById('parking-edit-modal').classList.remove('hidden');
        }

        /**
         * å…³é—­åœè½¦åœºç¼–è¾‘æ¨¡æ€æ¡†
         */
        function closeParkingEditModal() {
            document.getElementById('parking-edit-modal').classList.add('hidden');
        }

        /**
         * åœè½¦åœºç¼–è¾‘è¡¨å•æäº¤
         */
        document.getElementById('parking-edit-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const parkingId = parseInt(document.getElementById('edit-parking-id').value);
            const parkingIndex = parkingData.findIndex(p => p.id === parkingId);

            if (parkingIndex === -1) {
                alert('æœªæ‰¾åˆ°è¯¥åœè½¦åœºä¿¡æ¯ï¼');
                return;
            }

            // è·å–è¡¨å•æ•°æ®
            const updatedData = {
                id: parkingId,
                name: document.getElementById('edit-parking-name').value.trim(),
                address: document.getElementById('edit-parking-address').value.trim(),
                totalSpots: parseInt(document.getElementById('edit-parking-total-spots').value),
                availableSpots: parseInt(document.getElementById('edit-parking-available-spots').value),
                price: parseFloat(document.getElementById('edit-parking-price').value),
                status: document.getElementById('edit-parking-status').value,
                manager: document.getElementById('edit-parking-manager').value.trim(),
                contact: document.getElementById('edit-parking-contact').value.trim()
            };

            // éªŒè¯æ•°æ®
            if (updatedData.name === '' || updatedData.address === '') {
                alert('åœè½¦åœºåç§°å’Œåœ°å€ä¸èƒ½ä¸ºç©ºï¼');
                return;
            }

            if (updatedData.totalSpots < 1) {
                alert('æ€»è½¦ä½æ•°å¿…é¡»å¤§äº0ï¼');
                return;
            }

            if (updatedData.availableSpots < 0) {
                alert('ç©ºé—²è½¦ä½æ•°ä¸èƒ½ä¸ºè´Ÿæ•°ï¼');
                return;
            }

            if (updatedData.availableSpots > updatedData.totalSpots) {
                alert('ç©ºé—²è½¦ä½æ•°ä¸èƒ½è¶…è¿‡æ€»è½¦ä½æ•°ï¼');
                return;
            }

            // æ›´æ–°æ•°æ®
            parkingData[parkingIndex] = updatedData;

            // é‡æ–°æ¸²æŸ“åˆ—è¡¨
            displayParkingLots();

            // å…³é—­æ¨¡æ€æ¡†
            closeParkingEditModal();

            alert('âœ… åœè½¦åœºä¿¡æ¯å·²æ›´æ–°ï¼');
        })

        // é¢„çº¦ç®¡ç†åŠŸèƒ½
        function viewBooking(bookingId) {
            alert('æŸ¥çœ‹é¢„çº¦è¯¦æƒ…åŠŸèƒ½å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼');
        }

        function cancelBooking(bookingId) {
            if (confirm('ç¡®å®šè¦å–æ¶ˆè¿™ä¸ªé¢„çº¦å—ï¼Ÿ')) {
                const booking = bookingsData.find(b => b.id === bookingId);
                if (booking) {
                    booking.status = 'cancelled';
                    displayBookings();
                }
            }
        }

        // è®¾å¤‡ç®¡ç†åŠŸèƒ½
        function maintenanceDevice(deviceId) {
            const device = devicesData.find(d => d.id === deviceId);
            if (device) {
                device.status = 'maintenance';
                displayDevices();
                alert('è®¾å¤‡å·²æ ‡è®°ä¸ºç»´æŠ¤çŠ¶æ€');
            }
        }

        function restartDevice(deviceId) {
            const device = devicesData.find(d => d.id === deviceId);
            if (device) {
                device.status = 'online';
                displayDevices();
                alert('è®¾å¤‡å·²é‡å¯å¹¶æ¢å¤åœ¨çº¿çŠ¶æ€');
            }
        }

        // å¼‚å¸¸å¤„ç†åŠŸèƒ½
        function resolveAlert(alertId) {
            const alert = alertsData.find(a => a.id === alertId);
            if (alert) {
                alert.status = 'resolved';
                displayAlerts();
                alert('å¼‚å¸¸å·²æ ‡è®°ä¸ºå·²è§£å†³');
            }
        }

        function viewAlertDetails(alertId) {
            alert('æŸ¥çœ‹å¼‚å¸¸è¯¦æƒ…åŠŸèƒ½å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼');
        }

        // é€€å‡ºç™»å½•
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                // æ¸…é™¤ç™»å½•ä¿¡æ¯
                localStorage.removeItem('smartparking_token');
                localStorage.removeItem('smartparking_user');
                window.location.href = 'index.html';
            }
        }

        // æ›´æ–°ç®¡ç†å‘˜æ˜¾ç¤ºåç§°
        function updateAdminDisplayName() {
            const adminNameElement = document.getElementById('current-admin');
            if (!adminNameElement) return;

            // ä»session storageè·å–ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
            const urlParams = new URLSearchParams(window.location.search);
            const adminUsername = urlParams.get('admin');

            if (adminUsername) {
                adminNameElement.textContent = `ç®¡ç†å‘˜: ${decodeURIComponent(adminUsername)}`;
                return;
            }

            // ä»localStorageè·å–
            const userData = localStorage.getItem('smartparking_user');
            if (userData) {
                try {
                    const user = JSON.parse(userData);
                    if (user && user.username) {
                        // æ£€æŸ¥æ˜¯å¦æ˜¯ç®¡ç†å‘˜è´¦å·ï¼ˆç®€å•åˆ¤æ–­ï¼šå¦‚æœä¸æ˜¯æå››ã€ç‹äº”ã€èµµå…­ã€å­™ä¸ƒè¿™äº›æ™®é€šç”¨æˆ·ï¼Œå°±è®¤ä¸ºæ˜¯ç®¡ç†å‘˜ï¼‰
                        const normalUsers = ['æå››', 'ç‹äº”', 'èµµå…­', 'å­™ä¸ƒ', 'å¼ ä¸‰'];
                        if (!normalUsers.includes(user.username)) {
                            adminNameElement.textContent = `ç®¡ç†å‘˜: ${user.username}`;
                            return;
                        }
                    }
                } catch (e) {
                    console.log('è§£æç”¨æˆ·æ•°æ®å¤±è´¥:', e);
                }
            }

            // é»˜è®¤æ˜¾ç¤ºç¬¬ä¸€ä¸ªç®¡ç†å‘˜
            const adminUser = usersData.find(u => u.admin);
            if (adminUser) {
                adminNameElement.textContent = `ç®¡ç†å‘˜: ${adminUser.username}`;
            } else {
                // å¦‚æœæ‰¾ä¸åˆ°ï¼Œä¿æŒé»˜è®¤çš„"ææ¬£æ…°"
                adminNameElement.textContent = 'ç®¡ç†å‘˜: ææ¬£æ…°';
            }
        }

        // æ›´æ–°ä»·æ ¼å›¾è¡¨å’Œå½“å‰ä»·æ ¼ä¿¡æ¯
        function updatePriceChart() {
            const parkingLotId = document.getElementById('parking-lot-select').value;
            const timeValue = document.getElementById('time-select').value;
            const duration = parseInt(document.getElementById('duration-select').value);

            const selectedTime = timeValue ? new Date(timeValue) : new Date();

            // ç”Ÿæˆæ¨¡æ‹Ÿåœè½¦åœºæ•°æ®
            const parkingLot = {
                id: parkingLotId,
                occupancyRate: 0.3 + Math.random() * 0.6, // 30%-90% å ç”¨ç‡
                basePrice: 8 + Math.floor(Math.random() * 8) // 8-15å…ƒåŸºç¡€ä»·æ ¼
            };

            // è®¡ç®—å½“å‰ä»·æ ¼
            const priceInfo = typeof calculateDynamicPrice === 'function'
                ? calculateDynamicPrice(parkingLot, selectedTime, duration)
                : {
                      hourlyRate: (parkingLot.basePrice * (0.7 + Math.random() * 1.3)).toFixed(2),
                      totalPrice: (parkingLot.basePrice * duration * (0.7 + Math.random() * 1.3)).toFixed(2),
                      factors: [
                          { name: 'å ç”¨ç‡', value: (0.7 + Math.random() * 1.3).toFixed(2), description: 'å½“å‰å ç”¨ç‡å½±å“' },
                          { name: 'æ—¶æ®µ', value: (0.7 + Math.random() * 0.8).toFixed(2), description: 'æ—¶æ®µç³»æ•°' },
                          { name: 'æ—¶é•¿æŠ˜æ‰£', value: (0.9 + Math.random() * 0.1).toFixed(2), description: 'é•¿æ—¶åœè½¦ä¼˜æƒ ' }
                      ]
                  };

            // æ›´æ–°å½“å‰ä»·æ ¼ä¿¡æ¯
            const priceInfoContainer = document.getElementById('current-price-info');
            const factorColors = ['text-blue-600', 'text-green-600', 'text-purple-600', 'text-yellow-600', 'text-red-600'];

            if (priceInfoContainer) {
                const basePrice = parkingLot.basePrice;
                const currentPrice = parseFloat(priceInfo.hourlyRate);
                const priceChange = ((currentPrice - basePrice) / basePrice * 100).toFixed(1);
                const trendClass = currentPrice > basePrice ? 'text-red-600' : 'text-green-600';
                const trendIcon = currentPrice > basePrice ? 'â†‘' : 'â†“';

                priceInfoContainer.innerHTML = `
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="text-xl font-semibold">å½“å‰ä»·æ ¼è¯¦æƒ…</h3>
                            <span class="px-3 py-1 rounded-full text-sm font-medium ${currentPrice > basePrice ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">
                                ${trendIcon} ${Math.abs(priceChange)}%
                            </span>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                            <div class="text-center p-4 bg-gray-50 rounded-lg">
                                <div class="text-sm text-gray-600 mb-1">åŸºç¡€ä»·æ ¼</div>
                                <div class="text-2xl font-bold text-gray-800">Â¥${basePrice}</div>
                            </div>
                            <div class="text-center p-4 bg-blue-50 rounded-lg">
                                <div class="text-sm text-gray-600 mb-1">åŠ¨æ€ä»·æ ¼</div>
                                <div class="text-2xl font-bold text-blue-600">Â¥${currentPrice}</div>
                            </div>
                            <div class="text-center p-4 bg-green-50 rounded-lg">
                                <div class="text-sm text-gray-600 mb-1">æ€»ä»· (${duration}å°æ—¶)</div>
                                <div class="text-2xl font-bold text-green-600">Â¥${priceInfo.totalPrice}</div>
                            </div>
                            <div class="text-center p-4 bg-purple-50 rounded-lg">
                                <div class="text-sm text-gray-600 mb-1">èŠ‚çœ/é¢å¤–</div>
                                <div class="text-2xl font-bold ${trendClass}">
                                    ${currentPrice > basePrice ? '-' : '+'}Â¥${Math.abs(currentPrice - basePrice).toFixed(2)}
                                </div>
                            </div>
                        </div>

                        <div class="border-t pt-4">
                            <h4 class="font-semibold mb-3">ğŸ’¡ çœé’±å»ºè®®</h4>
                            <div id="savings-recommendations" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <!-- åŠ¨æ€ç”Ÿæˆçœé’±å»ºè®® -->
                            </div>
                        </div>
                    </div>
                `;

                // ç”Ÿæˆçœé’±å»ºè®®
                const savingsContainer = document.getElementById('savings-recommendations');
                const recommendations = typeof generateSavingsRecommendations === 'function'
                    ? generateSavingsRecommendations(parkingLot, selectedTime, duration)
                    : [
                          { text: 'å»ºè®®é€‰æ‹©å¤œé—´åœè½¦ï¼ˆ22:00-6:00ï¼‰äº«å—3æŠ˜ä¼˜æƒ ', potential: 'èŠ‚çœ70%' },
                          { text: 'å·¥ä½œæ—¥ä¸‹åˆæ—¶æ®µä»·æ ¼è¾ƒä½ï¼Œæ¨èé”™å³°å‡ºè¡Œ', potential: 'èŠ‚çœ30%' },
                          { text: 'åœè½¦è¶…è¿‡3å°æ—¶äº«å—95æŠ˜ï¼Œè¶…è¿‡6å°æ—¶äº«å—9æŠ˜', potential: 'èŠ‚çœ10%' }
                      ];

                if (savingsContainer) {
                    savingsContainer.innerHTML = recommendations.map((rec, index) => `
                        <div class="flex items-start p-3 bg-green-50 rounded-lg">
                            <span class="text-green-600 mr-2">ğŸ’¡</span>
                            <div>
                                <div class="text-sm text-gray-800">${rec.text}</div>
                                <div class="text-xs text-green-600 font-medium mt-1">é¢„è®¡${rec.potential}</div>
                            </div>
                        </div>
                    `).join('');
                }
            }

            // ç”Ÿæˆ24å°æ—¶ä»·æ ¼è¶‹åŠ¿æ•°æ®
            const generate24HourTrend = () => {
                const trend = [];
                const hours = [];
                const currentHour = selectedTime.getHours();

                for (let i = 0; i < 24; i++) {
                    const hour = new Date(selectedTime);
                    hour.setHours(i, 0, 0, 0);
                    hours.push(i + ':00');

                    const mockLot = { ...parkingLot, occupancyRate: 0.2 + Math.random() * 0.7 };
                    const hourPrice = typeof calculateDynamicPrice === 'function'
                        ? calculateDynamicPrice(mockLot, hour, duration)
                        : { hourlyRate: (basePrice * (0.6 + Math.random() * 1.4)).toFixed(2) };

                    trend.push(parseFloat(hourPrice.hourlyRate));
                }

                return { hours, trend };
            };

            const { hours, trend } = generate24HourTrend();

            // ç»˜åˆ¶24å°æ—¶ä»·æ ¼è¶‹åŠ¿å›¾
            const chartContainer = document.getElementById('dynamic-price-chart');
            if (chartContainer && typeof echarts !== 'undefined') {
                const chart = echarts.init(chartContainer);
                const maxPrice = Math.max(...trend);
                const minPrice = Math.min(...trend);
                const avgPrice = trend.reduce((a, b) => a + b, 0) / trend.length;

                // æ ‡è®°é«˜å³°å’Œä½è°·æ—¶æ®µ
                const markPointData = [];
                const maxIndex = trend.indexOf(maxPrice);
                const minIndex = trend.indexOf(minPrice);
                const currentIndex = currentHour;

                markPointData.push(
                    { coord: [maxIndex, maxPrice], value: `é«˜å³°:Â¥${maxPrice.toFixed(1)}`, itemStyle: { color: '#ef4444' } },
                    { coord: [minIndex, minPrice], value: `ä½è°·:Â¥${minPrice.toFixed(1)}`, itemStyle: { color: '#10b981' } }
                );

                // å½“å‰æ—¶é—´æ ‡è®°
                if (currentIndex >= 0 && currentIndex < 24) {
                    markPointData.push({
                        coord: [currentIndex, trend[currentIndex]],
                        value: `å½“å‰`,
                        itemStyle: { color: '#3b82f6' }
                    });
                }

                const option = {
                    tooltip: {
                        trigger: 'axis',
                        formatter: function(params) {
                            const hour = params[0].axisValue;
                            const price = params[0].value;
                            const change = ((price - basePrice) / basePrice * 100).toFixed(1);
                            return `<strong>${hour}</strong><br/>
                                   ä»·æ ¼: <span style="color:${price > basePrice ? '#ef4444' : '#10b981'}">Â¥${price.toFixed(2)}</span><br/>
                                   å˜åŒ–: <span style="color:${price > basePrice ? '#ef4444' : '#10b981'}">${change > 0 ? '+' : ''}${change}%</span>`;
                        }
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true
                    },
                    xAxis: {
                        type: 'category',
                        boundaryGap: false,
                        data: hours,
                        axisLabel: {
                            interval: 1
                        }
                    },
                    yAxis: {
                        type: 'value',
                        axisLabel: {
                            formatter: 'Â¥{value}'
                        }
                    },
                    series: [{
                        name: 'ä»·æ ¼',
                        type: 'line',
                        smooth: true,
                        symbol: 'circle',
                        symbolSize: 6,
                        lineStyle: {
                            color: '#3b82f6',
                            width: 3
                        },
                        areaStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: 'rgba(59, 130, 246, 0.3)' },
                                { offset: 1, color: 'rgba(59, 130, 246, 0.05)' }
                            ])
                        },
                        itemStyle: {
                            color: '#3b82f6'
                        },
                        data: trend,
                        markPoint: {
                            data: markPointData,
                            label: {
                                show: true,
                                formatter: '{b}',
                                position: 'top'
                            }
                        },
                        markLine: {
                            silent: true,
                            lineStyle: {
                                color: '#f59e0b',
                                type: 'dashed'
                            },
                            data: [{
                                yAxis: basePrice,
                                label: {
                                    formatter: 'åŸºç¡€ä»·: Â¥{c}'
                                }
                            }]
                        }
                    }]
                };

                chart.setOption(option);

                // åœ¨å›¾è¡¨ä¸‹æ–¹æ·»åŠ ç»Ÿè®¡ä¿¡æ¯
                const statsHtml = `
                    <div class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                        <div class="text-center p-2 bg-red-50 rounded">
                            <div class="text-red-600 font-medium">æœ€é«˜ä»·æ ¼</div>
                            <div class="font-bold">Â¥${maxPrice.toFixed(2)}</div>
                        </div>
                        <div class="text-center p-2 bg-green-50 rounded">
                            <div class="text-green-600 font-medium">æœ€ä½ä»·æ ¼</div>
                            <div class="font-bold">Â¥${minPrice.toFixed(2)}</div>
                        </div>
                        <div class="text-center p-2 bg-blue-50 rounded">
                            <div class="text-blue-600 font-medium">å¹³å‡ä»·æ ¼</div>
                            <div class="font-bold">Â¥${avgPrice.toFixed(2)}</div>
                        </div>
                        <div class="text-center p-2 bg-purple-50 rounded">
                            <div class="text-purple-600 font-medium">æ³¢åŠ¨å¹…åº¦</div>
                            <div class="font-bold">${((maxPrice - minPrice) / minPrice * 100).toFixed(1)}%</div>
                        </div>
                    </div>
                `;

                if (!document.getElementById('price-stats')) {
                    const statsDiv = document.createElement('div');
                    statsDiv.id = 'price-stats';
                    chartContainer.parentNode.insertBefore(statsDiv, chartContainer.nextSibling);
                }
                document.getElementById('price-stats').innerHTML = statsHtml;
            }
        }

        // ==================== æ–‡ä»¶ä¸Šä¼ é¢„è§ˆåŠŸèƒ½ ====================
        /**
         * æ–‡ä»¶ä¸Šä¼ é¢„è§ˆå¤„ç†ï¼ˆå‰ç«¯æ¼”ç¤ºç‰ˆï¼‰
         * ä½¿ç”¨ URL.createObjectURL å®ç°æœ¬åœ°é¢„è§ˆï¼Œä¸å®é™…ä¸Šä¼ è‡³æœåŠ¡å™¨
         * å°†æ¥æ¥å…¥åç«¯ API åï¼Œå¯æ— ç¼æ‰©å±•ä¸ºçœŸå®æ–‡ä»¶å­˜å‚¨
         */
        document.addEventListener('DOMContentLoaded', function() {
            // åœè½¦åœºå›¾ç‰‡ä¸Šä¼ 
            const parkingUpload = document.getElementById('parking-image-upload');
            const parkingPreview = document.getElementById('parking-image-preview');
            const parkingPreviewImg = document.getElementById('parking-preview-img');

            if (parkingUpload) {
                parkingUpload.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file && file.type.startsWith('image/')) {
                        const objectUrl = URL.createObjectURL(file);
                        parkingPreviewImg.src = objectUrl;
                        parkingPreview.classList.remove('hidden');

                        // 2ç§’åé‡Šæ”¾ object URLï¼ˆå¯é€‰ï¼‰
                        setTimeout(() => {
                            URL.revokeObjectURL(objectUrl);
                            console.log('å·²é‡Šæ”¾ä¸´æ—¶ URL:', objectUrl);
                        }, 2000);
                    }
                });
            }

            // è®¾å¤‡å›¾ç‰‡ä¸Šä¼ 
            const deviceUpload = document.getElementById('device-image-upload');
            const devicePreview = document.getElementById('device-image-preview');
            const devicePreviewImg = document.getElementById('device-preview-img');

            if (deviceUpload) {
                deviceUpload.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file && file.type.startsWith('image/')) {
                        const objectUrl = URL.createObjectURL(file);
                        devicePreviewImg.src = objectUrl;
                        devicePreview.classList.remove('hidden');

                        console.log('è®¾å¤‡å›¾ç‰‡é¢„è§ˆ URL:', objectUrl);
                    }
                });
            }

            // èµ„æºè½®æ’­å›¾ä¸Šä¼ ï¼ˆå¤šæ–‡ä»¶ï¼‰
            const bannerUpload = document.getElementById('banner-image-upload');
            const bannerPreview = document.getElementById('banner-image-preview');
            const bannerContainer = document.getElementById('banner-preview-container');

            if (bannerUpload) {
                bannerUpload.addEventListener('change', function(e) {
                    const files = Array.from(e.target.files);
                    bannerContainer.innerHTML = '';

                    files.forEach((file, index) => {
                        if (file.type.startsWith('image/')) {
                            const objectUrl = URL.createObjectURL(file);

                            // åˆ›å»ºé¢„è§ˆå¡ç‰‡
                            const previewCard = document.createElement('div');
                            previewCard.className = 'relative group';
                            previewCard.innerHTML = `
                                <img src="${objectUrl}" class="w-full h-24 object-cover rounded-lg shadow-sm border border-gray-200">
                                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all rounded-lg flex items-center justify-center">
                                    <span class="text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity">ç‚¹å‡»åˆ é™¤</span>
                                </div>
                                <button onclick="this.parentElement.remove(); URL.revokeObjectURL('${objectUrl}')" class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full text-xs opacity-0 group-hover:opacity-100 transition-opacity">
                                    Ã—
                                </button>
                            `;

                            bannerContainer.appendChild(previewCard);
                            console.log(`è½®æ’­å›¾ ${index + 1} é¢„è§ˆ URL:`, objectUrl);
                        }
                    });

                    if (files.length > 0) {
                        bannerPreview.classList.remove('hidden');
                    }
                });
            }

            // ä¸Šä¼ è¯´æ˜ï¼šå½“å‰ä»…ä¸ºå‰ç«¯æ¼”ç¤º
            console.log('æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½å·²åˆå§‹åŒ–ï¼ˆå‰ç«¯æ¼”ç¤ºç‰ˆï¼‰');
            console.log('â€¢ æ–‡ä»¶ä»…åœ¨æœ¬åœ°é¢„è§ˆï¼Œä½¿ç”¨ URL.createObjectURL()');
            console.log('â€¢ åˆ·æ–°é¡µé¢åé¢„è§ˆå†…å®¹ä¼šæ¶ˆå¤±');
            console.log('â€¢ æ¥å…¥åç«¯APIåï¼Œå¯æ‰©å±•ä¸ºçœŸå®å­˜å‚¨');


            // ========================================
            // PHASE 4: æ™ºèƒ½åˆ†æå›¾è¡¨åˆå§‹åŒ– (ADDED)
            // ========================================
            setTimeout(() => {
                console.log('æ­£åœ¨åˆå§‹åŒ–æ™ºèƒ½åˆ†æå›¾è¡¨...');
                initializePriceTrendChart();      // 24å°æ—¶ä»·æ ¼è¶‹åŠ¿
                initializeDemandPredictionChart(); // 15å¤©éœ€æ±‚é¢„æµ‹
                initializeAnomalyDetectionChart(); // æ™ºèƒ½å¼‚å¸¸æ£€æµ‹
                initializeRFMAnalysisChart();     // ç”¨æˆ·åˆ†ææ¨¡å‹
                initializePredictionAccuracyChart(); // å‡†ç¡®ç‡è¯„ä¼°
                generateAnomalyAlerts();
                generateSmartRecommendations();
                console.log('âœ… æ™ºèƒ½åˆ†æå›¾è¡¨å…¨éƒ¨åˆå§‹åŒ–å®Œæˆ!');
            }, 2000);
            // ========================================
            // END PHASE 4
            // ========================================
        });

        // ========================================
        // PHASE 4: æ™ºèƒ½åˆ†æå‡½æ•°å®šä¹‰ (æ–¹æ¡ˆA: å†…è”)
        // ========================================
        /**
         * 15å¤©éœ€æ±‚é¢„æµ‹å›¾è¡¨åˆå§‹åŒ–
         */
        function initializeDemandPredictionChart() {
            const chartContainer = document.getElementById('demand-prediction-chart');
            if (!chartContainer) return;

            const chart = echarts.init(chartContainer);
            window.demandPredictionChart = chart;

            // Generate 15-day dates
            const dates = [];
            const actualData = [];
            const predictedData = [];
            const upperBound = [];
            const lowerBound = [];

            for (let i = 0; i < 15; i++) {
                const date = new Date();
                date.setDate(date.getDate() - 5 + i);
                dates.push(date.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' }));

                if (i < 5) {
                    actualData.push(Math.round(65 + Math.random() * 20));
                    predictedData.push(null);
                    upperBound.push(null);
                    lowerBound.push(null);
                } else {
                    actualData.push(null);
                    const baseValue = 70 + Math.sin(i * 0.5) * 10;
                    predictedData.push(Math.round(baseValue));
                    upperBound.push(Math.round(baseValue + 15));
                    lowerBound.push(Math.round(Math.max(0, baseValue - 15)));
                }
            }

            const option = {
                title: { text: 'åœè½¦åœºåˆ©ç”¨ç‡é¢„æµ‹', left: 'center' },
                tooltip: { trigger: 'axis' },
                legend: { data: ['å®é™…å€¼', 'é¢„æµ‹å€¼', 'ç½®ä¿¡åŒºé—´'], bottom: 10 },
                xAxis: { type: 'category', data: dates },
                yAxis: { type: 'value', name: 'åˆ©ç”¨ç‡(%)', min: 0, max: 100 },
                series: [
                    {
                        name: 'å®é™…å€¼',
                        type: 'line',
                        data: actualData,
                        lineStyle: { color: '#3b82f6', width: 3 }
                    },
                    {
                        name: 'é¢„æµ‹å€¼',
                        type: 'line',
                        data: predictedData,
                        lineStyle: { color: '#f59e0b', width: 3, type: 'dashed' }
                    },
                    {
                        name: 'ç½®ä¿¡åŒºé—´',
                        type: 'line',
                        data: upperBound,
                        lineStyle: { opacity: 0 },
                        stack: 'confidence'
                    },
                    {
                        name: 'ç½®ä¿¡åŒºé—´',
                        type: 'line',
                        data: lowerBound,
                        lineStyle: { opacity: 0 },
                        areaStyle: { color: 'rgba(245, 158, 11, 0.2)' },
                        stack: 'confidence'
                    }
                ]
            };

            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
            console.log('âœ… éœ€æ±‚é¢„æµ‹å›¾è¡¨åˆå§‹åŒ–å®Œæˆ');
        }

        /**
         * å¼‚å¸¸æ£€æµ‹å›¾è¡¨åˆå§‹åŒ–
         */
        function initializeAnomalyDetectionChart() {
            const chartContainer = document.getElementById('anomaly-detection-chart');
            if (!chartContainer) return;

            const chart = echarts.init(chartContainer);
            window.anomalyDetectionChart = chart;

            const dates = [];
            const values = [];

            for (let i = 0; i < 30; i++) {
                const date = new Date();
                date.setDate(date.getDate() - 29 + i);
                dates.push(date.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' }));

                let value = 70 + Math.sin(i * 0.2) * 10 + (Math.random() - 0.5) * 10;
                if (i === 10) value = 120;
                if (i === 25) value = 20;
                values.push(Math.round(value));
            }

            const option = {
                title: { text: 'æ¯æ—¥åœè½¦æ¬¡æ•°å¼‚å¸¸æ£€æµ‹', left: 'center' },
                tooltip: { trigger: 'axis' },
                xAxis: { type: 'category', data: dates },
                yAxis: { type: 'value', name: 'åœè½¦æ¬¡æ•°' },
                series: [{
                    name: 'åœè½¦æ¬¡æ•°',
                    type: 'scatter',
                    data: values.map((v, i) => [i, v]),
                    symbolSize: (val) => (val[1] > 100 || val[1] < 30) ? 15 : 8,
                    itemStyle: {
                        color: (params) => {
                            const value = params.value[1];
                            return (value > 100 || value < 30) ? '#ef4444' : '#3b82f6';
                        }
                    }
                }]
            };

            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
            console.log('âœ… å¼‚å¸¸æ£€æµ‹å›¾è¡¨åˆå§‹åŒ–å®Œæˆ');
        }

        /**
         * RFMåˆ†æå›¾è¡¨åˆå§‹åŒ–
         */
        function initializeRFMAnalysisChart() {
            const chartContainer = document.getElementById('rfm-analysis-chart');
            if (!chartContainer) return;

            const chart = echarts.init(chartContainer);
            window.rfmAnalysisChart = chart;

            const rfmData = [
                { name: 'é‡è¦ä»·å€¼å®¢æˆ·', value: 85, count: 234 },
                { name: 'é‡è¦ä¿æŒå®¢æˆ·', value: 72, count: 156 },
                { name: 'é‡è¦å‘å±•å®¢æˆ·', value: 68, count: 189 },
                { name: 'ä¸€èˆ¬å®¢å®¢æˆ·', value: 45, count: 420 }
            ];

            const option = {
                title: { text: 'RFMç”¨æˆ·åˆ†å±‚åˆ†æ', left: 'center' },
                tooltip: {
                    trigger: 'item',
                    formatter: (params) => {
                        const data = rfmData[params.dataIndex];
                        return `${data.name}<br/>ä»·å€¼è¯„åˆ†: ${data.value}<br/>ç”¨æˆ·æ•°: ${data.count}`;
                    }
                },
                xAxis: {
                    type: 'category',
                    data: rfmData.map(d => d.name),
                    axisLabel: { rotate: 30 }
                },
                yAxis: { type: 'value', name: 'ä»·å€¼è¯„åˆ†' },
                series: [{
                    name: 'RFMè¯„åˆ†',
                    type: 'bar',
                    data: rfmData.map(d => d.value),
                    itemStyle: {
                        color: (params) => {
                            const colors = ['#10b981', '#3b82f6', '#f59e0b', '#ef4444'];
                            return colors[params.dataIndex];
                        }
                    }
                }]
            };

            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());

            const tableContainer = document.getElementById('rfm-cluster-table');
            if (tableContainer) {
                const tableHTML = `
                    <table class="w-full text-sm">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-2 text-left">ç”¨æˆ·åˆ†å±‚</th>
                                <th class="px-4 py-2 text-left">ç”¨æˆ·æ•°</th>
                                <th class="px-4 py-2 text-left">å æ¯”</th>
                                <th class="px-4 py-2 text-left">ç­–ç•¥å»ºè®®</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${rfmData.map((d, i) => `
                                <tr class="border-b">
                                    <td class="px-4 py-2 font-medium">${d.name}</td>
                                    <td class="px-4 py-2">${d.count}</td>
                                    <td class="px-4 py-2">${(d.count / 999 * 100).toFixed(1)}%</td>
                                    <td class="px-4 py-2 text-xs text-gray-600">
                                        ${i === 0 ? 'é‡ç‚¹ç»´æŠ¤ï¼Œæä¾›VIPæœåŠ¡' :
                                          i === 1 ? 'å®šæœŸè¥é”€ï¼Œé˜²æ­¢æµå¤±' :
                                          i === 2 ? 'æå‡æ¶ˆè´¹é¢‘æ¬¡å’Œé‡‘é¢' : 'ä¸€èˆ¬æ€§ç®¡ç†'}
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
                tableContainer.innerHTML = tableHTML;
            }

            console.log('âœ… RFMåˆ†æå›¾è¡¨åˆå§‹åŒ–å®Œæˆ');
        }

        /**
         * 24å°æ—¶ä»·æ ¼è¶‹åŠ¿å›¾è¡¨åˆå§‹åŒ–
         */
        function initializePriceTrendChart() {
            const chartContainer = document.getElementById('dynamic-price-chart');
            if (!chartContainer) return;

            const chart = echarts.init(chartContainer);
            window.priceTrendChart = chart;

            // ç”Ÿæˆ24å°æ—¶æ•°æ®
            const hours = [];
            const prices = [];
            const basePrice = 5;

            for (let i = 0; i < 24; i++) {
                hours.push(i + ':00');

                let multiplier = 1.0;

                // é«˜å³°æœŸ (7:00-9:00, 17:00-19:00): x1.5
                if ((i >= 7 && i <= 9) || (i >= 17 && i <= 19)) {
                    multiplier = 1.5;
                }
                // å¤œé—´ (22:00-6:00): x0.8
                else if (i >= 22 || i <= 6) {
                    multiplier = 0.8;
                }
                // å…¶ä»–æ—¶æ®µ: x1.0-1.2
                else {
                    multiplier = 1.0 + Math.random() * 0.2;
                }

                const price = basePrice * multiplier;
                prices.push(parseFloat(price.toFixed(2)));
            }

            // æ‰¾å‡ºæœ€é«˜å’Œæœ€ä½ä»·æ ¼
            const maxPrice = Math.max(...prices);
            const minPrice = Math.min(...prices);
            const avgPrice = prices.reduce((a, b) => a + b, 0) / prices.length;

            // æ ‡è®°ç‚¹æ•°æ®
            const markPointData = [];
            const maxIndex = prices.indexOf(maxPrice);
            const minIndex = prices.indexOf(minPrice);

            markPointData.push({
                name: 'æœ€é«˜ä»·æ ¼',
                value: maxPrice,
                xAxis: maxIndex,
                yAxis: maxPrice,
                itemStyle: { color: '#ef4444' }
            });

            markPointData.push({
                name: 'æœ€ä½ä»·æ ¼',
                value: minPrice,
                xAxis: minIndex,
                yAxis: minPrice,
                itemStyle: { color: '#10b981' }
            });

            const option = {
                title: {
                    text: '24å°æ—¶åŠ¨æ€ä»·æ ¼è¶‹åŠ¿',
                    left: 'center',
                    subtext: 'åŸºç¡€ä»·: Â¥' + basePrice + ' | å®æ—¶æ³¢åŠ¨'
                },
                tooltip: {
                    trigger: 'axis',
                    formatter: function(params) {
                        const hour = params[0].axisValue;
                        const price = params[0].value;
                        const change = ((price - basePrice) / basePrice * 100).toFixed(1);
                        const timeSlot = (() => {
                            const hourNum = parseInt(hour);
                            if ((hourNum >= 7 && hourNum <= 9) || (hourNum >= 17 && hourNum <= 19)) return 'âš¡ é«˜å³°æœŸ';
                            if (hourNum >= 22 || hourNum <= 6) return 'ğŸŒ™ å¤œé—´ä¼˜æƒ ';
                            return 'ğŸ“Š å¹³æ—¶æ—¶æ®µ';
                        })();
                        return `<strong>${hour}</strong><br/>
                               ${timeSlot}<br/>
                               ä»·æ ¼: <span style="color:${price > basePrice ? '#ef4444' : '#10b981'}">Â¥${price}</span><br/>
                               å˜åŒ–: <span style="color:${price > basePrice ? '#ef4444' : '#10b981'}">${change > 0 ? '+' : ''}${change}%</span>`;
                    }
                },
                legend: {
                    data: ['å®æ—¶ä»·æ ¼', 'åŸºç¡€ä»·'],
                    bottom: 10
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: hours,
                    axisLabel: {
                        interval: 1,
                        rotate: 45
                    }
                },
                yAxis: {
                    type: 'value',
                    axisLabel: {
                        formatter: 'Â¥{value}'
                    }
                },
                series: [{
                    name: 'å®æ—¶ä»·æ ¼',
                    type: 'line',
                    smooth: true,
                    symbol: 'circle',
                    symbolSize: 6,
                    lineStyle: {
                        color: '#3b82f6',
                        width: 3
                    },
                    areaStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            { offset: 0, color: 'rgba(59, 130, 246, 0.3)' },
                            { offset: 1, color: 'rgba(59, 130, 246, 0.05)' }
                        ])
                    },
                    itemStyle: {
                        color: '#3b82f6'
                    },
                    data: prices,
                    markPoint: {
                        data: markPointData,
                        label: {
                            show: true,
                            formatter: '{b}: Â¥{c}',
                            position: 'top'
                        }
                    },
                    markLine: {
                        silent: true,
                        lineStyle: {
                            color: '#f59e0b',
                            type: 'dashed'
                        },
                        data: [{
                            yAxis: basePrice,
                            label: {
                                formatter: 'åŸºç¡€ä»·: Â¥{c}'
                            }
                        }]
                    }
                }]
            };

            chart.setOption(option);

            // æ·»åŠ ç»Ÿè®¡ä¿¡æ¯
            const statsHtml = `
                <div class="mt-6 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                    <div class="text-center p-3 bg-red-50 rounded-lg">
                        <div class="text-red-600 font-medium">æœ€é«˜ä»·æ ¼</div>
                        <div class="font-bold text-lg">Â¥${maxPrice.toFixed(2)}</div>
                    </div>
                    <div class="text-center p-3 bg-green-50 rounded-lg">
                        <div class="text-green-600 font-medium">æœ€ä½ä»·æ ¼</div>
                        <div class="font-bold text-lg">Â¥${minPrice.toFixed(2)}</div>
                    </div>
                    <div class="text-center p-3 bg-blue-50 rounded-lg">
                        <div class="text-blue-600 font-medium">å¹³å‡ä»·æ ¼</div>
                        <div class="font-bold text-lg">Â¥${avgPrice.toFixed(2)}</div>
                    </div>
                    <div class="text-center p-3 bg-purple-50 rounded-lg">
                        <div class="text-purple-600 font-medium">æ³¢åŠ¨å¹…åº¦</div>
                        <div class="font-bold text-lg">${((maxPrice - minPrice) / minPrice * 100).toFixed(1)}%</div>
                    </div>
                </div>
            `;

            // æŸ¥æ‰¾æˆ–åˆ›å»ºç»Ÿè®¡ä¿¡æ¯å®¹å™¨
            let statsContainer = document.getElementById('price-trend-stats');
            if (!statsContainer) {
                statsContainer = document.createElement('div');
                statsContainer.id = 'price-trend-stats';
                chartContainer.parentNode.insertBefore(statsContainer, chartContainer.nextSibling);
            }
            statsContainer.innerHTML = statsHtml;

            window.addEventListener('resize', () => chart.resize());
            console.log('âœ… ä»·æ ¼è¶‹åŠ¿å›¾è¡¨åˆå§‹åŒ–å®Œæˆ');
        }

        /**
         * é¢„æµ‹å‡†ç¡®ç‡å›¾è¡¨åˆå§‹åŒ–
         */
        function initializePredictionAccuracyChart() {
            const chartContainer = document.getElementById('prediction-accuracy-chart');
            if (!chartContainer) return;

            const chart = echarts.init(chartContainer);
            window.predictionAccuracyChart = chart;

            const months = ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ'];
            const accuracyData = [82.5, 85.2, 88.7, 91.3, 89.8, 87.3];

            const option = {
                title: { text: 'é¢„æµ‹å‡†ç¡®ç‡è¶‹åŠ¿', left: 'center' },
                tooltip: {
                    trigger: 'axis',
                    formatter: '{b}: {c}%'
                },
                xAxis: {
                    type: 'category',
                    data: months
                },
                yAxis: {
                    type: 'value',
                    name: 'å‡†ç¡®ç‡(%)',
                    min: 80,
                    max: 95
                },
                series: [{
                    name: 'é¢„æµ‹å‡†ç¡®ç‡',
                    type: 'line',
                    data: accuracyData,
                    smooth: true,
                    lineStyle: { color: '#10b981', width: 3 },
                    areaStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            { offset: 0, color: 'rgba(16, 185, 129, 0.3)' },
                            { offset: 1, color: 'rgba(16, 185, 129, 0.1)' }
                        ])
                    }
                }]
            };

            chart.setOption(option);
            window.addEventListener('resize', () => chart.resize());
            console.log('âœ… é¢„æµ‹å‡†ç¡®ç‡å›¾è¡¨åˆå§‹åŒ–å®Œæˆ');
        }

        /**
         * ç”Ÿæˆå¼‚å¸¸è­¦æŠ¥
         */
        function generateAnomalyAlerts() {
            const container = document.getElementById('anomaly-alerts');
            if (!container) return;

            const alerts = [
                { time: '2025-01-15 14:32', type: 'æµé‡å¼‚å¸¸', severity: 'high', description: 'æœºç”µå­¦é¦†åœè½¦åœºæµé‡çªç„¶ä¸‹é™65%ï¼Œç–‘ä¼¼è®¾å¤‡æ•…éšœ' },
                { time: '2025-01-15 10:15', type: 'ä»·æ ¼å¼‚å¸¸', severity: 'medium', description: 'å»ºç­‘å­¦é¦†åœè½¦åœºä»·æ ¼åç¦»æ­£å¸¸èŒƒå›´20%' },
                { time: '2025-01-14 22:45', type: 'åˆ©ç”¨ç‡å¼‚å¸¸', severity: 'low', description: 'å¤§æˆåœè½¦åœºæ·±å¤œåˆ©ç”¨ç‡å¼‚å¸¸å‡é«˜' }
            ];

            const alertsHTML = `
                <div class="space-y-4">
                    ${alerts.map((alert, i) => `
                        <div class="flex items-start p-4 bg-red-50 rounded-lg border-l-4 border-red-400">
                            <div class="flex-shrink-0 text-red-500 text-xl mr-3">âš ï¸</div>
                            <div class="flex-1">
                                <div class="flex justify-between items-center mb-1">
                                    <h4 class="font-semibold text-red-800">${alert.type}</h4>
                                    <span class="text-xs text-red-600">${alert.time}</span>
                                </div>
                                <p class="text-sm text-red-700">${alert.description}</p>
                                <div class="mt-2">
                                    <span class="inline-block px-2 py-1 bg-red-100 text-red-800 text-xs rounded">
                                        ${alert.severity === 'high' ? 'ä¸¥é‡' : alert.severity === 'medium' ? 'ä¸­ç­‰' : 'è½»å¾®'}
                                    </span>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;

            container.innerHTML = alertsHTML;
            console.log('âœ… å¼‚å¸¸è­¦æŠ¥å·²ç”Ÿæˆ');
        }

        /**
         * ç”Ÿæˆæ™ºèƒ½è¿è¥å»ºè®®
         */
        function generateSmartRecommendations() {
            const container = document.getElementById('smart-recommendations');
            if (!container) return;

            const recommendations = [
                {
                    type: 'æ”¶ç›Šæœºä¼š',
                    icon: 'ğŸ’°',
                    title: 'åŠ¨æ€å®šä»·ä¼˜åŒ–',
                    content: 'æ ¹æ®é¢„æµ‹ï¼Œå‘¨äº”18:00-20:00ä¸ºé«˜éœ€æ±‚æ—¶æ®µï¼Œå»ºè®®å°†ä»·æ ¼ä¸Šè°ƒ20%ï¼Œé¢„è®¡å¢æ”¶Â¥2,300',
                    color: 'green'
                },
                {
                    type: 'æ•ˆç‡ä¼˜åŒ–',
                    icon: 'âš¡',
                    title: 'è½¦ä½åˆ©ç”¨ç‡æå‡',
                    content: 'å»ºè®®å°†åˆ©ç”¨ç‡ä½äº30%çš„CåŒºè½¦ä½è½¬ä¸ºæœˆç§Ÿæ¨¡å¼ï¼Œé¢„è®¡æå‡æ•´ä½“åˆ©ç”¨ç‡15%',
                    color: 'blue'
                },
                {
                    type: 'æˆæœ¬èŠ‚çº¦',
                    icon: 'ğŸ’¡',
                    title: 'è®¾å¤‡ç»´æŠ¤ä¼˜åŒ–',
                    content: 'åŸºäºIoTæ•°æ®åˆ†æï¼Œå»ºè®®å°†3å·æ‘„åƒå¤´ç»´æŠ¤å‘¨æœŸä»30å¤©è°ƒæ•´ä¸º45å¤©ï¼Œå¹´èŠ‚çº¦ç»´æŠ¤æˆæœ¬Â¥1,800',
                    color: 'yellow'
                }
            ];

            const cardsHTML = `
                ${recommendations.map(rec => `
                    <div class="bg-white rounded-lg p-6 shadow-md transform hover:scale-105 transition-all border-l-4 border-${rec.color}-400">
                        <div class="flex items-center mb-4">
                            <span class="text-2xl mr-3">${rec.icon}</span>
                            <h4 class="font-bold text-lg text-${rec.color}-800">${rec.title}</h4>
                        </div>
                        <p class="text-sm text-gray-700 mb-3">${rec.content}</p>
                        <span class="inline-block px-3 py-1 bg-${rec.color}-100 text-${rec.color}-800 text-xs rounded-full font-medium">
                            ${rec.type}
                        </span>
                    </div>
                `).join('')}
            `;

            container.innerHTML = cardsHTML;
            console.log('âœ… æ™ºèƒ½è¿è¥å»ºè®®å·²ç”Ÿæˆ');
        }

        // å“åº”å¼å›¾è¡¨å¤„ç†
        window.addEventListener('resize', function() {
            if (window.demandPredictionChart) window.demandPredictionChart.resize();
            if (window.anomalyDetectionChart) window.anomalyDetectionChart.resize();
            if (window.rfmAnalysisChart) window.rfmAnalysisChart.resize();
            if (window.predictionAccuracyChart) window.predictionAccuracyChart.resize();
        });
        // ==================== END PHASE 4 ====================

        // ç¤ºä¾‹ï¼šå¦‚ä½•åœ¨æ¥å…¥åç«¯åä¸Šä¼ æ–‡ä»¶
        // åªéœ€å°†ä»¥ä¸‹ä»£ç æ›¿æ¢ä¸ºçœŸå®APIè°ƒç”¨ï¼š
        // const formData = new FormData();
        // formData.append('file', file);
        // await fetch('/api/upload', {
        //     method: 'POST',
        //     body: formData
        // });
    </script>

    <!-- ======================================== -->
    <!-- åœè½¦åœºç®¡ç†æ¨¡æ€æ¡† (ADDED) -->
    <!-- ======================================== -->

    <!-- åœè½¦åœºè¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="parking-details-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-2xl font-bold gradient-text">åœè½¦åœºè¯¦æƒ…</h3>
                    <button onclick="closeParkingDetailsModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                </div>
            </div>
            <div id="parking-details-content" class="p-6">
                <!-- åŠ¨æ€ç”Ÿæˆå†…å®¹ -->
            </div>
            <div class="p-6 border-t border-gray-200 flex justify-end">
                <button onclick="closeParkingDetailsModal()" class="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 transition-colors">å…³é—­</button>
            </div>
        </div>
    </div>

    <!-- åœè½¦åœºç¼–è¾‘æ¨¡æ€æ¡† -->
    <div id="parking-edit-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-2xl font-bold gradient-text">ç¼–è¾‘åœè½¦åœº</h3>
                    <button onclick="closeParkingEditModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                </div>
            </div>
            <form id="parking-edit-form" class="p-6">
                <input type="hidden" id="edit-parking-id">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">åœè½¦åœºåç§° *</label>
                        <input type="text" id="edit-parking-name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">åœè½¦åœºåœ°å€ *</label>
                        <input type="text" id="edit-parking-address" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">æ€»è½¦ä½æ•° *</label>
                        <input type="number" id="edit-parking-total-spots" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" min="1" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ç©ºé—²è½¦ä½æ•° *</label>
                        <input type="number" id="edit-parking-available-spots" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" min="0" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ä»·æ ¼ï¼ˆå…ƒ/å°æ—¶ï¼‰*</label>
                        <input type="number" id="edit-parking-price" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" min="0" step="0.01" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">çŠ¶æ€ *</label>
                        <select id="edit-parking-status" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                            <option value="normal">æ­£å¸¸</option>
                            <option value="busy">æ‹¥æŒ¤</option>
                            <option value="full">å·²æ»¡</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">è´Ÿè´£äººå§“å</label>
                        <input type="text" id="edit-parking-manager" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">è”ç³»ç”µè¯</label>
                        <input type="tel" id="edit-parking-contact" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                </div>
                <div class="mt-6">
                    <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium">ä¿å­˜ä¿®æ”¹</button>
                </div>
            </form>
        </div>
    </div>
</body>
</html>