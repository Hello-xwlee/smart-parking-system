<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¼´è´¹ä¸­å¿ƒ - æ™ºèƒ½åœè½¦ç®¡ç†ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Noto Sans SC', sans-serif;
        }
        .gradient-text {
            background: linear-gradient(135deg, #3b82f6, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .payment-card {
            transition: all 0.3s ease;
        }
        .payment-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .payment-method {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .payment-method:hover {
            background-color: #f3f4f6;
        }
        .payment-method.selected {
            background: linear-gradient(135deg, #3b82f6, #06b6d4);
            color: white;
        }
        .invoice-card {
            transition: all 0.3s ease;
        }
        .invoice-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .status-unpaid { color: #ef4444; }
        .status-paid { color: #10b981; }
        .status-pending { color: #f59e0b; }
        .qr-code {
            width: 200px;
            height: 200px;
            background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSJ3aGl0ZSIvPgo8cmVjdCB4PSIxMCIgeT0iMTAiIHdpZHRoPSIxODAiIGhlaWdodD0iMTgwIiBmaWxsPSJibGFjayIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIyIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iMTAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSJ3aGl0ZSIgZm9udC1zaXplPSIxNiI+5Zu+54mH5Y+R5biDPC90ZXh0Pgo8L3N2Zz4K') center/contain no-repeat;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <!-- å¯¼èˆªæ  -->
    <nav class="bg-white shadow-lg fixed w-full top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-2xl font-bold gradient-text">æ™ºèƒ½åœè½¦ç®¡ç†</h1>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="index.html" class="text-gray-600 hover:text-blue-600 transition-colors">é¦–é¡µ</a>
                    <a href="search.html" class="text-gray-600 hover:text-blue-600 transition-colors">åœè½¦åœºæŸ¥è¯¢</a>
                    <a href="navigation.html" class="text-gray-600 hover:text-blue-600 transition-colors">å®¤å†…å¯¼èˆª</a>
                    <a href="booking.html" class="text-gray-600 hover:text-blue-600 transition-colors">é¢„çº¦ç®¡ç†</a>
                    <a href="payment.html" class="text-blue-600 font-medium hover:text-blue-800 transition-colors">ç¼´è´¹ä¸­å¿ƒ</a>
                    <a href="dashboard-big-screen.html" class="text-gray-600 hover:text-yellow-400 transition-colors" target="_blank">æ•°æ®å¤§å±</a>

                    <!-- é€šçŸ¥é“ƒé“› -->
                    <button onclick="NotificationManager.showNotificationDrawer()" class="relative p-2 text-gray-600 hover:text-blue-600 transition-colors" id="notification-btn" style="display: none;">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold hidden" id="notification-badge">0</span>
                    </button>

                    <!-- ç™»å½•å‰æ˜¾ç¤º -->
                    <a href="login.html" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors" id="nav-login-btn">ç™»å½•</a>
                    <a href="register.html" class="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors" id="nav-register-btn">æ³¨å†Œ</a>

                    <!-- ç™»å½•åæ˜¾ç¤º -->
                    <button onclick="AuthManager.logout()" class="bg-red-100 text-red-700 px-4 py-2 rounded-lg hover:bg-red-200 transition-colors hidden" id="nav-logout-btn">é€€å‡º</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- é€šçŸ¥æŠ½å±‰ -->
    <div id="drawer-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden" onclick="NotificationManager.hideNotificationDrawer()"></div>
    <div id="notification-drawer" class="fixed top-0 right-0 h-full w-96 bg-white shadow-2xl z-50 transform translate-x-full transition-transform duration-300 ease-in-out">
        <div class="flex items-center justify-between p-6 border-b border-gray-200">
            <h2 class="text-xl font-semibold text-gray-900">æ¶ˆæ¯é€šçŸ¥</h2>
            <button onclick="NotificationManager.hideNotificationDrawer()" class="text-gray-400 hover:text-gray-600">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
        <div class="flex items-center justify-between p-4 border-b border-gray-100">
            <button onclick="NotificationManager.markAllAsRead()" class="text-sm text-blue-600 hover:text-blue-800">
                å…¨éƒ¨æ ‡è®°ä¸ºå·²è¯»
            </button>
        </div>
        <div id="notification-list" class="flex-1 overflow-y-auto" style="max-height: calc(100vh - 140px);">
            <!-- é€šçŸ¥åˆ—è¡¨ -->
        </div>
    </div>

    <!-- ä¸»è¦å†…å®¹ -->
    <main class="pt-16">
        <!-- è´¹ç”¨æ¦‚è§ˆ -->
        <section class="py-8">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl font-bold text-center mb-8 gradient-text">è´¹ç”¨æ¦‚è§ˆ</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                        <div class="text-3xl mb-2">ğŸ’°</div>
                        <h3 class="text-lg font-semibold mb-2">å¾…ç¼´è´¹</h3>
                        <p class="text-2xl font-bold text-red-600" id="pending-amount">Â¥156.00</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                        <div class="text-3xl mb-2">âœ…</div>
                        <h3 class="text-lg font-semibold mb-2">å·²ç¼´è´¹</h3>
                        <p class="text-2xl font-bold text-green-600" id="paid-amount">Â¥2,340.00</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                        <div class="text-3xl mb-2">ğŸ“Š</div>
                        <h3 class="text-lg font-semibold mb-2">æœ¬æœˆæ¶ˆè´¹</h3>
                        <p class="text-2xl font-bold text-blue-600" id="monthly-amount">Â¥568.00</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                        <div class="text-3xl mb-2">ğŸ¯</div>
                        <h3 class="text-lg font-semibold mb-2">ä¼˜æƒ èŠ‚çœ</h3>
                        <p class="text-2xl font-bold text-purple-600" id="savings-amount">Â¥89.00</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- å¾…ç¼´è´¹é¡¹ç›® -->
        <section class="py-8 bg-gray-50">
            <div class="container mx-auto px-6">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-bold gradient-text">å¾…ç¼´è´¹é¡¹ç›®</h2>
                    <button onclick="batchPayment()" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition-colors">
                        ä¸€é”®ç¼´è´¹
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="pending-payments">
                    <!-- å¾…ç¼´è´¹é¡¹ç›®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </section>

        <!-- æ”¯ä»˜ç•Œé¢ -->
        <section class="py-8" id="payment-section" style="display: none;">
            <div class="container mx-auto px-6">
                <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-lg p-8">
                    <h2 class="text-2xl font-bold mb-6 text-center">æ”¯ä»˜è´¹ç”¨</h2>
                    <div class="mb-6">
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h3 class="font-semibold mb-2">æ”¯ä»˜è¯¦æƒ…</h3>
                            <div class="text-sm text-gray-600 space-y-1" id="payment-details">
                                <!-- æ”¯ä»˜è¯¦æƒ…å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ”¯ä»˜æ–¹å¼é€‰æ‹© -->
                    <div class="mb-6">
                        <h3 class="font-semibold mb-4">é€‰æ‹©æ”¯ä»˜æ–¹å¼</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="payment-method p-4 border rounded-lg text-center" onclick="selectPaymentMethod('wechat')">
                                <div class="text-2xl mb-2">ğŸ’š</div>
                                <div class="font-medium">å¾®ä¿¡æ”¯ä»˜</div>
                            </div>
                            <div class="payment-method p-4 border rounded-lg text-center" onclick="selectPaymentMethod('alipay')">
                                <div class="text-2xl mb-2">ğŸ’™</div>
                                <div class="font-medium">æ”¯ä»˜å®</div>
                            </div>
                            <div class="payment-method p-4 border rounded-lg text-center" onclick="selectPaymentMethod('card')">
                                <div class="text-2xl mb-2">ğŸ’³</div>
                                <div class="font-medium">é“¶è¡Œå¡</div>
                            </div>
                            <div class="payment-method p-4 border rounded-lg text-center" onclick="selectPaymentMethod('balance')">
                                <div class="text-2xl mb-2">ğŸ’°</div>
                                <div class="font-medium">ä½™é¢æ”¯ä»˜</div>
                            </div>
                        </div>
                    </div>

                    <!-- äºŒç»´ç æ”¯ä»˜åŒºåŸŸ -->
                    <div id="qr-payment" class="text-center mb-6" style="display: none;">
                        <h3 class="font-semibold mb-4">è¯·æ‰«æäºŒç»´ç æ”¯ä»˜</h3>
                        <div class="qr-code mx-auto mb-4"></div>
                        <p class="text-sm text-gray-600">è¯·ä½¿ç”¨å¾®ä¿¡æˆ–æ”¯ä»˜å®æ‰«æäºŒç»´ç å®Œæˆæ”¯ä»˜</p>
                    </div>

                    <!-- æ”¯ä»˜æŒ‰é’® -->
                    <div class="flex gap-4">
                        <button onclick="cancelPayment()" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-400 transition-colors">
                            å–æ¶ˆæ”¯ä»˜
                        </button>
                        <button onclick="confirmPayment()" class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors">
                            ç¡®è®¤æ”¯ä»˜
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- ç¼´è´¹è®°å½• -->
        <section class="py-8">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl font-bold text-center mb-8 gradient-text">ç¼´è´¹è®°å½•</h2>
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">åœè½¦åœº</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">è½¦ç‰Œå·</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">åœè½¦æ—¶é—´</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">è´¹ç”¨</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">çŠ¶æ€</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="payment-history" class="bg-white divide-y divide-gray-200">
                                <!-- ç¼´è´¹è®°å½•å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- ç”µå­å‘ç¥¨ -->
        <section class="py-8 bg-gray-50">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl font-bold text-center mb-8 gradient-text">ç”µå­å‘ç¥¨ç®¡ç†</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="invoice-list">
                    <!-- å‘ç¥¨åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </section>

        <!-- æ¶ˆè´¹ç»Ÿè®¡ -->
        <section class="py-8">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl font-bold text-center mb-8 gradient-text">æ¶ˆè´¹ç»Ÿè®¡åˆ†æ</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-semibold mb-4">æœˆåº¦æ¶ˆè´¹è¶‹åŠ¿</h3>
                        <div id="monthly-chart" style="height: 300px;"></div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-semibold mb-4">åœè½¦åœºæ¶ˆè´¹åˆ†å¸ƒ</h3>
                        <div id="parking-chart" style="height: 300px;"></div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- é¡µè„š -->
    <footer class="bg-gray-800 text-white py-12">
        <div class="container mx-auto px-6 text-center">
            <p class="text-gray-300">&copy; 2025 æ™ºèƒ½åœè½¦ç®¡ç†ç³»ç»Ÿ. åŸºäºäººå·¥æ™ºèƒ½å’Œç‰©è”ç½‘æŠ€æœ¯çš„ç°ä»£åŒ–åœè½¦è§£å†³æ–¹æ¡ˆ.</p>
        </div>
    </footer>

    <!-- å‘ç¥¨è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="invoice-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl p-8 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">ç”µå­å‘ç¥¨</h3>
                <button onclick="closeInvoiceModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            <div id="invoice-content">
                <!-- å‘ç¥¨å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <script src="mockData.js"></script>
    <script src="main.js"></script>
    <script>
        // ç¼´è´¹ä¸­å¿ƒé¡µé¢ç‰¹å®šåŠŸèƒ½
        let pendingPayments = [];
        let paymentHistory = [];
        let invoices = [];
        let selectedPaymentMethod = null;
        let currentPayment = null;

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            generateSampleData();
            displayPendingPayments();
            displayPaymentHistory();
            displayInvoices();
            initializeCharts();
            updateStatistics();
        });

        // ç”Ÿæˆç¤ºä¾‹æ•°æ®
        function generateSampleData() {
            // å¾…ç¼´è´¹é¡¹ç›®
            pendingPayments = [
                {
                    id: 1,
                    parkingName: 'æœºç”µå­¦é¦†åœè½¦åœº',
                    licensePlate: 'äº¬A12345',
                    entryTime: '2024-11-10 09:00:00',
                    exitTime: '2024-11-10 11:30:00',
                    duration: '2å°æ—¶30åˆ†é’Ÿ',
                    amount: 20.00,
                    status: 'unpaid',
                    parkingId: 1
                },
                {
                    id: 2,
                    parkingName: 'å»ºç­‘å­¦é¦†åœè½¦åœº',
                    licensePlate: 'äº¬B67890',
                    entryTime: '2024-11-09 14:00:00',
                    exitTime: '2024-11-09 16:15:00',
                    duration: '2å°æ—¶15åˆ†é’Ÿ',
                    amount: 27.00,
                    status: 'unpaid',
                    parkingId: 2
                },
                {
                    id: 3,
                    parkingName: 'å¤§æˆåœè½¦åœº',
                    licensePlate: 'äº¬C24680',
                    entryTime: '2024-11-08 19:00:00',
                    exitTime: '2024-11-08 21:45:00',
                    duration: '2å°æ—¶45åˆ†é’Ÿ',
                    amount: 27.50,
                    status: 'unpaid',
                    parkingId: 3
                }
            ];

            // ç¼´è´¹è®°å½•
            paymentHistory = [
                {
                    id: 101,
                    parkingName: 'é€¸å¤«åœè½¦åœº',
                    licensePlate: 'äº¬D13579',
                    parkingTime: '2024-11-07 10:00-12:00',
                    amount: 40.00,
                    status: 'paid',
                    paymentTime: '2024-11-07 12:05:00',
                    paymentMethod: 'å¾®ä¿¡æ”¯ä»˜'
                },
                {
                    id: 102,
                    parkingName: 'ä½•ä¸–ç¤¼åœè½¦åœº',
                    licensePlate: 'äº¬E86420',
                    parkingTime: '2024-11-06 15:30-17:30',
                    amount: 25.00,
                    status: 'paid',
                    paymentTime: '2024-11-06 17:35:00',
                    paymentMethod: 'æ”¯ä»˜å®'
                },
                {
                    id: 103,
                    parkingName: 'å†¶é‡‘å­¦é¦†åœè½¦åœº',
                    licensePlate: 'äº¬F11223',
                    parkingTime: '2024-11-05 08:00-18:00',
                    amount: 80.00,
                    status: 'paid',
                    paymentTime: '2024-11-05 18:10:00',
                    paymentMethod: 'é“¶è¡Œå¡'
                }
            ];

            // ç”µå­å‘ç¥¨
            invoices = [
                {
                    id: 1001,
                    invoiceNumber: 'FP20241107001',
                    parkingName: 'é€¸å¤«åœè½¦åœº',
                    amount: 40.00,
                    issueDate: '2024-11-07',
                    status: 'issued',
                    taxAmount: 2.26,
                    licensePlate: 'äº¬D13579'
                },
                {
                    id: 1002,
                    invoiceNumber: 'FP20241106002',
                    parkingName: 'ä½•ä¸–ç¤¼åœè½¦åœº',
                    amount: 25.00,
                    issueDate: '2024-11-06',
                    status: 'issued',
                    taxAmount: 1.42,
                    licensePlate: 'äº¬E86420'
                },
                {
                    id: 1003,
                    invoiceNumber: 'FP20241105003',
                    parkingName: 'å†¶é‡‘å­¦é¦†åœè½¦åœº',
                    amount: 80.00,
                    issueDate: '2024-11-05',
                    status: 'issued',
                    taxAmount: 4.52,
                    licensePlate: 'äº¬F11223'
                }
            ];
        }

        // æ˜¾ç¤ºå¾…ç¼´è´¹é¡¹ç›®
        function displayPendingPayments() {
            const container = document.getElementById('pending-payments');
            if (!container) return;

            container.innerHTML = '';

            pendingPayments.forEach(payment => {
                const div = document.createElement('div');
                div.className = 'payment-card bg-white rounded-xl shadow-lg p-6';

                div.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="font-semibold text-lg">${payment.parkingName}</h3>
                        <span class="status-unpaid font-medium">å¾…ç¼´è´¹</span>
                    </div>
                    <div class="space-y-2 text-sm text-gray-600 mb-4">
                        <div>è½¦ç‰Œå·: ${payment.licensePlate}</div>
                        <div>å…¥åœºæ—¶é—´: ${payment.entryTime}</div>
                        <div>å‡ºåœºæ—¶é—´: ${payment.exitTime}</div>
                        <div>åœè½¦æ—¶é•¿: ${payment.duration}</div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-2xl font-bold text-red-600">Â¥${payment.amount.toFixed(2)}</span>
                        <button onclick="showPaymentSection(${payment.id})" 
                                class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            ç«‹å³æ”¯ä»˜
                        </button>
                    </div>
                `;

                container.appendChild(div);
            });
        }

        // æ˜¾ç¤ºç¼´è´¹è®°å½•
        function displayPaymentHistory() {
            const container = document.getElementById('payment-history');
            if (!container) return;

            container.innerHTML = '';

            paymentHistory.forEach(record => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-50';

                const statusClass = record.status === 'paid' ? 'status-paid' : 'status-pending';
                const statusText = record.status === 'paid' ? 'å·²æ”¯ä»˜' : 'å¾…æ”¯ä»˜';

                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${record.parkingName}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${record.licensePlate}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${record.parkingTime}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium">Â¥${record.amount.toFixed(2)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${statusClass} font-medium">${statusText}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="showInvoice(${record.id})" class="text-blue-600 hover:text-blue-900 mr-3">
                            æŸ¥çœ‹å‘ç¥¨
                        </button>
                        <button onclick="downloadInvoice(${record.id})" class="text-green-600 hover:text-green-900">
                            ä¸‹è½½
                        </button>
                    </td>
                `;

                container.appendChild(tr);
            });
        }

        // æ˜¾ç¤ºç”µå­å‘ç¥¨
        function displayInvoices() {
            const container = document.getElementById('invoice-list');
            if (!container) return;

            container.innerHTML = '';

            invoices.forEach(invoice => {
                const div = document.createElement('div');
                div.className = 'invoice-card bg-white rounded-xl shadow-lg p-6 cursor-pointer';
                div.onclick = () => showInvoiceDetail(invoice);

                div.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="font-semibold text-lg">${invoice.parkingName}</h3>
                        <span class="bg-green-100 text-green-800 text-xs font-medium px-2 py-1 rounded">å·²å¼€å…·</span>
                    </div>
                    <div class="space-y-2 text-sm text-gray-600 mb-4">
                        <div>å‘ç¥¨å·ç : ${invoice.invoiceNumber}</div>
                        <div>è½¦ç‰Œå·: ${invoice.licensePlate}</div>
                        <div>å¼€ç¥¨æ—¥æœŸ: ${invoice.issueDate}</div>
                        <div>ç¨é¢: Â¥${invoice.taxAmount.toFixed(2)}</div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xl font-bold text-blue-600">Â¥${invoice.amount.toFixed(2)}</span>
                        <div class="flex gap-2">
                            <button onclick="event.stopPropagation(); downloadInvoice(${invoice.id})" 
                                    class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">
                                ä¸‹è½½
                            </button>
                            <button onclick="event.stopPropagation(); sendInvoice(${invoice.id})" 
                                    class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">
                                å‘é€
                            </button>
                        </div>
                    </div>
                `;

                container.appendChild(div);
            });
        }

        // æ˜¾ç¤ºæ”¯ä»˜åŒºåŸŸ
        function showPaymentSection(paymentId) {
            currentPayment = pendingPayments.find(p => p.id === paymentId);
            if (!currentPayment) return;

            const paymentSection = document.getElementById('payment-section');
            const paymentDetails = document.getElementById('payment-details');
            
            if (paymentSection && paymentDetails) {
                paymentDetails.innerHTML = `
                    <div>åœè½¦åœº: ${currentPayment.parkingName}</div>
                    <div>è½¦ç‰Œå·: ${currentPayment.licensePlate}</div>
                    <div>åœè½¦æ—¶é•¿: ${currentPayment.duration}</div>
                    <div>åº”ä»˜é‡‘é¢: <span class="font-bold text-red-600">Â¥${currentPayment.amount.toFixed(2)}</span></div>
                `;
                
                paymentSection.style.display = 'block';
                paymentSection.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // é€‰æ‹©æ”¯ä»˜æ–¹å¼
        function selectPaymentMethod(method) {
            selectedPaymentMethod = method;
            
            // æ›´æ–°UI
            document.querySelectorAll('.payment-method').forEach(el => {
                el.classList.remove('selected');
            });
            event.target.closest('.payment-method').classList.add('selected');
            
            // æ˜¾ç¤ºäºŒç»´ç ï¼ˆä»…å¾®ä¿¡å’Œæ”¯ä»˜å®ï¼‰
            const qrPayment = document.getElementById('qr-payment');
            if (method === 'wechat' || method === 'alipay') {
                qrPayment.style.display = 'block';
            } else {
                qrPayment.style.display = 'none';
            }
        }

        // ç¡®è®¤æ”¯ä»˜
        function confirmPayment() {
            if (!selectedPaymentMethod) {
                alert('è¯·é€‰æ‹©æ”¯ä»˜æ–¹å¼');
                return;
            }

            if (!currentPayment) {
                alert('æ”¯ä»˜ä¿¡æ¯é”™è¯¯');
                return;
            }

            // æ¨¡æ‹Ÿæ”¯ä»˜è¿‡ç¨‹
            const paymentMethods = {
                'wechat': 'å¾®ä¿¡æ”¯ä»˜',
                'alipay': 'æ”¯ä»˜å®',
                'card': 'é“¶è¡Œå¡',
                'balance': 'ä½™é¢æ”¯ä»˜'
            };

            // æ·»åŠ åˆ°ç¼´è´¹è®°å½•
            const newRecord = {
                id: Date.now(),
                parkingName: currentPayment.parkingName,
                licensePlate: currentPayment.licensePlate,
                parkingTime: `${currentPayment.entryTime.split(' ')[1]}-${currentPayment.exitTime.split(' ')[1]}`,
                amount: currentPayment.amount,
                status: 'paid',
                paymentTime: new Date().toLocaleString('zh-CN'),
                paymentMethod: paymentMethods[selectedPaymentMethod]
            };

            paymentHistory.unshift(newRecord);

            // ä»å¾…ç¼´è´¹åˆ—è¡¨ä¸­ç§»é™¤
            pendingPayments = pendingPayments.filter(p => p.id !== currentPayment.id);

            // ç”Ÿæˆå‘ç¥¨
            const newInvoice = {
                id: Date.now(),
                invoiceNumber: `FP${new Date().toISOString().slice(0, 10).replace(/-/g, '')}${String(invoices.length + 1).padStart(3, '0')}`,
                parkingName: currentPayment.parkingName,
                amount: currentPayment.amount,
                issueDate: new Date().toISOString().slice(0, 10),
                status: 'issued',
                taxAmount: currentPayment.amount * 0.06,
                licensePlate: currentPayment.licensePlate
            };

            invoices.unshift(newInvoice);

            // æ˜¾ç¤ºæ”¯ä»˜æˆåŠŸ
            alert('æ”¯ä»˜æˆåŠŸï¼');
            
            // éšè—æ”¯ä»˜åŒºåŸŸ
            document.getElementById('payment-section').style.display = 'none';
            
            // é‡ç½®æ”¯ä»˜çŠ¶æ€
            currentPayment = null;
            selectedPaymentMethod = null;
            
            // æ›´æ–°æ˜¾ç¤º
            displayPendingPayments();
            displayPaymentHistory();
            displayInvoices();
            updateStatistics();
        }

        // å–æ¶ˆæ”¯ä»˜
        function cancelPayment() {
            document.getElementById('payment-section').style.display = 'none';
            currentPayment = null;
            selectedPaymentMethod = null;
        }

        // ä¸€é”®ç¼´è´¹
        function batchPayment() {
            if (pendingPayments.length === 0) {
                alert('æš‚æ— å¾…ç¼´è´¹é¡¹ç›®');
                return;
            }

            if (confirm(`ç¡®å®šè¦æ”¯ä»˜æ‰€æœ‰å¾…ç¼´è´¹é¡¹ç›®å—ï¼Ÿæ€»é‡‘é¢ä¸ºÂ¥${pendingPayments.reduce((sum, p) => sum + p.amount, 0).toFixed(2)}`)) {
                // æ¨¡æ‹Ÿæ‰¹é‡æ”¯ä»˜
                pendingPayments.forEach(payment => {
                    const newRecord = {
                        id: Date.now() + payment.id,
                        parkingName: payment.parkingName,
                        licensePlate: payment.licensePlate,
                        parkingTime: `${payment.entryTime.split(' ')[1]}-${payment.exitTime.split(' ')[1]}`,
                        amount: payment.amount,
                        status: 'paid',
                        paymentTime: new Date().toLocaleString('zh-CN'),
                        paymentMethod: 'å¾®ä¿¡æ”¯ä»˜'
                    };
                    paymentHistory.unshift(newRecord);
                });

                pendingPayments = [];
                
                alert('æ‰¹é‡æ”¯ä»˜æˆåŠŸï¼');
                
                displayPendingPayments();
                displayPaymentHistory();
                updateStatistics();
            }
        }

        // æ˜¾ç¤ºå‘ç¥¨è¯¦æƒ…
        function showInvoiceDetail(invoice) {
            const modal = document.getElementById('invoice-modal');
            const content = document.getElementById('invoice-content');
            
            if (modal && content) {
                content.innerHTML = `
                    <div class="text-center mb-6">
                        <h4 class="text-xl font-bold mb-2">æ²ˆé˜³å¸‚åœè½¦æœåŠ¡å‘ç¥¨</h4>
                        <p class="text-sm text-gray-600">å‘ç¥¨ä»£ç : 011001900111</p>
                        <p class="text-sm text-gray-600">å‘ç¥¨å·ç : ${invoice.invoiceNumber}</p>
                    </div>
                    <div class="space-y-3 mb-6">
                        <div class="flex justify-between">
                            <span class="font-medium">è´­ä¹°æ–¹:</span>
                            <span>${invoice.licensePlate}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium">æœåŠ¡åç§°:</span>
                            <span>åœè½¦æœåŠ¡</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium">åœè½¦åœº:</span>
                            <span>${invoice.parkingName}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium">å¼€ç¥¨æ—¥æœŸ:</span>
                            <span>${invoice.issueDate}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium">é‡‘é¢:</span>
                            <span class="font-bold">Â¥${invoice.amount.toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium">ç¨é¢:</span>
                            <span>Â¥${invoice.taxAmount.toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between border-t pt-3">
                            <span class="font-bold">ä»·ç¨åˆè®¡:</span>
                            <span class="font-bold text-red-600">Â¥${(invoice.amount + invoice.taxAmount).toFixed(2)}</span>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="downloadInvoice(${invoice.id})" class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
                            ä¸‹è½½å‘ç¥¨
                        </button>
                        <button onclick="sendInvoice(${invoice.id})" class="flex-1 bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">
                            å‘é€é‚®ç®±
                        </button>
                    </div>
                `;
                
                modal.classList.remove('hidden');
            }
        }

        // å…³é—­å‘ç¥¨æ¨¡æ€æ¡†
        function closeInvoiceModal() {
            const modal = document.getElementById('invoice-modal');
            if (modal) {
                modal.classList.add('hidden');
            }
        }

        // ä¸‹è½½å‘ç¥¨
        function downloadInvoice(invoiceId) {
            alert('å‘ç¥¨ä¸‹è½½åŠŸèƒ½å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼');
        }

        // å‘é€å‘ç¥¨
        function sendInvoice(invoiceId) {
            alert('å‘ç¥¨å‘é€åŠŸèƒ½å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼');
        }

        // æ˜¾ç¤ºå‘ç¥¨
        function showInvoice(recordId) {
            const invoice = invoices.find(inv => 
                paymentHistory.find(record => record.id === recordId)?.parkingName === inv.parkingName
            );
            
            if (invoice) {
                showInvoiceDetail(invoice);
            } else {
                alert('æš‚æ— å‘ç¥¨ä¿¡æ¯');
            }
        }

        // åˆå§‹åŒ–å›¾è¡¨
        function initializeCharts() {
            // æœˆåº¦æ¶ˆè´¹è¶‹åŠ¿å›¾è¡¨
            const monthlyChart = echarts.init(document.getElementById('monthly-chart'));
            const monthlyOption = {
                tooltip: {
                    trigger: 'axis'
                },
                xAxis: {
                    type: 'category',
                    data: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ']
                },
                yAxis: {
                    type: 'value',
                    axisLabel: {
                        formatter: 'Â¥{value}'
                    }
                },
                series: [
                    {
                        name: 'æ¶ˆè´¹é‡‘é¢',
                        data: [320, 280, 450, 380, 520, 480, 600, 550, 420, 380, 568, 0],
                        type: 'line',
                        smooth: true,
                        itemStyle: {
                            color: '#3b82f6'
                        },
                        areaStyle: {
                            color: {
                                type: 'linear',
                                x: 0,
                                y: 0,
                                x2: 0,
                                y2: 1,
                                colorStops: [{
                                    offset: 0, color: 'rgba(59, 130, 246, 0.3)'
                                }, {
                                    offset: 1, color: 'rgba(59, 130, 246, 0.1)'
                                }]
                            }
                        }
                    }
                ]
            };
            monthlyChart.setOption(monthlyOption);

            // åœè½¦åœºæ¶ˆè´¹åˆ†å¸ƒå›¾è¡¨
            const parkingChart = echarts.init(document.getElementById('parking-chart'));
            const parkingOption = {
                tooltip: {
                    trigger: 'item',
                    formatter: '{a} <br/>{b}: Â¥{c} ({d}%)'
                },
                legend: {
                    orient: 'vertical',
                    left: 'left'
                },
                series: [
                    {
                        name: 'æ¶ˆè´¹åˆ†å¸ƒ',
                        type: 'pie',
                        radius: '50%',
                        data: [
                            { value: 320, name: 'ä¸­å…³æ‘åœè½¦åœº' },
                            { value: 280, name: 'ç‹åºœäº•åœè½¦åœº' },
                            { value: 250, name: 'è¥¿å•åœè½¦åœº' },
                            { value: 180, name: 'ä¸œå•åœè½¦åœº' },
                            { value: 150, name: 'å…¶ä»–åœè½¦åœº' }
                        ],
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }
                ]
            };
            parkingChart.setOption(parkingOption);

            // å“åº”å¼å›¾è¡¨
            window.addEventListener('resize', function() {
                monthlyChart.resize();
                parkingChart.resize();
            });
        }

        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStatistics() {
            const pendingAmount = pendingPayments.reduce((sum, p) => sum + p.amount, 0);
            const paidAmount = paymentHistory.reduce((sum, p) => sum + p.amount, 0);
            const monthlyAmount = 568.00; // æ¨¡æ‹Ÿæœ¬æœˆæ¶ˆè´¹
            const savingsAmount = 89.00; // æ¨¡æ‹ŸèŠ‚çœé‡‘é¢

            document.getElementById('pending-amount').textContent = `Â¥${pendingAmount.toFixed(2)}`;
            document.getElementById('paid-amount').textContent = `Â¥${paidAmount.toFixed(2)}`;
            document.getElementById('monthly-amount').textContent = `Â¥${monthlyAmount.toFixed(2)}`;
            document.getElementById('savings-amount').textContent = `Â¥${savingsAmount.toFixed(2)}`;
        }
    </script>
</body>
</html>